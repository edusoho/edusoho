(window.webpackJsonp=window.webpackJsonp||[]).push([["classroom"],{8807:function(t,e,s){"use strict";s("a481"),s("ac6a"),s("456d"),s("7f7f"),s("c5f6"),s("8e6e");var i=s("bd86"),r=s("2f62");function a(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function o(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?a(Object(s),!0).forEach((function(e){Object(i.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var n={props:{type:{type:String,default:"price"},course:{type:Object,default:{}},order:{type:Object,default:{}}},data:function(){return{isFree:0==this.course.price}},computed:o(o({},Object(r.e)(["courseSettings"])),{},{rate:function(){return parseInt(this.course.publishedTaskNum)?parseInt(this.course.progress.percent):0},showStudent:function(){return!this.courseSettings||Number(this.courseSettings.show_student_num_enabled)}}),filters:{numFilter:function(t){return t?parseFloat(t).toFixed(2):""}},methods:{goToPay:function(){this.$router.push({path:"/pay",query:{id:this.order.id,source:"order",sn:this.order.sn,targetId:this.order.targetId,targetType:this.order.targetType}})}}},c=s("a6c2"),l={components:{switchBox:Object(c.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"e-course-switch-box"},["price"===t.type?s("div",{staticClass:"switch-box"},[s("span",{staticClass:"switch-box__price"},[t.isFree?s("p",{staticClass:"free"},[t._v("免费")]):t._e(),t.isFree?t._e():s("p",{staticClass:"price"},[t._v("¥ "+t._s(t.course.price))])]),s("span",{staticClass:"switch-box__state"},[t.showStudent?s("p",[t._v(t._s(t.course.studentNum)+"人在学")]):t._e()])]):t._e(),"order"===t.type?s("div",{staticClass:"switch-box"},[s("span",{staticClass:"switch-box__price"},[t.isFree?s("p",{staticClass:"free"},[t._v("免费")]):t._e(),t.isFree?t._e():s("p",{staticClass:"price"},[t._v("¥ "+t._s(t.order.pay_amount/100))])]),s("span",{staticClass:"switch-box__state"},["created"!==t.order.status&&"paying"!==t.order.status?s("p",{class:t.order.status},[t._v("\n        "+t._s(t._f("filterOrderStatus")(t.order.status))+"\n      ")]):t._e(),"created"===t.order.status||"paying"===t.order.status?s("span",{staticClass:"order-pay",on:{click:t.goToPay}},[t._v(t._s(t._f("filterOrderStatus")(t.order.status)))]):t._e()])]):t._e(),"confirmOrder"===t.type?s("div",{staticClass:"switch-box"},[s("span",{staticClass:"switch-box__price"},[s("p",{staticClass:"price"},[t._v("¥ "+t._s(t._f("numFilter")(t.order.totalPrice)))])])]):t._e(),"rank"===t.type?s("div",{staticClass:"rank-box"},[s("div",{staticClass:"progress round-conner"},[s("div",{staticClass:"curRate round-conner",style:{width:t.rate+"%"}})]),s("span",[t._v(t._s(this.rate)+"%")])]):t._e()])}),[],!1,null,null,null).exports},props:{course:{type:Object,default:function(){return{}}},order:{type:Object,default:function(){return{}}},type:{type:String,default:"price"},feedback:{type:Boolean,default:!0},typeList:{type:String,default:"course_list"},duration:{type:Number,default:0}},data:function(){return{pathName:this.$route.name}},computed:{imgSrc:function(){if("classroom_list"===this.typeList)return this.course.cover.middle;var t=this.course.courseSet;return(t?t.cover.middle:this.order.cover.middle)||""},title:function(){return"classroom_list"===this.typeList?this.course.title:this.course.courseSetTitle||(this.course.courseSet?this.course.courseSet.title:"")||this.order.title},teachPlan:function(){return!!this.course.title&&this.course.title},imgClass:function(){return"vip"===this.typeList?"e-vip__img":"e-course__img"},vipDuration:function(){return"month"===this.order.unitType?"".concat(this.duration,"个月"):"year"===this.order.unitType?"".concat(this.duration,"年"):"".concat(this.duration,"天")}},watch:{course:{handler:function(t){var e=t.courseSet;if("miniprogramSetting"===this.pathName&&e)for(var s=Object.keys(e.cover),i=0;i<s.length;i++)e.cover[s[i]]=e.cover[s[i]].replace(/^(\/\/)|(http:\/\/)/,"https://")},immediate:!0}},methods:{onClick:function(t){if(this.feedback&&"vip"!==this.typeList){var e="order"===this.type,s=this.course.id||this.order.targetId;"SPAN"!==t.target.tagName&&(e?"course"===this.typeList||"classroom"===this.typeList?this.$router.push({path:"/goods/".concat(this.order.goodsId,"/show"),query:{targetId:this.order.targetId,type:this.typeList+"_list"}}):location.href=this.order.targetUrl:"course"!==this.typeList&&("classroom_list"===this.typeList&&this.$router.push({path:"/classroom/".concat(s)}),"course_list"===this.typeList&&this.$router.push({path:"/course/".concat(s)})))}}}},u=Object(c.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"e-course"},[s("div",{staticClass:"clearfix",on:{click:t.onClick}},[s("div",{staticClass:"e-course__left pull-left"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.imgSrc,expression:"imgSrc"}],class:t.imgClass})]),s("div",{staticClass:"e-course__right pull-left"},["confirmOrder"===t.type?s("div",{staticClass:"e-course__title course-confirm-title"},[t._v("\n        "+t._s(t.title)),"vip"===t.typeList?s("span",{staticClass:"grey-medium"},[t._v("\n          x "+t._s(t.vipDuration))]):t._e()]):s("div",[s("div",{staticClass:"e-course__title text-overflow"},[t._v(t._s(t.title))]),"classroom_list"===t.typeList?s("div",{staticClass:"e-course__count"},[t._v("\n          共 "+t._s(t.course.courseNum)+" 门课程\n        ")]):t._e(),"course_list"===t.typeList?s("div",{staticClass:"e-course__project text-overflow"},[t.teachPlan?s("span",[t._v(t._s(t.teachPlan))]):t._e()]):t._e()]),s("switchBox",{attrs:{type:t.type,course:t.course,order:t.order,"student-num":t.course.studentNum,"published-task-num":t.course.publishedTaskNum}})],1)])])}),[],!1,null,null,null);e.a=u.exports},"8ab6":function(t,e,s){"use strict";s.r(e),s("8e6e"),s("ac6a"),s("456d"),s("e7e5");var i=s("d399"),r=s("bd86"),a=(s("e17f"),s("2241")),o=(s("96cf"),s("3b8d")),n={name:"Teacher",props:["teacherInfo","title","defaulValue"]},c=s("a6c2"),l=Object(c.a)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("e-panel",{attrs:{title:t.title,"defaul-value":t.defaulValue}},[t._l(t.teacherInfo,(function(e){return t.teacherInfo.length?[s("div",{staticClass:"teacher-content"},[s("img",{staticClass:"avatar-img",attrs:{src:e.avatar&&e.avatar.large}}),s("div",{staticClass:"teacher-cell"},[s("span",{staticClass:"dark font-family-PFM"},[t._v(t._s(e.nickname))]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.title,expression:"item.title"}],staticClass:"text-content"},[t._v(t._s(e.title))])])])]:t._e()}))],2)}),[],!1,null,null,null).exports,u=s("fd23"),d=s("bced"),p=s("3ce7"),h=s("4328"),m=s.n(h),f=s("2f62");function v(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}var g={components:{countDown:u.a,tagLink:d.a},props:{cover:{type:String,default:""},price:{type:String,default:""},classroomId:{type:String,default:0},seckillActivities:{type:Object,default:null}},data:function(){return{counting:!0,isEmpty:!1,tagData:{earnings:0,isShow:!1,link:"",className:"course-tag",minDirectRewardRatio:0},bindAgencyRelation:{}}},computed:function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?v(Object(s),!0).forEach((function(e){Object(r.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({},Object(f.e)(["DrpSwitch"])),created:function(){this.showTagLink()},methods:{expire:function(){this.counting=!1},sellOut:function(){this.isEmpty=!0,this.$emit("goodsEmpty")},showTagLink:function(){this.DrpSwitch?(this.initTagData(),this.getAgencyBindRelation()):this.tagData.isShow=!1},getAgencyBindRelation:function(){var t=this;p.a.getAgencyBindRelation().then((function(e){e.agencyId?(t.bindAgencyRelation=e,t.tagData.isShow=!0):t.tagData.isShow=!1}))},initTagData:function(){var t=this;p.a.getDrpSetting().then((function(e){t.drpSetting=e,t.tagData.minDirectRewardRatio=e.minDirectRewardRatio;var s={type:"classroom",id:t.classroomId,merchant_id:t.drpSetting.merchantId};t.tagData.link=t.drpSetting.distributor_template_url+"?"+m.a.stringify(s);var i=t.drpSetting.minDirectRewardRatio/100*t.price;t.tagData.earnings=(Math.floor(100*i)/100).toFixed(2)}))}}},b=Object(c.a)(g,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-detail__head pos-rl"},[s("div",{staticClass:"course-detail__head--img"},[s("img",{attrs:{src:t.cover,alt:""}})]),t.seckillActivities&&t.counting&&!t.isEmpty&&"ongoing"===t.seckillActivities.status?s("countDown",{attrs:{activity:t.seckillActivities},on:{timesUp:t.expire,sellOut:t.sellOut}}):t._e(),s("tagLink",{attrs:{"tag-data":t.tagData}})],1)}),[],!1,null,null,null).exports,y=s("8807"),_=s("86ee"),w={name:"CourseSetList",components:{course:y.a,moreMask:_.a},props:{courseSets:{default:null},title:{default:""},defaulValue:{default:""},disableMask:{type:Boolean,default:!1},feedback:{type:Boolean,default:!0}},data:function(){return{maxShowNum:5}},computed:{partCourseSets:function(){return this.courseSets.slice(0,5)}},methods:{loadMore:function(){this.$emit("update:disableMask",!0)}}},O=Object(c.a)(w,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("e-panel",{attrs:{title:t.title,"need-flex":!1,"defaul-value":t.defaulValue}},[t.courseSets.length?[!t.disableMask&&t.courseSets.length>5?s("moreMask",{attrs:{"force-show":!0},on:{maskLoadMore:t.loadMore}},[t._l(t.partCourseSets,(function(e){return[s("course",{staticStyle:{"padding-left":"0","padding-right":"0"},attrs:{feedback:t.feedback,course:e}})]}))],2):[t._l(t.courseSets,(function(e){return[s("course",{staticStyle:{"padding-left":"0","padding-right":"0"},attrs:{feedback:t.feedback,course:e}})]}))]]:t._e()],2)}),[],!1,null,null,null).exports,C=(s("c5f6"),s("410d")),j=s("0d25");function S(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function k(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?S(Object(s),!0).forEach((function(e){Object(r.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var x={components:{service:C.a},filters:{filterPrice:function(t){return 0===Number(t)?"免费":"¥".concat(t)}},props:{details:{default:{}},joinStatus:{default:!1},showNumberData:{type:String,default:""}},watch:{learnExpiryHtml:{immediate:!0,handler:function(t){this.$emit("getLearnExpiry",{val:t})}}},computed:k(k({},Object(f.e)(["vipSwitch"])),{},{learnExpiryHtml:function(){var t=this.joinStatus,e=this.details.expiryValue,s=this.details.expiryMode;if(t)return"forever"==s?"长期有效":0!=t.deadline?t.deadline.slice(0,10)+"之前可学习":"永久有效";switch(s){case"forever":return"长期有效";case"date":var i=new Date(1e3*e);return Object(j.formatFullTime)(i).slice(0,10)+"之前可学习";case"days":return e+"天内可学习"}}}),methods:{toCertificate:function(){this.$router.push({path:"/certificate/list/".concat(this.$route.params.id)})}}},D=Object(c.a)(x,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"classroom-plan"},[s("e-panel",{attrs:{title:t.details.title,type:t.$route.query.hasCertificate}},[s("div",{staticClass:"course-detail__plan-price"},[s("span",{class:{isFree:0===Number(t.details.price)}},[t._v(t._s(t._f("filterPrice")(t.details.price)))]),"join"===t.showNumberData?s("span",{staticClass:"plan-price__student-num"},[s("i",{staticClass:"iconfont icon-people"}),t._v(t._s(t.details.studentNum))]):"visitor"===t.showNumberData?s("span",{staticClass:"plan-price__student-num"},[s("i",{staticClass:"iconfont icon-visibility"}),t._v(t._s(t.details.hitNum))]):t._e()])]),s("div",{staticClass:"course-detail__validity"},[t.details.vipLevel&&t.vipSwitch?s("div",{staticClass:"mb15"},[s("span",{staticClass:"mr20"},[t._v("会员免费")]),s("img",{staticClass:"vipIcon",attrs:{src:t.details.vipLevel.icon}}),s("router-link",{staticClass:"color-primary",attrs:{to:{path:"/vip",query:{id:t.details.vipLevel.id}}}},[t._v(t._s(t.details.vipLevel.name)+"免费学")])],1):t._e(),t.details.service.length?s("service",{attrs:{services:t.details.service}}):t._e(),s("div",[s("span",[t._v("学习有效期：")]),s("span",{domProps:{innerHTML:t._s(t.learnExpiryHtml)}})])],1),t.$route.query.hasCertificate?s("div",{staticClass:"course-detail__certificate",on:{click:t.toCertificate}},[t._m(0),s("i",{staticClass:"van-icon van-icon-arrow pull-right"})]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("span",{staticClass:"certificate-icon"},[this._v("证")]),this._v("证书")])}],!1,null,null,null).exports,P=s("b127"),T=s("2095"),I=s("4928"),E=s("326d"),L=s("faa5");function F(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function M(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?F(Object(s),!0).forEach((function(e){Object(r.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):F(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var N={components:{directory:P.a,detailHead:b,detailPlan:D,teacher:l,courseSetList:O,infoCollection:I.a,Reviews:E.a},props:["details","planDetails"],data:function(){return{headBottom:0,active:1,scrollFlag:!1,tabs:["班级介绍","班级课程"],tabsClass:"",errorMsg:"",classroomSettings:{},isShowForm:!1,paramsList:{action:"buy_after",targetType:"classroom",targetId:this.details.classId},showNumberData:""}},mixins:[T.a],computed:M({},Object(f.e)("classroom",{currentJoin:function(t){return t.currentJoin}})),created:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getSettings({query:{type:"classroom"}}).catch((function(t){}));case 2:t.classroomSettings=e.sent,t.getGoodSettings();case 4:case"end":return e.stop()}}),e)})))()},watch:{currentJoin:{handler:function(t,e){var s=this;if(t){i.a.loading({duration:0,message:"加载中...",forbidClick:!0});var r={action:"buy_after",targetType:"classroom",targetId:this.details.classId};this.getInfoCollectionEvent(r).then((function(t){if(Object.keys(t).length)return s.userInfoCollect=t,void s.getInfoCollectionForm(t.id).then((function(t){s.isShowForm=!0,i.a.clear()}));i.a.clear()}))}},immediate:!0},$route:function(t,e){this.resetFrom()}},mounted:function(){window.addEventListener("touchmove",this.handleScroll),this.showDialog()},destroyed:function(){window.removeEventListener("touchmove",this.handleScroll)},methods:M(M({},Object(f.d)("classroom",{setCurrentJoin:L.p})),{},{gotoGoodsPage:function(){this.$router.push({path:"/goods/".concat(this.details.goodsId,"/show")})},showDialog:function(){var t=this,e="",s="",r=function(){};if(this.details.member&&(this.details.member.access&&(e=this.details.member.access.code),e&&"success"!==e))if(this.errorMsg=this.getErrorMsg(e),"classroom.expired"===e||"member.expired"===e){s="班级已到期，无法继续学习，是否退出";var a={id:this.details.classId};r=function(){p.a.deleteClassroom({query:a}).then((function(t){t.success?window.location.reload():i.a.fail("退出班级失败，请稍后重试")}))},this.callConfirm(s,r)}else"vip.member_expired"===e?(s="会员已到期，请及时续费会员",r=function(){t.$router.push({path:"/vip"})},this.callConfirm(s,r)):i.a.fail(this.getErrorMsg(e))},handleScroll:function(){var t=this;if(!this.scrollFlag){this.scrollFlag=!0;var e=this.$refs;setTimeout((function(){t.headBottom=e.head.$el.getBoundingClientRect().bottom,t.scrollFlag=!1,t.tabsClass=t.headBottom<=0?"van-tabs--fixed":""}),400)}},getErrorMsg:function(t){switch(t){case"classroom.not_found":return"当前班级不存在";case"classroom.unpublished":return"当前班级未发布";case"classroom.expired":return"当前班级已过期";case"user.not_login":return"用户未登录";case"user.locked":return"用户被锁定";case"member.not_found":return"用户未加入班级";case"member.auditor":return"用户是旁听生，请前往商品页购买";case"member.expired":return"班级已过期";case"vip.vip_closed":return"网校已关闭会员功能";case"vip.not_login":return"用户未登录";case"vip.not_member":return"当前用户并不是vip";case"vip.member_expired":return"用户会员服务已过期";case"vip.level_not_exist":return"用户会员等级或班级会员不存在";case"vip.level_low":return"用户会员等级过低";default:return"异常错误"}},callConfirm:function(t,e){a.a.confirm({message:t,title:""}).then((function(){e()})).catch((function(){}))},onCancelForm:function(){this.setCurrentJoin(!1),this.isShowForm=!1},getGoodSettings:function(){var t=this;p.a.getSettings({query:{type:"goods"}}).then((function(e){t.showNumberData=e.show_number_data}))}})},$=Object(c.a)(N,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-detail classroom-detail"},[s("div",{staticClass:"join-after"},[s("detail-head",{ref:"head",attrs:{cover:t.details.cover,price:t.planDetails.price,"classroom-id":t.details.classId}}),s("van-tabs",{class:t.tabsClass,model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,(function(t){return s("van-tab",{key:t,attrs:{title:t}})})),1),s("div",{directives:[{name:"show",rawName:"v-show",value:0==t.active,expression:"active == 0"}]},[s("detail-plan",{attrs:{details:t.planDetails,"join-status":t.details.joinStatus,showNumberData:t.showNumberData}}),s("div",{staticClass:"segmentation"}),s("e-panel",{ref:"about",staticClass:"about",attrs:{title:"班级介绍"}},[s("div",{domProps:{innerHTML:t._s(t.details.summary)}})]),s("div",{staticClass:"segmentation"}),s("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.teachers,title:"教师介绍"}}),s("div",{staticClass:"segmentation"}),s("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.headTeacher?[t.details.headTeacher]:[],title:"班主任","defaul-value":"尚未设置班主任"}}),s("div",{staticClass:"segmentation"}),s("reviews",{attrs:{details:t.details}}),s("div",{staticClass:"segmentation"}),s("div",{staticClass:"segmentation"}),s("div",{staticClass:"segmentation"})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:1==t.active,expression:"active == 1"}]},[s("course-set-list",{ref:"course",attrs:{feedback:!t.errorMsg,"course-sets":t.details.courses,"disable-mask":!0,title:"班级课程","defaul-value":"暂无课程"},nativeOn:{click:function(e){return t.showDialog(e)}}})],1)],1),s("van-action-sheet",{staticClass:"minHeight50",attrs:{title:t.userInfoCollectForm.formTitle,"close-on-click-overlay":!1,"safe-area-inset-bottom":!0},on:{cancel:t.onCancelForm},model:{value:t.isShowForm,callback:function(e){t.isShowForm=e},expression:"isShowForm"}},[s("info-collection",{attrs:{userInfoCollectForm:t.userInfoCollectForm,formRule:t.userInfoCollectForm.items},on:{submitForm:t.onCancelForm}})],1),0==t.active&&this.details.goodsId?s("e-footer",{nativeOn:{click:function(e){return t.gotoGoodsPage(e)}}},[t._v("\n    去商品页\n  ")]):t._e()],1)}),[],!1,null,null,null).exports,A=s("d0b2"),R=s("49a2"),J=s("d863"),q=s("8b9d"),B=s("a262");function H(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function V(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?H(Object(s),!0).forEach((function(e){Object(r.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):H(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var U={components:{directory:P.a,detailHead:b,detailPlan:D,teacher:l,courseSetList:O,reviewList:A.a,moreMask:_.a,onsale:R.a,infoCollection:I.a},mixins:[J.a,q.a,B.a,T.a],props:["details","planDetails"],data:function(){return{tops:{aboutTop:0,courseTop:0,reviewTop:0},active:0,scrollFlag:!1,tabs:["班级介绍","班级课程","学员评价"],tabsClass:"",loadMoreAbout:!1,disableMask:!1,learnExpiry:"长期有效",unreceivedCoupons:[],miniCoupons:[],marketingActivities:{seckill:{}},isEmpty:!0,scrollTime:null,isManualSwitch:!1,classroomSettings:{},isShowForm:!1}},watch:{$route:function(t,e){this.resetFrom()}},computed:V(V({},Object(f.e)(["couponSwitch","user"])),{},{accessToJoin:function(){return"success"===this.details.access.code||"user.not_login"===this.details.access.code},vipAccessToJoin:function(){var t=!1;return!(!this.details.vipLevel||!this.user.vip)&&(this.details.vipLevel.seq<=this.user.vip.seq&&(t=!(new Date(this.user.vip.deadline).getTime()<(new Date).getTime())),t)},showOnsale:function(){return 0!==Number(this.planDetails.price)&&!!(this.unreceivedCoupons.length||Object.keys(this.marketingActivities).length&&!this.onlySeckill)},onlySeckill:function(){return 1===Object.keys(this.marketingActivities).length&&this.marketingActivities.seckill},seckillStatus:function(){var t=this.marketingActivities.seckill;return Object(j.dateTimeDown)(new Date(t.endTime).getTime())},showSeckill:function(){var t=this.marketingActivities.seckill;return 0!==Number(this.planDetails.price)&&t&&"ongoing"===t.status&&!this.isEmpty}}),created:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getSettings({query:{type:"classroom"}}).catch((function(t){}));case 2:t.classroomSettings=e.sent;case 3:case"end":return e.stop()}}),e)})))()},mounted:function(){var t=this;this.couponSwitch&&p.a.searchCoupon({params:{targetId:this.details.classId,targetType:"classroom"}}).then((function(e){t.unreceivedCoupons=e.data,t.miniCoupons=t.unreceivedCoupons.length>3?t.unreceivedCoupons.slice(0,4):t.unreceivedCoupons})).catch((function(t){})),p.a.classroomsActivities({query:{id:this.details.classId}}).then((function(e){t.marketingActivities=e,t.isEmpty=!e.seckill||!+e.seckill.productRemaind})).catch((function(t){})),window.addEventListener("touchmove",this.handleScroll),window.addEventListener("scroll",this.handleScroll),setTimeout((function(){window.scrollTo(0,0)}),100)},destroyed:function(){window.removeEventListener("touchmove",this.handleScroll),window.removeEventListener("scroll",this.handleScroll)},methods:V(V({},Object(f.d)("classroom",{setCurrentJoinClass:L.p})),{},{onTabClick:function(t,e){var s=this;this.isManualSwitch=!0;var i=this.$refs[this.transIndex2Tab(t)];window.scrollTo(0,i.$el.offsetTop-44),setTimeout((function(){return s.isManualSwitch=!1}),500)},transIndex2Tab:function(t){return["about","course","review"][t]},handleScroll:function(){var t=this;if(!this.scrollFlag){this.scrollFlag=!0;var e=this.$refs,s=["about","course","review"].reverse();this.scrollTime&&clearTimeout(this.scrollTime),this.scrollTime=setTimeout((function(){Object.keys(e).forEach((function(s){t.tops["".concat(s,"Top")]=e[s].$el.getBoundingClientRect().top})),t.scrollFlag=!1,t.tabsClass=t.tops.aboutTop-44<=0?"van-tabs--fixed":"",t.setCurrentActive(s)}),400)}},setCurrentActive:function(t){if(!this.isManualSwitch){for(var e=0;e<t.length;e++)if(!(this.tops["".concat(t[e],"Top")]-44>0))return void(this.active=t.length-e-1);this.active=0}},handleJoin:function(){var t=this.vipAccessToJoin;if(this.accessToJoin||t){var e=this.details,s=this.planDetails,i=1===Number(e.buyable)||0==+s.price||t;this.$store.state.token?i&&(!+s.price||t?this.collectUseInfoEvent():this.$router.push({name:"order",params:{id:e.classId},query:{expiryScope:this.learnExpiry,targetType:"classroom"}})):this.$router.push({name:"login",query:{redirect:this.redirect}})}},joinFreeClass:function(){var t=this;p.a.joinClass({query:{classroomId:this.details.classId}}).then((function(e){t.setCurrentJoinClass(!0),i.a.clear(),t.details.joinStatus=e})).catch((function(t){}))},getLearnExpiry:function(t){var e=t.val;this.learnExpiry=e},sellOut:function(){this.isEmpty=!0},getParamsList:function(){this.paramsList={action:"buy_before",targetType:"classroom",targetId:this.details.classId}},collectUseInfoEvent:function(){var t=this;this.hasUserInfoCollectForm?this.isShowForm=!0:(i.a.loading({duration:0,message:"加载中...",forbidClick:!0}),this.getParamsList(),this.getInfoCollectionEvent(this.paramsList).then((function(e){if(Object.keys(e).length)return t.userInfoCollect=e,void t.getInfoCollectionForm(e.id).then((function(e){t.isShowForm=!0,i.a.clear()}));t.joinFreeClass()})))}})},G=Object(c.a)(U,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-detail classroom-detail"},[s("div",{staticClass:"join-before"},[s("detail-head",{attrs:{cover:t.details.cover,price:t.planDetails.price,"classroom-id":t.details.classId,"seckill-activities":t.marketingActivities.seckill},on:{goodsEmpty:t.sellOut}}),s("detail-plan",{attrs:{details:t.planDetails,"join-status":t.details.joinStatus},on:{getLearnExpiry:t.getLearnExpiry}}),s("div",{staticClass:"segmentation"}),t.showOnsale?[s("onsale",{attrs:{"unreceived-coupons":t.unreceivedCoupons,"mini-coupons":t.miniCoupons,activities:t.marketingActivities}}),s("div",{staticClass:"segmentation"})]:t._e(),s("van-tabs",{class:t.tabsClass,on:{click:t.onTabClick},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,(function(t){return s("van-tab",{key:t,attrs:{title:t}})})),1),s("e-panel",{ref:"about",staticClass:"about",attrs:{title:"班级介绍"}},[s("more-mask",{attrs:{disabled:t.loadMoreAbout},on:{maskLoadMore:function(e){t.loadMoreAbout=!0}}},[s("div",{domProps:{innerHTML:t._s(t.details.summary)}})])],1),s("div",{staticClass:"segmentation"}),s("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.teachers,title:"教师介绍"}}),s("div",{staticClass:"segmentation"}),s("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.headTeacher?[t.details.headTeacher]:[],title:"班主任","defaul-value":"尚未设置班主任"}}),s("div",{staticClass:"segmentation"}),s("course-set-list",{ref:"course",attrs:{"course-sets":t.details.courses,"disable-mask":t.disableMask,title:"班级课程","defaul-value":"暂无课程"},on:{"update:disableMask":function(e){t.disableMask=e},"update:disable-mask":function(e){t.disableMask=e}}}),s("div",{staticClass:"segmentation"}),s("review-list",{ref:"review",attrs:{"target-id":t.details.classId,reviews:1==t.classroomSettings.show_review?t.details.reviews:[],title:"学员评价",type:"classroom","defaul-value":"暂无评价"}}),s("van-action-sheet",{staticClass:"minHeight50",attrs:{title:t.userInfoCollectForm.formTitle,"close-on-click-overlay":!1,"safe-area-inset-bottom":!0},model:{value:t.isShowForm,callback:function(e){t.isShowForm=e},expression:"isShowForm"}},[s("info-collection",{attrs:{userInfoCollectForm:this.userInfoCollectForm,formRule:this.userInfoCollectForm.items},on:{submitForm:t.joinFreeClass}})],1),!t.marketingActivities.seckill||t.marketingActivities.seckill&&(t.isEmpty||"已到期"===t.seckillStatus)||0==t.planDetails.price?s("e-footer",{attrs:{disabled:!t.accessToJoin},nativeOn:{click:function(e){return t.handleJoin(e)}}},[t._v("\n      "+t._s(t._f("filterJoinStatus")(t.details.access.code,"classroom",t.vipAccessToJoin)))]):t._e(),t.showSeckill&&"已到期"!==t.seckillStatus?s("div",[s("e-footer",{attrs:{disabled:!t.accessToJoin,half:"true"},nativeOn:{click:function(e){return t.handleJoin(e)}}},[t._v(t._s(t._f("filterJoinStatus")(t.details.access.code,"classroom",t.vipAccessToJoin)))]),s("e-footer",{attrs:{half:"true"},nativeOn:{click:function(e){return t.activityHandle(t.marketingActivities.seckill.id)}}},[t._v("去秒杀")])],1):t._e()],2)])}),[],!1,null,null,null).exports;function z(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}var K={components:{},data:function(){return{details:{isEmpty:!0,summary:"",joinStatus:!1,courses:[],teachers:[],assistants:[],headTeacher:{},access:{code:"加载中"},cover:"",reviews:[],myReview:null,classId:0,vipLevel:null},planDetails:{title:"",service:[],price:"0",studentNum:0,expiryMode:"forever",expiryValue:"0",vipLevel:null,hitNum:"0"},currentComp:""}},computed:function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?z(Object(s),!0).forEach((function(e){Object(r.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):z(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({},Object(f.e)({isLoading:function(t){return t.isLoading}})),watch:{"details.joinStatus":{handler:function(t){this.getComponent(t)}}},created:function(){var t=this,e=this.$route.params.id;p.a.getClassroomDetail({query:{classroomId:e}}).then((function(e){e.member?(t.getComponent(e.member),t.getDetails(e)):t.$router.push({path:"/goods/".concat(e.goodsId,"/show")})})).catch((function(t){i.a.fail(t.message)}))},methods:{getDetails:function(t){var e=0===Object.keys(t).length,s=t.about,i=!e&&t.member,r=t.courses,a=t.teachers,o=t.assistants,n=t.buyable,c=t.vipLevel,l=t.headTeacher,u=t.access,d=t.reviews,p=t.myReview,h=t.expiryMode,m=t.member,f=t.expiryValue,v=t.title,g=t.price,b=t.studentNum,y=t.service,_=t.goodsId,w=t.specsId,O=t.hitNum,C=t.cover.large,j=t.id,S={title:v,service:y,price:g,studentNum:b,expiryMode:h,expiryValue:f,vipLevel:c,hitNum:O};this.planDetails=S,this.details={summary:s,joinStatus:i,isEmpty:e,courses:r,classId:j,buyable:n,vipLevel:c,teachers:a,assistants:o,headTeacher:l,access:u,cover:C,reviews:d,myReview:p,member:m,goodsId:_,specsId:w}},getComponent:function(t){this.currentComp=t?$:G}}},Q=Object(c.a)(K,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"course-detail"},[this.isLoading?e("e-loading"):this._e(),e(this.currentComp,{tag:"component",attrs:{details:this.details,"plan-details":this.planDetails}})],1)}),[],!1,null,null,null);e.default=Q.exports}}]);