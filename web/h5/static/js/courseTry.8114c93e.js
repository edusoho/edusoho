(window.webpackJsonp=window.webpackJsonp||[]).push([["courseTry"],{"202a":function(e,t,i){"use strict";i("8e6e"),i("ac6a"),i("456d"),i("e17f");var n=i("2241"),r=(i("e7e5"),i("d399")),s=(i("c5f6"),i("96cf"),i("3b8d")),a=(i("6762"),i("2fdb"),i("7f7f"),i("bd86")),o=i("32e6"),c=i.n(o),u=i("2f62"),d=i("3ce7"),l=i("fd23"),p=i("bced"),h=i("4328"),f=i.n(h);function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var v={components:{countDown:l.a,tagLink:p.a},props:{courseSet:{type:Object,default:function(){return{}}},seckillActivities:{type:Object,default:null}},data:function(){return{isEncryptionPlus:!1,mediaOpts:{},isCoverOpen:!1,isPlaying:!1,player:null,counting:!0,isEmpty:!1,tagData:{earnings:0,isShow:!1,link:"",className:"course-tag",minDirectRewardRatio:0},bindAgencyRelation:{}}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(i,!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},Object(u.d)("course",{sourceType:function(e){return e.sourceType},selectedPlanId:function(e){return e.selectedPlanId},taskId:function(e){return e.taskId},details:function(e){return e.details},joinStatus:function(e){return e.joinStatus},user:function(e){return e.user}}),{textContent:function(){return this.mediaOpts.text}}),watch:{taskId:function(e,t){("course"!==this.$route.name||this.joinStatus)&&e>0&&this.initHead()}},created:function(){this.initHead(),this.showTagLink(),this.initTagData()},methods:{initHead:function(){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.initPlayer())},viewAudioDoc:function(){this.isCoverOpen=!0},hideAudioDoc:function(){this.isCoverOpen=!1},handlePlayer:function(){return this.isPlaying?this.player&&this.player.pause():this.player&&this.player.play()},getParams:function(){return this.joinStatus?{query:{courseId:this.selectedPlanId,taskId:this.taskId}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1}}},initPlayer:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){var t,i,s,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.$refs.video&&(this.$refs.video.innerHTML=""),e.next=3,d.a.getMedia(this.getParams()).catch((function(e){var t=Number(o.details.id);4040101==e.code&&o.$router.push({name:"login",query:{redirect:"/course/".concat(t)}}),r.a.fail(e.message)}));case 3:if(t=e.sent){e.next=7;break}return e.abrupt("return");case 7:if("video"!==t.mediaType||t.media.url){e.next=10;break}return Object(r.a)("课程内容准备中，请稍候查看"),e.abrupt("return");case 10:if(i=t.media.timeLimit,this.isEncryptionPlus=t.media.isEncryptionPlus,!t.media.isEncryptionPlus){e.next=15;break}return Object(r.a)("该浏览器不支持云视频播放，请下载App"),e.abrupt("return");case 15:s=t.media,a={id:"course-detail__head--video",user:this.user,playlist:s.url,autoplay:!0,disableFullscreen:"audio"===this.sourceType,isAudio:"audio"===this.sourceType,strictMode:!s.supportMobile,pluck:{timelimit:i},resId:s.resId,disableDataUpload:!0},!this.joinStatus&&Number(this.details.tryLookable)||delete a.pluck,this.mediaOpts=Object.assign({text:t.media.text},a),this.$store.commit("UPDATE_LOADING_STATUS",!0),this.loadPlayerSDK().then((function(e){o.$store.commit("UPDATE_LOADING_STATUS",!1);var t=new e(a);t.on("playing",(function(){o.isPlaying=!0})),t.on("unablePlay",(function(){o.$refs.video.innerHTML="",n.a.alert({message:"当前内容不支持该手机浏览器观看，建议您使用Chrome、Safari浏览器观看。"}).then((function(){}))})),t.on("paused",(function(){o.isPlaying=!1})),o.player=t}));case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),loadPlayerSDK:function(){if(!window.VideoPlayerSDK){var e="//service-cdn.qiqiuyun.net/js-sdk/video-player/sdk-v1.js?v="+Date.now()/1e3/60;return new Promise((function(t,i){c()(e,(function(e){e&&i(e),t(window.VideoPlayerSDK)}))}))}return Promise.resolve(window.VideoPlayerSDK)},expire:function(){this.counting=!1},sellOut:function(){this.isEmpty=!0,this.$emit("goodsEmpty")},showTagLink:function(){var e=this;d.a.hasDrpPluginInstalled().then((function(t){t.Drp?d.a.getAgencyBindRelation().then((function(t){t.agencyId?(e.bindAgencyRelation=t,e.tagData.isShow=!0):e.tagData.isShow=!1})):e.tagData.isShow=!1}))},initTagData:function(){var e=this;d.a.getDrpSetting().then((function(t){e.drpSetting=t,e.tagData.minDirectRewardRatio=t.minDirectRewardRatio;var i={type:"course",id:e.details.id,merchant_id:e.drpSetting.merchantId};e.tagData.link=e.drpSetting.distributor_template_url+"?"+f.a.stringify(i);var n=e.drpSetting.minDirectRewardRatio/100*e.details.price;e.tagData.earnings=(Math.floor(100*n)/100).toFixed(2)}))}}},m=i("0c7c"),g=Object(m.a)(v,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"course-detail__head pos-rl",attrs:{id:"course-detail__head"}},[e.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(e.sourceType)&&!e.isEncryptionPlus&&!e.isCoverOpen,expression:"['audio'].includes(sourceType) && !isEncryptionPlus && !isCoverOpen"}],staticClass:"course-detail__nav--btn",on:{click:e.viewAudioDoc}},[e._v("\n    文稿\n  ")]):e._e(),e.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(e.sourceType)&&!e.isEncryptionPlus,expression:"['audio'].includes(sourceType) && !isEncryptionPlus"}],staticClass:"course-detail__nav--cover web-view",class:{opened:e.isCoverOpen}},[i("div",{staticClass:"media-text",domProps:{innerHTML:e._s(e.textContent)}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isCoverOpen,expression:"isCoverOpen"}],staticClass:"course-detail__nav--cover-control",on:{click:e.handlePlayer}},[i("i",{staticClass:"h5-icon",class:e.isPlaying?"h5-icon-zanting":"h5-icon-bofang"})]),i("div",{staticClass:"course-detail__nav--cover-close-btn",on:{click:e.hideAudioDoc}},[i("i",{staticClass:"van-icon van-icon-arrow van-nav-bar__arrow"})])]):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"img"===e.sourceType||e.isEncryptionPlus,expression:"sourceType === 'img' || isEncryptionPlus"}],staticClass:"course-detail__head--img",attrs:{id:"course-detail__head--img"}},[e.courseSet.cover?i("img",{attrs:{src:e.courseSet.cover.large,alt:""}}):e._e(),e.seckillActivities&&"ongoing"===e.seckillActivities.status&&e.counting&&!e.isEmpty?i("countDown",{attrs:{activity:e.seckillActivities},on:{timesUp:e.expire,sellOut:e.sellOut}}):e._e()],1),i("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(e.sourceType)&&!e.isEncryptionPlus,expression:"['video', 'audio'].includes(sourceType) && !isEncryptionPlus"}],ref:"video",attrs:{id:"course-detail__head--video"}}),i("tagLink",{attrs:{"tag-data":e.tagData}})],1)}),[],!1,null,null,null);t.a=g.exports},"32e6":function(e,t){function i(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function n(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}e.exports=function(e,t,r){var s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");"function"==typeof t&&(r=t,t={}),t=t||{},r=r||function(){},a.type=t.type||"text/javascript",a.charset=t.charset||"utf8",a.async=!("async"in t)||!!t.async,a.src=e,t.attrs&&function(e,t){for(var i in t)e.setAttribute(i,t[i])}(a,t.attrs),t.text&&(a.text=""+t.text),("onload"in a?i:n)(a,r),a.onload||i(a,r),s.appendChild(a)}},"4c51":function(e,t,i){"use strict";i.r(t),i("8e6e"),i("ac6a"),i("456d");var n=i("bd86"),r=i("b127"),s=i("202a"),a=i("2f62"),o=i("faa5");function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var u={components:{Directory:r.a,DetailHead:s.a},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(i,!0).forEach((function(t){Object(n.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},Object(a.d)("course",{details:function(e){return e.details}}),{},Object(a.d)({isLoading:function(e){return e.isLoading}})),beforeRouteLeave:function(e,t,i){this.$store.commit("course/".concat(o.n),{sourceType:"img"}),i()}},d=i("0c7c"),l=Object(d.a)(u,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"course-detail try"},[this.isLoading?t("e-loading"):this._e(),t("detail-head",{attrs:{"course-set":this.details.courseSet}}),t("directory",{attrs:{"hidde-title":!0,"course-items":this.details.courseItems}})],1)}),[],!1,null,null,null);t.default=l.exports}}]);