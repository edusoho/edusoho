webpackJsonp([3,4],{P8if:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("Dd8w"),a=s.n(i),r=s("jW8y"),n=s("gMS5"),c=s("NYxO"),o=s("Du/2"),l={components:{Directory:r.a,DetailHead:n.a},computed:a()({},Object(c.mapState)("course",{details:function(e){return e.details}}),Object(c.mapState)({isLoading:function(e){return e.isLoading}})),beforeRouteLeave:function(e,t,s){this.$store.commit("course/"+o.h,{sourceType:"img"}),s()}},u={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"course-detail try"},[this.isLoading?t("e-loading"):this._e(),this._v(" "),t("detail-head",{attrs:{courseSet:this.details.courseSet}}),this._v(" "),t("directory",{attrs:{hiddeTitle:!0,courseItems:this.details.courseItems}})],1)},staticRenderFns:[]},d=s("VU/8")(l,u,!1,null,null,null);t.default=d.exports},f0vb:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("fZjL"),a=s.n(i),r=s("Dd8w"),n=s.n(r),c=s("jW8y"),o=s("gMS5"),l=s("Du/2"),u=s("NYxO"),d=(s("P8if"),{data:function(){return{items:[],isFree:!1}},filters:{filterTime:function(e){var t=new Date(e);return t.getFullYear()+"-"+("0"+t.getMonth()).slice(-2)+"-"+("0"+t.getDate()).slice(-2)}},watch:{selectedPlanId:{immediate:!0,handler:function(e){var t=this;this.items=this.details.courses.map(function(e,s){return t.$set(e,"active",!1),e.id===t.details.id&&(e.active=!0),e})}}},computed:n()({},Object(u.mapState)("course",{details:function(e){return e.details},selectedPlanId:function(e){return e.selectedPlanId}}),{learnExpiry:function(){var e=this.details.member,t=this.details.learningExpiryDate,s=this.details.learningExpiryDate.expiryMode;if(e)return"forever"==s?"永久有效":0!=e.deadline?e.deadline.slice(0,10)+"之前可学习":"永久有效";switch(s){case"forever":return"永久有效";case"end_date":return this.details.learningExpiryDate.expiryEndDate.slice(0,10)+"之前可学习";case"days":return this.details.learningExpiryDate.expiryDays+"天内可学习";case"date":return'<div class = "mt5">开课日期：'+t.expiryStartDate.slice(0,10)+"&nbsp;&nbsp;&nbsp;截止日期："+t.expiryEndDate.slice(0,10)+"</div>"}}}),methods:n()({},Object(u.mapActions)("course",["getCourseDetail"]),{handleClick:function(e,t){this.items.map(function(e){return e.active=!1}),e.active=!0,this.getCourseDetail({courseId:e.id})},filterPrice:function(){var e=this.details;return Number(e.isFree)||"0.00"===e.price?(this.isFree=!0,"免费"):(this.isFree=!1,"¥"+e.price)}})}),p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("e-panel",{attrs:{title:e.details.courseSet.title}},[s("div",{staticClass:"course-detail__plan-price"},[s("span",{class:{isFree:e.isFree}},[e._v(e._s(e.filterPrice()))]),e._v(" "),s("span",[e._v(e._s(e.details.studentNum)+"人在学")])])]),e._v(" "),s("ul",{staticClass:"course-detail__plan"},e._l(e.items,function(t,i){return t.title?s("li",{class:{active:t.active},on:{click:function(s){e.handleClick(t,i)}}},[e._v(e._s(t.title))]):e._e()})),e._v(" "),s("div",{staticClass:"course-detail__validity"},[s("div",[s("span",{staticClass:"mr20"},[e._v("学习有效期")]),e._v(" "),s("span",{staticClass:"dark",domProps:{innerHTML:e._s(e.learnExpiry)}})]),e._v(" "),0!=e.details.buyExpiryTime?s("div",{staticClass:"mt5"},[s("span",{staticClass:"mr20"},[e._v("购买截止日期")]),e._v(" "),s("span",{staticClass:"validity orange"},[e._v(e._s(e._f("filterTime")(e.details.buyExpiryTime)))])]):e._e()])],1)},staticRenderFns:[]},h=s("VU/8")(d,p,!1,null,null,null).exports,v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("e-panel",{attrs:{title:"教师介绍"}},[e._l(e.teacherInfo,function(t){return[s("div",{staticClass:"teacher-content"},[s("img",{staticClass:"teacher-avatar-img",attrs:{src:t.avatar.large}}),e._v(" "),s("div",{staticClass:"teacher-cell"},[s("span",{staticClass:"dark font-family-PFM"},[e._v(e._s(t.nickname))]),e._v(" "),s("span",{staticClass:"text-content"},[e._v(e._s(t.title||"暂无简介"))])])])]})],2)},staticRenderFns:[]},f=s("VU/8")({name:"teacher",props:["teacherInfo"]},v,!1,null,null,null).exports,m=this,_={props:["details"],data:function(){return{active:0,tabs:["课程目录","课程简介"]}},computed:n()({progress:function(){return Number(this.details.publishedTaskNum)?parseInt(this.details.progress.percent)+"%":"0%"}},Object(u.mapState)("course",{selectedPlanId:function(e){return e.selectedPlanId}})),watch:{selectedPlanId:function(e,t){e!==t&&(m.active=0),console.log(m.active,"active")}},components:{Directory:c.a,DetailHead:o.a,DetailPlan:h,Teacher:f},methods:{onTabClick:function(){console.log("click")}}},y={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"join-after"},[s("detail-head",{attrs:{courseSet:e.details.courseSet}}),e._v(" "),s("van-tabs",{staticClass:"after-tabs",on:{click:e.onTabClick},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},e._l(e.tabs,function(e){return s("van-tab",{key:e,attrs:{title:e}})})),e._v(" "),s("div",{staticClass:"join-after__content"},[e.active?[s("detail-plan"),e._v(" "),s("div",{staticClass:"segmentation"}),e._v(" "),s("e-panel",{attrs:{title:"课程介绍"}},[s("div",{domProps:{innerHTML:e._s(e.details.courseSet.summary)}})]),e._v(" "),s("div",{staticClass:"segmentation"}),e._v(" "),s("teacher",{staticClass:"teacher",attrs:{teacherInfo:e.details.teachers}})]:[s("div",{staticClass:"progress-bar"},[s("div",{staticClass:"progress-bar__content"},[s("div",{staticClass:"progress-bar__rate",style:{width:e.progress}})]),e._v(" "),s("div",{staticClass:"progress-bar__text"},[e._v(e._s(e.progress))])]),e._v(" "),s("directory",{staticClass:"join-after-dirctory",attrs:{hiddeTitle:!0,tryLookable:e.details.tryLookable,courseItems:e.details.courseItems}})]],2)],1)},staticRenderFns:[]},b=s("VU/8")(_,y,!1,null,null,null).exports,k={name:"joinBefore",data:function(){return{teacherInfo:{},tabs:["课程介绍","教师介绍","目录"],active:0,tabsClass:"",tops:{tabsTop:0,teacherTop:0,aboutTop:0}}},components:{Teacher:f,Directory:c.a,DetailHead:o.a,DetailPlan:h},computed:n()({},Object(u.mapState)("course",{details:function(e){return e.details}}),{summary:function(){return this.details.summary?this.details.summary:this.details.courseSet.summary}}),mounted:function(){var e=this,t=this.$refs;window.addEventListener("touchmove",this.handleTouch),window.addEventListener("scroll",this.handleScroll),setTimeout(function(){window.scrollTo(0,0),a()(t).forEach(function(s){e.tops[s+"Top"]=t[s].$el.getBoundingClientRect().top}),console.log(e.tops)},100)},methods:n()({},Object(u.mapActions)("course",["joinCourse"]),{onTabClick:function(e,t){var s=this.$refs[this.transIndex2Tab(e)];window.scrollTo(0,s.$el.offsetTop-44)},transIndex2Tab:function(e){return e?e>1?"directory":"teacher":"about"},handleTouch:function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;this.active=this.activeCurrentTab(e),e>=this.tops.tabsTop?this.tabsClass="van-tabs--fixed":this.tabsClass=""},activeCurrentTab:function(e){var t=this.tops;return(e+=44)<t.teacherTop?0:e>=t.directoryTop?2:1},handleJoin:function(){var e=this.details.learningExpiryDate.expiryEndDate,t=new Date(e).getTime(),s=(new Date).getTime(),i=s<t;i=0==e||s<t,this.$store.state.token?Number(this.details.buyable)&&i&&(+this.details.price?this.$router.push({path:"/order/"+this.details.id}):this.joinCourse({id:this.details.id})):this.$router.push({name:"login"})}}),destroyed:function(){window.removeEventListener("touchmove",this.handleScroll)}},T={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"join-before"},[s("detail-head",{attrs:{price:e.details.price,courseSet:e.details.courseSet}}),e._v(" "),s("detail-plan"),e._v(" "),s("div",{staticClass:"segmentation"}),e._v(" "),s("van-tabs",{ref:"tabs",class:e.tabsClass,on:{click:e.onTabClick},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},e._l(e.tabs,function(e){return s("van-tab",{key:e,attrs:{title:e}})})),e._v(" "),s("e-panel",{ref:"about",staticClass:"about",attrs:{title:"课程介绍"}},[s("div",{domProps:{innerHTML:e._s(e.summary)}})]),e._v(" "),s("div",{staticClass:"segmentation"}),e._v(" "),s("teacher",{ref:"teacher",staticClass:"teacher",attrs:{teacherInfo:e.details.teachers}}),e._v(" "),s("div",{staticClass:"segmentation"}),e._v(" "),s("directory",{ref:"directory",attrs:{courseItems:e.details.courseItems}}),e._v(" "),s("e-footer",{nativeOn:{click:function(t){return e.handleJoin(t)}}},[e._v("\n    "+e._s(e._f("filterJoinStatus")(e.details.access.code)))])],1)},staticRenderFns:[]},g=s("VU/8")(k,T,!1,null,null,null).exports,C=(s("gyMJ"),{components:{joinAfter:b,joinBefore:g},computed:n()({},Object(u.mapState)("course",{selectedPlanIndex:function(e){return e.selectedPlanIndex},joinStatus:function(e){return e.joinStatus},details:function(e){return e.details}}),Object(u.mapState)({isLoading:function(e){return e.isLoading}}),{isEmpty:function(){return 0===a()(this.details).length}}),created:function(){this.getCourseDetail({courseId:this.$route.params.id})},methods:n()({},Object(u.mapActions)("course",["getCourseDetail"]),Object(u.mapMutations)("course",{setSourceType:l.h})),beforeRouteLeave:function(e,t,s){this.setSourceType({sourceType:"img",taskId:-1}),s()}}),w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"course-detail"},[e.isLoading?s("e-loading"):e._e(),e._v(" "),e.joinStatus||e.isEmpty?e._e():s("join-before",{attrs:{details:e.details}}),e._v(" "),e.joinStatus&&!e.isEmpty?s("join-after",{attrs:{details:e.details}}):e._e()],1)},staticRenderFns:[]},S=s("VU/8")(C,w,!1,null,null,null);t.default=S.exports},gMS5:function(e,t,s){"use strict";var i=s("//Fk"),a=s.n(i),r=s("Xxa5"),n=s.n(r),c=(s("eqfM"),s("/QYm")),o=s("exGp"),l=s.n(o),u=s("Dd8w"),d=s.n(u),p=s("PirY"),h=s.n(p),v=s("NYxO"),f=s("gyMJ"),m={data:function(){return{isEncryptionPlus:!1}},props:{courseSet:{type:Object,default:{}}},computed:d()({},Object(v.mapState)("course",{sourceType:function(e){return e.sourceType},selectedPlanId:function(e){return e.selectedPlanId},taskId:function(e){return e.taskId},details:function(e){return e.details},joinStatus:function(e){return e.joinStatus},user:function(e){return e.user}})),watch:{taskId:{immediate:!0,handler:function(e,t){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.initPlayer())}}},methods:{getParams:function(){return!this.joinStatus&&Number(this.details.tryLookable)?{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId}}},initPlayer:function(){var e=this;return l()(n.a.mark(function t(){var s,i,a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$refs.video&&(e.$refs.video.innerHTML=""),t.next=3,f.a.getMedia(e.getParams());case 3:if(s=t.sent,e.isEncryptionPlus=s.media.isEncryptionPlus,!s.media.isEncryptionPlus){t.next=8;break}return Object(c.a)("该浏览器不支持云视频播放，请下载App"),t.abrupt("return");case 8:i=s.media,a={id:"course-detail__head--video",user:e.user,playlist:i.url,autoplay:!0},e.$store.commit("UPDATE_LOADING_STATUS",!0),e.loadPlayerSDK().then(function(t){e.$store.commit("UPDATE_LOADING_STATUS",!1);new t(a)});case 12:case"end":return t.stop()}},t,e)}))()},loadPlayerSDK:function(){if(!window.VideoPlayerSDK){var e="//service-cdn.qiqiuyun.net/js-sdk/video-player/sdk-v1.js?v="+Date.now()/1e3/60;return new a.a(function(t,s){h()(e,function(e){e&&s(e),t(window.VideoPlayerSDK)})})}return a.a.resolve(window.VideoPlayerSDK)}}},_={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"course-detail__head"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"img"===this.sourceType||this.isEncryptionPlus,expression:"sourceType === 'img' || isEncryptionPlus"}],staticClass:"course-detail__head--img"},[t("img",{attrs:{src:this.courseSet.cover.large,alt:""}})]),this._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(this.sourceType)&&!this.isEncryptionPlus,expression:"['video', 'audio'].includes(sourceType) && !isEncryptionPlus"}],ref:"video",attrs:{id:"course-detail__head--video"}})])},staticRenderFns:[]},y=s("VU/8")(m,_,!1,null,null,null);t.a=y.exports},jW8y:function(e,t,s){"use strict";s("eqfM");var i=s("/QYm"),a=s("Dd8w"),r=s.n(a),n=s("NYxO"),c=s("Du/2"),o={props:{courseItems:{type:Array,default:function(){return[]}},hiddeTitle:{type:Boolean,default:!1}},computed:r()({},Object(n.mapState)("course",{joinStatus:function(e){return e.joinStatus},selectedPlanId:function(e){return e.selectedPlanId},details:function(e){return e.details}})),data:function(){return{directoryArray:[],chapters:[],tasks:[]}},filters:{filterNumber:function(e){return"1"===e.task.isOptional?"选修":e.task.number}},watch:{selectedPlanId:{immediate:!0,handler:function(e){var t=this;this.details.courseItems.length&&(this.directoryArray=this.details.courseItems.map(function(e){return t.$set(e,"show",!0),"task"==e.type&&(e.status=t.getCurrentStatus(e.task)),e}),this.getTasks(this.directoryArray))}}},methods:r()({},Object(n.mapMutations)("course",{setSourceType:c.h}),{getTasks:function(e){var t=this,s=[];this.chapters=[],this.tasks=[],e.forEach(function(e){"chapter"!==e.type?s.push(e):(s.length>0?(t.tasks.push([].concat(s)),s=[]):t.chapters.length>0&&t.tasks.push([]),t.chapters.push(e))}),"chapter"!==e[e.length-1].type&&this.tasks.push(s),"chapter"!==e[0].type&&this.chapters.unshift({show:!0})},getCurrentStatus:function(e){return Number(this.details.tryLookable)&&"video"===e.type&&e.activity.mediaStorage?"is-tryLook":Number(e.isFree)?"is-free":""},filterTaskStatus:function(e){return this.details.member||"is-tryLook"!==e.status?this.details.member||"is-free"!==e.status?"":"免费":"试看"},lessonCellClick:function(e){var t=e.task,s=this.details;if(!s.allowAnonymousPreview&&this.$route.push({name:"login"}),!this.joinStatus&&Number(s.tryLookable)&&["is-tryLook","is-free"].includes(e.status))switch(t.type){case"video":case"audio":this.$router.push({name:"course_try"}),this.setSourceType({sourceType:t.type,taskId:t.id});break;case"doc":case"text":case"ppt":this.$router.push({name:"course_web",query:{courseId:this.selectedPlanId,taskId:t.id,type:t.type}});break;default:return Object(i.a)("请先加入课程")}else this.joinStatus?this.showTypeDetail(t):Object(i.a)("请先加入课程")},showTypeDetail:function(e){if("published"===e.status)switch(e.type){case"video":"self"===e.mediaSource?this.setSourceType({sourceType:"video",taskId:e.id}):Object(i.a)("暂不支持此类型");break;case"audio":this.setSourceType({sourceType:"audio",taskId:e.id});break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.selectedPlanId,taskId:e.id,type:e.type}});break;case"live":var t=new Date,s=new Date(1e3*e.endTime),a=(new Date(1e3*e.startTime),!1);if(t>s){if("videoGenerated"==e.activity.replayStatus)return void("self"===e.mediaSource?this.setSourceType({sourceType:"video",taskId:e.id}):Object(i.a)("暂不支持此类型"));if("ungenerated"==e.activity.replayStatus)return void Object(i.a)("暂无回放");a=!0}this.$router.push({name:"live",query:{courseId:this.selectedPlanId,taskId:e.id,type:e.type,title:e.title,replay:a}});break;default:Object(i.a)("暂不支持此类型")}else Object(i.a)("敬请期待")}})},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("e-panel",{staticClass:"directory",attrs:{title:"课程目录","hidde-title":e.hiddeTitle}},[0==e.courseItems.length?s("div",{staticClass:"empty"},[e._v("暂无学习任务")]):s("div",{staticClass:"directory-list"},e._l(e.chapters,function(t,i){return s("div",{staticClass:"directory-list__item"},["chapter"===t.type?s("div",{staticClass:"directory-list__item-chapter",on:{click:function(e){t.show=!t.show}}},[s("span",{staticClass:"text-overflow"},[e._v("第"+e._s(t.number)+"章："+e._s(t.title))]),e._v(" "),s("i",{class:[t.show?"icon-packup":"icon-unfold"]})]):e._e(),e._v(" "),e._l(e.tasks[i],function(i){return s("div",{class:["directory-list__item-unit",{"unit-show":t.show}]},["unit"===i.type?s("div",{staticClass:"lesson-cell__unit"},[e._v("\n          第"+e._s(i.number)+"节："+e._s(i.title)+"\n        ")]):e._e(),e._v(" "),"task"===i.type?s("div",{class:["box",{"show-box":t.show}]},[s("div",{staticClass:"lesson-cell"},[s("span",{staticClass:"lesson-cell__number"},[e._v(e._s(e._f("filterNumber")(i)))]),e._v(" "),s("div",{staticClass:"lesson-cell__content",on:{click:function(t){e.lessonCellClick(i)}}},[s("span",[e._v(e._s(i.title))]),e._v(" "),s("span",[e._v(e._s(e._f("taskType")(i.task))+e._s(e._f("filterTask")(i.task)))])]),e._v(" "),s("div",{class:["lesson-cell__status",e.details.member?"":i.status]},[e._v("\n              "+e._s(e.filterTaskStatus(i))+"\n            ")])])]):e._e()])})],2)}))])},staticRenderFns:[]},u=s("VU/8")(o,l,!1,null,null,null);t.a=u.exports}});