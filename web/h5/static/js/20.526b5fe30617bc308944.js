webpackJsonp([20],{W4Yd:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r("eqfM");var a=r("/QYm"),n=r("Xxa5"),i=r.n(n),s=r("exGp"),u=r.n(s),o=r("Dd8w"),l=r.n(o),c=r("gyMJ"),f=r("NYxO"),d=r("Du/2"),h={data:function(){return{playUrl:"",requestCount:0}},mixins:[r("1JqO").a],computed:l()({},Object(f.mapState)("course",{joinStatus:function(e){return e.joinStatus}}),Object(f.mapState)({isLoading:function(e){return e.isLoading}})),mounted:function(){var e=this;return u()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.token){t.next=3;break}return e.$router.push({name:"login",query:{redirect:e.redirect}}),t.abrupt("return");case 3:e.handleLive();case 4:case"end":return t.stop()}},t,e)}))()},methods:l()({},Object(f.mapMutations)({setNavbarTitle:d.g}),{handleLive:function(){var e=this.$route.query,t=e.taskId,r=e.replay,a=e.title;this.setNavbarTitle(a),"true"!=r?this.requestLiveNo(t):this.getReplayUrl(t)},getReplayUrl:function(e){var t=this;c.a.getLiveReplayUrl({query:{taskId:e}}).then(function(e){e.nonsupport?Object(a.a)("回放暂不支持"):e.url?e.url.indexOf("/error/")>-1?Object(a.a)("暂无回放"):t.playUrl=e.url:e.error&&a.a.fail(e.error.message)}).catch(function(e){a.a.fail(e.message)})},requestLiveNo:function(e){var t=this;c.a.requestLiveNo({query:{taskId:e}}).then(function(r){r.no&&t.getLiveUrl(e,r.no),r.error&&a.a.fail(r.error.message)}).catch(function(e){a.a.fail(e.message)})},getLiveUrl:function(e,t){var r=this;this.requestCount++,c.a.getLiveUrl({query:{taskId:e,no:t}}).then(function(n){n.roomUrl?r.playUrl=n.roomUrl:r.requestCount<30?r.getLiveUrl(e,t):Object(a.a)("获取直播失败"),n.error&&a.a.fail(n.error.message)}).catch(function(e){a.a.fail(e.message)})}})},p={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"web-view"},[this.isLoading?t("e-loading"):this._e(),this._v(" "),t("iframe",{attrs:{id:"player",src:this.playUrl,width:"100%",frameborder:"0"}})],1)},staticRenderFns:[]},v=r("VU/8")(h,p,!1,null,null,null);t.default=v.exports}});