(window.webpackJsonp=window.webpackJsonp||[]).push([["testpaperIntro"],{"10ae":function(t,e,n){"use strict";var i=n("b56c");n.n(i).a},3025:function(t,e,n){"use strict";n.r(e),n("8e6e"),n("ac6a"),n("456d"),n("e17f");var i=n("2241"),r=(n("c5f6"),n("e7e5"),n("d399")),s=(n("7f7f"),n("bd86")),a=n("3ce7"),o=n("2f62"),c=n("0d25"),l=n("b7cf"),u=n("c8a5"),p=n("7c97"),d=n("5118");function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){Object(s.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"TestpaperIntro",mixins:[l.a,u.a],components:{OutFocusMask:p.a},data:function(){return{enable_facein:"",testpaper:null,testpaperTitle:"",info:{},startTime:null,endTime:null,limitTime:null,hasRemainderDoTimes:!1,score:null,total:0,testId:null,targetId:null,counts:{},result:null,question_type_seq:[],answerName:null,timeName:null,answer:null,time:null,interval:null,canDoAgain:"",courseId:"",countDown:{hours:"00",minutes:"00",seconds:"00"},obj:{single_choice:"courseLearning.singleChoice",choice:"courseLearning.choice",essay:"courseLearning.essay",uncertain_choice:"courseLearning.uncertainChoice",determine:"courseLearning.determine",fill:"courseLearning.fill",material:"courseLearning.material"}}},computed:h({sum:function(){var t=0;for(var e in this.counts)t+=parseInt(this.counts[e]);return t},disabled:function(){return"0"!=this.info.doTimes&&this.startTime>Date.now()}},Object(o.e)({isLoading:function(t){return t.isLoading},user:function(t){return t.user},selectedPlanId:function(t){return t.course.selectedPlanId}})),created:function(){this.getInfo()},mounted:function(){this.initReport()},beforeRouteEnter:function(t,e,n){document.getElementById("app").style.background="#f6f6f6",n()},beforeRouteLeave:function(t,e,n){try{this.interval&&Object(d.clearInterval)(this.interval)}catch(t){}document.getElementById("app").style.background="",n()},methods:h(h({},Object(o.c)("course",["handExamdo"])),{},{initReport:function(){this.initReportData(this.selectedPlanId,this.$route.query.targetId,"testpaper")},getInfo:function(){var t=this;this.testId=this.$route.query.testId,this.targetId=this.$route.query.targetId,a.a.testpaperIntro({params:{targetId:this.targetId,targetType:"task"},query:{testId:this.testId}}).then((function(e){t.counts=e.items,t.testpaperTitle=e.testpaper.name,t.testpaper=e.testpaper,t.courseId=e.task.activity.fromCourseId,t.result=e.testpaperResult,t.info=e.task.activity.testpaperInfo,t.enable_facein=e.task.enable_facein,t.canDoAgain="1"===t.info.canDoAgain,t.score=t.testpaper.score,t.startTime=1e3*parseInt(t.info.startTime),t.endTime=1e3*parseInt(t.info.endTime),t.limitTime=parseInt(t.info.limitTime),t.question_type_seq=t.testpaper.metas.question_type_seq,t.startTime>Date.now()&&t.startCountDown()})).catch((function(t){r.a.fail(t.message)}))},submitExam:function(t,e){var n=this;e=e||(new Date).getTime();var i={answer:t,resultId:this.result.id,userId:this.user.id,beginTime:Number(this.result.beginTime),endTime:e};this.handExamdo(i).then((function(t){n.showResult()})).catch((function(t){r.a.fail(t.message)}))},startTestpaper:function(t,e){var n=this;this.startTime>Date.now()?r.a.fail(this.$t("courseLearning.examNotStart")):(this.testId=this.$route.query.testId,this.targetId=this.$route.query.targetId,a.a.testpaperIntro({params:{targetId:this.targetId,targetType:"task"},query:{testId:this.testId}}).then((function(r){n.testId=r.testpaper.id,n.canDoAgain="1"===r.task.activity.testpaperInfo.canDoAgain,n.canDoAgain?1===n.enable_facein?i.a.alert({title:"",confirmButtonText:n.$t("courseLearning.iKnow"),message:"本场考试已开启云监考，暂不支持在移动端答题，请前往PC端进行答题。"}).then((function(){})):n.goDoTestpaper(t,e):i.a.alert({message:n.$t("courseLearning.examOverExam")}).then((function(){n.$router.push("/course/".concat(n.courseId))})),n.startTime>Date.now()&&n.startCountDown()})).catch((function(t){r.a.fail(t.message)})))},goDoTestpaper:function(t,e){this.$router.push({name:"testpaperDo",query:{testId:this.testId,targetId:this.targetId,title:this.testpaperTitle,action:e?"redo":"do"},params:{KeepDoing:t}})},showResult:function(){this.$router.push({name:"testpaperResult",query:{resultId:this.result.id,testId:this.testId,targetId:this.targetId}})},startCountDown:function(){var t=this;this.interval=setInterval((function(){t.countDown=Object(c.getCountDown)(t.startTime-Date.now(),0)}),1e3)},formateStartTime:function(t){return Object(c.formatTime)(new Date(t))}})},v=(n("10ae"),n("0c7c")),g=Object(v.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("out-focus-mask",{attrs:{type:t.outFocusMaskType,isShow:t.isShowOutFocusMask,reportType:t.reportType},on:{outFocusMask:t.outFocusMask}}),t.isLoading?n("e-loading"):t._e(),t.startTime>Date.now()?n("div",{staticClass:"test-start-count-down"},[n("div",{staticClass:"tips"},[t._v(t._s(t.$t("courseLearning.leftTime")))]),n("div",{staticClass:"number"},[t._v(t._s(t.countDown.hours))]),n("div",{staticClass:"unit"},[t._v(t._s(t.$t("courseLearning.hourUnit")))]),n("div",{staticClass:"number"},[t._v(t._s(t.countDown.minutes))]),n("div",{staticClass:"unit"},[t._v(t._s(t.$t("courseLearning.minuteUnit")))]),n("div",{staticClass:"number"},[t._v(t._s(t.countDown.seconds))]),n("div",{staticClass:"unit"},[t._v(t._s(t.$t("courseLearning.secondUnit")))])]):t._e(),n("div",{staticClass:"intro-body"},[t.endTime<Date.now()?n("div",{staticClass:"exam-over"},[t._v("\n\t\t\t\t"+t._s(t.$t("courseLearning.examOver"))+"\n\t\t\t")]):t._e(),n("van-panel",{staticClass:"panel intro-panel",attrs:{title:t.$t("courseLearning.testTips")},scopedSlots:t._u([{key:"footer",fn:function(){return["0"==t.info.examMode?n("div",{staticClass:"testpaper-tips"},[t._v("\n            "+t._s(t.$t("courseLearning.noLimitTips"))+"\n          ")]):t._e()]},proxy:!0}])},[n("van-cell",{staticClass:"intro-cell test-name",attrs:{border:!1,title:t.$t("courseLearning.testName"),value:t.testpaperTitle}}),"1"==t.info.doTimes&&t.startTime?n("van-cell",{staticClass:"intro-cell",class:["intro-panel__content",t.result||!t.disabled?"":"intro-tip"],attrs:{border:!1,title:t.$t("courseLearning.openingTime"),value:t.formateStartTime(t.startTime)}}):t._e(),n("van-cell",{staticClass:"intro-cell",class:["intro-panel__content",t.result||!t.disabled?"":"intro-tip"],attrs:{border:!1,title:t.$t("courseLearning.examinationDuration"),value:t.limitTime?t.limitTime+" "+t.$t("courseLearning.minutes"):t.$t("courseLearning.unlimited")}}),n("van-cell",{staticClass:"intro-cell",attrs:{border:!1,title:t.$t("courseLearning.fullScoreOfTestPaper"),value:t.score+" "+t.$t("courseLearning.branch")}}),n("van-cell",{staticClass:"intro-cell",attrs:{border:!1,title:t.$t("courseLearning.numberOfRemainingTests"),value:"0"==t.info.doTimes?t.$t("courseLearning.unlimited"):t.info.remainderDoTimes+" "+t.$t("courseLearning.times")}}),null==t.info.startTime&&null==t.info.endTime?n("van-cell",{staticClass:"intro-cell",attrs:{border:!1,title:t.$t("courseLearning.validityPeriodOfExamination"),value:t.$t("courseLearning.unlimited")}}):t._e(),t.startTime?n("van-cell",{staticClass:"intro-cell",class:["intro-panel__content",t.result||!t.disabled?"":"intro-tip"],attrs:{border:!1,title:t.$t("courseLearning.testStartTime"),value:t.formateStartTime(t.startTime)}}):t._e(),t.startTime?n("van-cell",{staticClass:"intro-cell",class:["intro-panel__content",t.result||!t.disabled?"":"intro-tip"],attrs:{border:!1,title:t.$t("courseLearning.examDeadline"),value:t.endTime?t.formateStartTime(t.endTime):t.$t("courseLearning.unlimitedDuration")}}):t._e()],1),n("van-panel",{staticClass:"panel intro-panel",scopedSlots:t._u([{key:"header",fn:function(){return[n("div",{staticClass:"van-cell van-panel__header"},[n("span",{staticStyle:{"font-size":"16px","font-weight":"500",color:"rgba(0,0,0,0.85)"}},[t._v(t._s(t.$t("courseLearning.numberOfTopics")))]),n("span",{staticStyle:{"margin-left":"12px","font-size":"14px","font-weight":"400",color:"rgba(0,0,0,0.35)"}},[t._v(t._s(t.sum+" "+t.$t("courseLearning.topic")))])])]},proxy:!0}])},[n("div",{staticClass:"intro-panel__content"},t._l(t.question_type_seq,(function(e){return n("van-cell",{key:e,staticClass:"intro-cell",attrs:{border:!1,title:t.$t(t.obj[e]),value:t.counts[e]+" "+t.$t("courseLearning.topic")}})})),1)])],1),n("div",{staticClass:"intro-footer"},[t.result?["doing"===t.result.status&&t.canDoAgain?n("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper(!0,!0)}}},[t._v("\n          "+t._s(t.$t("courseLearning.continueExam"))+"\n        ")]):t.canDoAgain?n("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper(!0,!0)}}},[t._v(t._s(t.$t("courseLearning.startTheExam")))]):n("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:t.showResult}},[t._v("\n          "+t._s(t.$t("courseLearning.ViewDetail"))+"\n        ")])]:[t.endTime<Date.now()?n("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper()}}},[t._v(t._s(t.$t("courseLearning.ViewDetail")))]):n("van-button",{staticClass:"intro-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper(!0,!0)}}},[t._v(t._s(t.$t("courseLearning.startTheExam")))])]],2)],1)}),[],!1,null,null,null);e.default=g.exports},5118:function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new s(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new s(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n("6017"),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n("c8ba"))},6017:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r,s,a,o,c=1,l={},u=!1,p=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick((function(){h(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?(a="setImmediate$"+Math.random()+"$",o=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&h(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),i=function(e){t.postMessage(a+e,"*")}):t.MessageChannel?((s=new MessageChannel).port1.onmessage=function(t){h(t.data)},i=function(t){s.port2.postMessage(t)}):p&&"onreadystatechange"in p.createElement("script")?(r=p.documentElement,i=function(t){var e=p.createElement("script");e.onreadystatechange=function(){h(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(h,0,t)},d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return l[c]=r,i(c),c++},d.clearImmediate=m}function m(t){delete l[t]}function h(t){if(u)setTimeout(h,0,t);else{var e=l[t];if(e){u=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}(e)}finally{m(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n("c8ba"),n("f28c"))},"7c97":function(t,e,n){"use strict";var i={props:{type:{type:String,default:""},isShow:{type:Boolean,default:!1},reportType:{type:String,default:""}},methods:{onKeepLearning:function(t){this.$emit("outFocusMask",t)}}},r=n("0c7c"),s=Object(r.a)(i,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isShow?n("div",{staticClass:"out-focus-mask"},[n("div",{staticClass:"report-go-back",on:{click:function(e){return t.$router.go(-1)}}},[n("van-icon",{attrs:{name:"arrow-left",size:"25",color:"#43bc60"}})],1),"kick_previous"===t.type?[n("div",{staticClass:"content"},[t._m(0),n("van-button",{attrs:{color:"#43bc60",size:"small"},on:{click:function(e){return t.onKeepLearning("kick_previous")}}},[t._v("\n        继续学习\n      ")])],1)]:t._e(),"reject_current"===t.type?[t._m(1)]:t._e()],2):t._e()}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tips"},[e("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),e("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"tips"},[e("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),e("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])])}],!1,null,null,null);e.a=s.exports},b56c:function(t,e,n){},b7cf:function(t,e,n){"use strict";n("c5f6"),n("e17f");var i=n("2241");n("456d"),n("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(n,r){if(t&&"doing"===t.status){var s="".concat(e,"-").concat(t.id),a=JSON.parse(localStorage.getItem(s));a=a?Object.keys(a).forEach((function(t){a[t]=a[t].filter((function(t){return""!==t}))})):{},i.a.confirm({title:"提示",cancelButtonText:"放弃考试",confirmButtonText:"继续考试",message:"您有未完成的考试，是否继续？"}).then((function(){if(Number(t.limitedTime)>0){var e=Math.ceil(((new Date).getTime()-1e3*t.beginTime)/1e3/60);if(Number(e)>Number(t.limitedTime)){var i=Number(1e3*t.beginTime)+Number(60*t.limitedTime*1e3);return void r({answer:a,endTime:i})}}n()})).catch((function(){r({answer:a,endTime:null})}))}}))}}}},c8a5:function(t,e,n){"use strict";n("6762"),n("2fdb");var i=n("3ce7"),r=n("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0,isShowOutFocusMask:!1,outFocusMaskType:"",sign:"",record:{},absorbed:0,learnedTime:0}},beforeRouteLeave:function(t,e,n){this.sign.length>0&&localStorage.setItem("flowSign",this.sign),n()},beforeDestroy:function(){this.clearReportIntervalTime(),window.removeEventListener("beforeunload",this.onbeforeunloadFlowSign),this.toggleReportMaskHidden("remove")},methods:{initReportData:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=n,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,i&&this.initReportEvent(),this.onbeforeunload()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var n=this,r={courseId:t,taskId:e};return new Promise((function(t,e){i.a.getCourseData({query:r}).then((function(e){n.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{eventName:"doing",ContinuousReport:!1,watchTime:null};if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||t.ContinuousReport))if(""===this.sign){var e={client:"h5"},n=localStorage.getItem("flowSign");n&&(e.lastSign=n,localStorage.removeItem("flowSign")),this.start(t,e)}else this.reportTaskEvent(t)},start:function(t,e){var n=this;i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:"start"},data:e}).then((function(e){if(n.handleReportResult(e),e.learnControl.allowLearn)n.sign=e.record.flowSign,n.record=e.record,n.reportTaskEvent(t);else{var i=e.learnControl.denyReason;n.reportJudge(i)}}))},reportTaskEvent:function(t){var e=this;if(0!==this.sign.length){var n={client:"h5",sign:this.sign,duration:this.learnTime,status:this.absorbed};if(t.reActive&&(n.reActive=t.reActive),this.sourceType&&"video"===this.sourceType){var r=parseInt(this.nowWatchTime-this.lastWatchTime);this.lastWatchTime=this.nowWatchTime;var s={watchData:{duration:r}};n=Object.assign(n,s)}this.learnTime=0,i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:t.eventName},data:n}).then((function(t){if(e.handleReportResult(t),e.record=t.record,e.absorbed=0,e.sign=t.record.flowSign,!t.learnControl.allowLearn){var n=t.learnControl.denyReason;e.reportJudge(n)}})).catch((function(t){e.clearReportIntervalTime()}))}},handleReportResult:function(t){this.reportResult=t,this.learnedTime=t.learnedTime,t.taskResult&&"finish"===t.taskResult.status?(this.isFinish=!0,this.$store.commit(r.B,"finish"),this.$store.commit("course/".concat(r.F),t.completionRate)):this.$store.commit(r.B,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData({eventName:"doing",ContinuousReport:!0})}),e)},checkoutTime:function(){this.reportFinishCondition&&["time","watchTime"].includes(this.reportFinishCondition.type)&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData({eventName:"finish",ContinuousReport:!0})},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null},reportJudge:function(t){"kick_previous"===t?this.kickEachOther("kick_previous"):"reject_current"===t&&(this.clearReportIntervalTime(),this.kickEachOther("reject_current"))},outFocusMask:function(t){this.absorbed=1,this.isShowOutFocusMask=!1,!this.player||"video"!==this.reportType&&"audio"!==this.reportType||this.player.play(),this.toggleReportMaskHidden("remove"),this.reprtData({eventName:"doing",ContinuousReport:!0,reActive:1})},kickEachOther:function(t){if(this.absorbed=1,"testpaper"!==this.reportType&&"live"!==this.reportType&&"homework"!==this.reportType||"kick_previous"!==t){if(this.isShowOutFocusMask=!0,this.outFocusMaskType=t,"video"===this.reportType||"audio"===this.reportType){if(this.player&&this.player.destory&&"reject_current"===t)return void this.player.destory();this.player&&this.player.pause&&this.player.pause()}this.toggleReportMaskHidden("add")}},ineffectiveLearning:function(t){this.isShowOutFocusMask||(this.absorbed=0,this.isShowOutFocusMask=!0,this.outFocusMaskType=t,this.player&&"video"===this.reportType&&this.player.pause(),this.reprtData({eventName:"doing",ContinuousReport:!0}))},toggleReportMaskHidden:function(t){"video"!==this.reportType&&"audio"!==this.reportType&&("add"===t?document.getElementsByTagName("body")[0].classList.add("report-mask-hidden"):"remove"===t&&document.getElementsByTagName("body")[0].classList.remove("report-mask-hidden"))},initVisibilitychange:function(){document.addEventListener("visibilitychange",this.visibilityState)},visibilityState:function(){"video"===this.reportType&&("hidden"===document.visibilityState?this.ineffectiveLearning("ineffective_learning"):"visible"===document.visibilityState&&this.player.pause())},onbeforeunload:function(){window.addEventListener("beforeunload",this.onbeforeunloadFlowSign)},onbeforeunloadFlowSign:function(){this.sign.length>0&&localStorage.setItem("flowSign",this.sign)}}}}}]);