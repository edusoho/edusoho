(window.webpackJsonp=window.webpackJsonp||[]).push([["webView"],{"07b4":function(t,e,i){"use strict";i("e7e5");var s=i("d399"),n=i("db72"),a=i("3ce7"),r=i("2164"),o=i("2f62"),c=i("faa5"),u={name:"finish-dialog",mixins:[r.a],inject:["reload"],data:function(){return{show:!0,path:""}},props:{finishResult:{type:Object,default:function(){return{}}},courseId:{type:String,default:""}},computed:Object(n.a)({},Object(o.d)("course",{allTask:function(t){return t.allTask}}),{rate:function(){return this.finishResult?"".concat(parseInt(this.finishResult.completionRate),"%"):"0%"},title:function(){return this.finishResult?this.allTask[this.finishResult.result.courseTaskId].title:""}}),created:function(){this.path=this.$route.path},methods:Object(n.a)({},Object(o.c)("course",{setSourceType:c.q}),{goNextTask:function(){var t=this;if(!this.finishResult.nextTask)return Object(s.a)("没有下一课"),void(this.show=!1);var e={courseId:this.courseId,taskId:this.finishResult.nextTask.id};a.a.getCourseData({query:e}).then((function(e){t.toLearnTask(e)}))},toLearnTask:function(t){if("create"!==t.status){var e={id:t.id};this.$store.commit("course/".concat(c.f),{nextTask:e}),this.showTypeDetail(t),this.show=!1,this.setSourceType({sourceType:"img",taskId:t.id})}else Object(s.a)("课时创建中，敬请期待")},showTypeDetail:function(t){if("published"===t.status)switch(t.type){case"video":this.playVedio(t);break;case"audio":this.playAudio(t);break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.courseId,taskId:t.id,type:t.type,backUrl:"/course/".concat(this.courseId)}}),this.reload();break;case"live":var e=new Date,i=new Date(1e3*t.endTime),n=(new Date(1e3*t.startTime),!1);if(e>i){if(t.activity&&"videoGenerated"===t.activity.replayStatus)return void("self"===t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):this.copyPcUrl(t.courseUrl));if(t.activity&&"ungenerated"===t.activity.replayStatus)return void Object(s.a)("暂无回放");n=!0}this.$router.push({name:"live",query:{courseId:this.courseId,taskId:t.id,type:t.type,title:t.title,replay:n}});break;case"testpaper":var a=t.activity.testpaperInfo.testpaperId;this.$router.push({name:"testpaperIntro",query:{testId:a,targetId:t.id}});break;case"homework":this.$router.push({name:"homeworkIntro",query:{courseId:this.courseId,taskId:t.id}});break;case"exercise":this.$router.push({name:"exerciseIntro",query:{courseId:this.courseId,taskId:t.id}});break;default:this.copyPcUrl(t.courseUrl)}else Object(s.a)("敬请期待")},playVedio:function(t){if("self"===t.mediaSource){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"video",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"video",taskId:t.id}})}else this.copyPcUrl(t.courseUrl)},playAudio:function(t){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"audio",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"audio",taskId:t.id}})},closeFinishDialog:function(){this.show=!1,this.$emit("closeFinishDialog")}})},h=i("0c7c"),l=Object(h.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-overlay",{attrs:{show:t.show,"z-index":9999}},[i("div",{staticClass:"finish-dialog "},[i("div",{staticClass:"finish-dialog-content clearfix"},[i("div",{staticClass:"finish-dialog-top"},[i("img",{staticClass:"finish-dialog-img",attrs:{src:"static/images/reportDialog.png"}}),i("div",{staticClass:"finish-dialog-top--text"},[t._v("学习完成")])]),i("div",{staticClass:"finish-dialog-close",on:{click:t.closeFinishDialog}},[i("i",{staticClass:"iconfont icon-guanbi"})]),i("div",{staticClass:"progress-bar"},[i("div",{staticClass:"progress-bar__content"},[i("div",{staticClass:"progress-bar__rate",style:{width:t.rate}})]),i("div",{staticClass:"progress-bar__text"},[t._v(t._s(t.rate))])]),i("p",{staticClass:"finish-dialog-text"},[t._v("恭喜完成")]),[i("p",{staticClass:"text-overflow"},[t._v(t._s(t.title))]),i("div",{staticClass:"finish-dialog-btn",on:{click:t.goNextTask}},[t._v("下一课")])]],2)])])}),[],!1,null,null,null);e.a=l.exports},2164:function(t,e,i){"use strict";i("e17f");var s=i("2241");e.a={methods:{copyPcUrl:function(t){var e=this,i="移动端暂不支持此类课程学习。请移步至电脑「".concat(t,"」完成课程。");s.a.alert({title:"暂不支持",message:i,messageAlign:"left",confirmButtonText:"复制链接"}).then((function(){e.$copyText(t).then((function(t){}))}))}}}},"23f2":function(t,e,i){"use strict";i.r(e),i("6762"),i("2fdb"),i("e7e5");var s=i("d399"),n=(i("96cf"),i("3b8d")),a=i("db72"),r=i("32e6"),o=i.n(r),c=i("3ce7"),u=i("2f62"),h=i("faa5"),l=i("c8a5"),d={components:{finishDialog:i("07b4").a},mixins:[l.a],data:function(){return{finishCondition:void 0,enableFinish:!1,media:"",isPreview:this.$route.query.preview,finishResult:null,finishDialog:!1,courseId:null,taskId:null,type:null,player:null}},computed:Object(a.a)({},Object(u.d)("course",{details:function(t){return t.details},joinStatus:function(t){return t.joinStatus}}),{},Object(u.d)({isLoading:function(t){return t.isLoading}})),created:function(){this.courseId=this.$route.query.courseId,this.taskId=this.$route.query.taskId,this.type=this.$route.query.type},mounted:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.initData();case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),methods:Object(a.a)({},Object(u.c)({setNavbarTitle:h.n}),{initData:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.joinStatus&&this.initReport(),this.enableFinish=!!parseInt(this.details.enableFinish),t.next=4,c.a.getMedia(this.getParams()).catch((function(t){return Object(s.a)(t.message),Promise.reject(t)}));case 4:e=t.sent,["ppt","doc"].includes(this.media)?this.initPlayer(e):this.$refs.text.innerHTML=e.media.content;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),initReport:function(){this.initReportData(this.courseId,this.taskId,this.type),this.finishDialog=!1,this.getFinishCondition()},getFinishCondition:function(){var t=this;this.getCourseData(this.courseId,this.taskId).then((function(e){t.setNavbarTitle(e.title),t.finishCondition=e.activity&&e.activity.finishCondition}))},toToast:function(){this.finishCondition&&this.$toast({message:this.finishCondition.text,position:"bottom"})},getParams:function(){var t=this.$route.query,e=t.courseId,i=t.taskId,s=t.type,n=!this.joinStatus&&this.isPreview;return this.media=s,n?{query:{courseId:e,taskId:i},params:{preview:1}}:{query:{courseId:e,taskId:i}}},initPlayer:function(t){var e=this,i=t.media,s="//service-cdn.qiqiuyun.net/js-sdk/sdk-v1.js?v="+parseInt(Date.now()/1e3/60);o()(s,(function(s){if(s)throw s;var n=new window.QiQiuYun.Player({id:"player",resNo:i.resId,token:i.token,source:{type:t.mediaType,args:i}});e.player=n,n.on("ready",(function(){})),n.on("pagechanged",(function(t){t.pageNum===t.total&&e.finishCondition&&"end"===e.finishCondition.type&&e.reprtData("finish")}))}))},toLearned:function(){var t=this;this.reprtData("finish").then((function(e){t.finishResult=e,t.finishDialog=!0}))},reloadPage:function(t){this.courseId=t.courseId,this.taskId=t.taskId,this.type=t.type,this.initData()}})},p=i("0c7c"),f=Object(p.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"web-view"},[t.isLoading?i("e-loading"):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"text"!==t.media,expression:"media !== 'text'"}],attrs:{id:"player"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:"text"===t.media,expression:"media === 'text'"}],ref:"text",staticClass:"media-text"}),t.joinStatus?[t.isFinish?i("div",{staticClass:"web-view--btn web-view--activebtn"},[i("i",{staticClass:"iconfont icon-markdone"}),t._v("\n      学过了\n    ")]):t._e(),t.isFinish?t._e():i("div",[t.enableFinish?i("div",{staticClass:"web-view--btn",on:{click:t.toLearned}},[t._v("\n        学过了\n      ")]):t._e(),t.enableFinish?t._e():i("div",{staticClass:"web-view--btn",on:{click:t.toToast}},[t._v("\n        完成条件\n      ")])])]:t._e(),t.finishDialog?i("finishDialog",{attrs:{finishResult:t.finishResult,courseId:t.courseId},on:{reloadPage:t.reloadPage}}):t._e()],2)}),[],!1,null,null,null);e.default=f.exports},"32e6":function(t,e){function i(t,e){t.onload=function(){this.onerror=this.onload=null,e(null,t)},t.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),t)}}function s(t,e){t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,t))}}t.exports=function(t,e,n){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("script");"function"==typeof e&&(n=e,e={}),e=e||{},n=n||function(){},r.type=e.type||"text/javascript",r.charset=e.charset||"utf8",r.async=!("async"in e)||!!e.async,r.src=t,e.attrs&&function(t,e){for(var i in e)t.setAttribute(i,e[i])}(r,e.attrs),e.text&&(r.text=""+e.text),("onload"in r?i:s)(r,n),r.onload||i(r,n),a.appendChild(r)}},c8a5:function(t,e,i){"use strict";var s=i("3ce7"),n=i("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,s&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var i=this,n={courseId:t,taskId:e};return new Promise((function(t,e){s.a.getCourseData({query:n}).then((function(e){i.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||i)){var a={};if("doing"===e){if(null!==this.reportResult){var r=this.reportResult.lastTime;a={lastTime:r}}n&&(a.watchTime=n)}var o={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,i){s.a.reportTask({query:o,data:a}).then((function(i){t.handleReprtResult(i),e(i)})).catch((function(t){i(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(n.r,"finish"),this.$store.commit("course/".concat(n.v),t.completionRate)):this.$store.commit(n.r,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}}}]);