(window.webpackJsonp=window.webpackJsonp||[]).push([["course~courseTry"],{"07b4":function(t,e,i){"use strict";i("e7e5");var s=i("d399"),a=i("db72"),n=i("3ce7"),r=i("2164"),o=i("2f62"),c=i("faa5"),u={name:"finish-dialog",mixins:[r.a],inject:["reload"],data:function(){return{show:!0,path:""}},props:{finishResult:{type:Object,default:function(){return{}}},courseId:{type:String,default:""}},computed:Object(a.a)({},Object(o.d)("course",{allTask:function(t){return t.allTask}}),{rate:function(){return this.finishResult?"".concat(parseInt(this.finishResult.completionRate),"%"):"0%"},title:function(){return this.finishResult?this.allTask[this.finishResult.result.courseTaskId].title:""}}),created:function(){this.path=this.$route.path},methods:Object(a.a)({},Object(o.c)("course",{setSourceType:c.q}),{goNextTask:function(){var t=this;if(!this.finishResult.nextTask)return Object(s.a)("没有下一课"),void(this.show=!1);var e={courseId:this.courseId,taskId:this.finishResult.nextTask.id};n.a.getCourseData({query:e}).then((function(e){t.toLearnTask(e)}))},toLearnTask:function(t){if("create"!==t.status){var e={id:t.id};this.$store.commit("course/".concat(c.f),{nextTask:e}),this.showTypeDetail(t),this.show=!1,this.setSourceType({sourceType:"img",taskId:t.id})}else Object(s.a)("课时创建中，敬请期待")},showTypeDetail:function(t){if("published"===t.status)switch(t.type){case"video":this.playVedio(t);break;case"audio":this.playAudio(t);break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.courseId,taskId:t.id,type:t.type,backUrl:"/course/".concat(this.courseId)}}),this.reload();break;case"live":var e=new Date,i=new Date(1e3*t.endTime),a=(new Date(1e3*t.startTime),!1);if(e>i){if(t.activity&&"videoGenerated"===t.activity.replayStatus)return void("self"===t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):this.copyPcUrl(t.courseUrl));if(t.activity&&"ungenerated"===t.activity.replayStatus)return void Object(s.a)("暂无回放");a=!0}this.$router.push({name:"live",query:{courseId:this.courseId,taskId:t.id,type:t.type,title:t.title,replay:a}});break;case"testpaper":var n=t.activity.testpaperInfo.testpaperId;this.$router.push({name:"testpaperIntro",query:{testId:n,targetId:t.id}});break;case"homework":this.$router.push({name:"homeworkIntro",query:{courseId:this.courseId,taskId:t.id}});break;case"exercise":this.$router.push({name:"exerciseIntro",query:{courseId:this.courseId,taskId:t.id}});break;default:this.copyPcUrl(t.courseUrl)}else Object(s.a)("敬请期待")},playVedio:function(t){if("self"===t.mediaSource){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"video",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"video",taskId:t.id}})}else this.copyPcUrl(t.courseUrl)},playAudio:function(t){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"audio",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"audio",taskId:t.id}})},closeFinishDialog:function(){this.show=!1,this.$emit("closeFinishDialog")}})},l=i("0c7c"),d=Object(l.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-overlay",{attrs:{show:t.show,"z-index":9999}},[i("div",{staticClass:"finish-dialog "},[i("div",{staticClass:"finish-dialog-content clearfix"},[i("div",{staticClass:"finish-dialog-top"},[i("img",{staticClass:"finish-dialog-img",attrs:{src:"static/images/reportDialog.png"}}),i("div",{staticClass:"finish-dialog-top--text"},[t._v("学习完成")])]),i("div",{staticClass:"finish-dialog-close",on:{click:t.closeFinishDialog}},[i("i",{staticClass:"iconfont icon-guanbi"})]),i("div",{staticClass:"progress-bar"},[i("div",{staticClass:"progress-bar__content"},[i("div",{staticClass:"progress-bar__rate",style:{width:t.rate}})]),i("div",{staticClass:"progress-bar__text"},[t._v(t._s(t.rate))])]),i("p",{staticClass:"finish-dialog-text"},[t._v("恭喜完成")]),[i("p",{staticClass:"text-overflow"},[t._v(t._s(t.title))]),i("div",{staticClass:"finish-dialog-btn",on:{click:t.goNextTask}},[t._v("下一课")])]],2)])])}),[],!1,null,null,null);e.a=d.exports},"202a":function(t,e,i){"use strict";i("e17f");var s=i("2241"),a=(i("e7e5"),i("d399")),n=(i("c5f6"),i("96cf"),i("3b8d")),r=(i("3b2b"),i("4917"),i("7f7f"),i("6762"),i("2fdb"),i("db72")),o=i("32e6"),c=i.n(o),u=i("2f62"),l=i("3ce7"),d=i("fd23"),h=i("bced"),p=i("07b4"),f=i("4328"),v=i.n(f),m=i("c8a5"),y={components:{countDown:d.a,tagLink:h.a,finishDialog:p.a},mixins:[m.a],props:{courseSet:{type:Object,default:function(){return{}}},seckillActivities:{type:Object,default:null}},data:function(){return{finishCondition:void 0,learnMode:!1,enableFinish:!1,isEncryptionPlus:!1,mediaOpts:{},isCoverOpen:!1,isPlaying:!1,player:null,counting:!0,isEmpty:!1,tagData:{earnings:0,isShow:!1,link:"",className:"course-tag",minDirectRewardRatio:0},timeChangingList:[],bindAgencyRelation:{},finishResult:null,finishDialog:!1,lastWatchTime:0,nowWatchTime:0}},computed:Object(r.a)({},Object(u.d)(["DrpSwitch"]),{},Object(u.d)("course",{sourceType:function(t){return t.sourceType},selectedPlanId:function(t){return t.selectedPlanId},taskId:function(t){return t.taskId},details:function(t){return t.details},joinStatus:function(t){return t.joinStatus},user:function(t){return t.user},allTask:function(t){return t.allTask}}),{textContent:function(){return this.mediaOpts.text},showLearnBtn:function(){return this.joinStatus&&["video","audio"].includes(this.sourceType)}}),watch:{taskId:function(t,e){("course"!==this.$route.name||this.joinStatus)&&t>0&&this.initHead()},selectedPlanId:function(){("course"!==this.$route.name||this.joinStatus)&&value>0&&this.initHead()}},created:function(){this.initHead(),this.showTagLink()},beforeDestroy:function(){this.player&&(this.player.eventManager={}),this.clearComputeWatchTime()},methods:{toToast:function(){this.finishCondition&&this.$toast({message:this.finishCondition.text,position:"bottom"})},isAndroid:function(){return!!navigator.userAgent.match(new RegExp("android","i"))},initHead:function(){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.joinStatus&&(this.initReport(),this.clearComputeWatchTime(),this.lastWatchTime=0,this.nowWatchTime=0),this.initPlayer())},initReport:function(){this.initReportData(this.selectedPlanId,this.taskId,this.sourceType),this.finishDialog=!1,this.getFinishCondition(),this.IsLivePlayback()},getFinishCondition:function(){var t=this;this.getCourseData(this.selectedPlanId,this.taskId).then((function(e){t.finishCondition=e.activity&&e.activity.finishCondition}))},IsLivePlayback:function(){"live"===this.allTask[this.taskId].type&&this.reprtData("finish")},viewAudioDoc:function(){this.isCoverOpen=!0},hideAudioDoc:function(){this.isCoverOpen=!1},handlePlayer:function(){return this.isPlaying?this.player&&this.player.pause():this.player&&this.player.play()},getParams:function(){return this.joinStatus?{query:{courseId:this.selectedPlanId,taskId:this.taskId}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1}}},initPlayer:function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var e,i,n,r,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.$refs.video&&(this.$refs.video.innerHTML=""),this.enableFinish=!!parseInt(this.details.enableFinish),t.next=4,l.a.getMedia(this.getParams()).catch((function(t){var e=Number(o.details.id);4040101==t.code&&o.$router.push({name:"login",query:{redirect:"/course/".concat(e)}}),a.a.fail(t.message)}));case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return");case 7:if("video"!==e.mediaType||e.media.url){t.next=10;break}return Object(a.a)("课程内容准备中，请稍候查看"),t.abrupt("return");case 10:if(i=e.media.timeLimit,this.isEncryptionPlus=e.media.isEncryptionPlus,!e.media.isEncryptionPlus){t.next=15;break}return Object(a.a)("该浏览器不支持云视频播放，请下载App"),t.abrupt("return");case 15:n=e.media,r={id:"course-detail__head--video",user:this.user,playlist:n.url,autoplay:!0,disableFullscreen:"audio"===this.sourceType,isAudio:"audio"===this.sourceType,strictMode:!n.supportMobile,pluck:{timelimit:i},resId:n.resId,disableDataUpload:!0},!this.joinStatus&&Number(this.details.tryLookable)||delete r.pluck,this.mediaOpts=Object.assign({text:e.media.text},r),this.$store.commit("UPDATE_LOADING_STATUS",!0),this.loadPlayerSDK().then((function(t){o.$store.commit("UPDATE_LOADING_STATUS",!1),o.player&&(o.player.taskId=-1),o.player&&o.player.eventManager&&(o.player.eventManager={});var e=new t(r);e.taskId=o.taskId,o.player=e,e.on("ready",(function(){e.taskId,o.taskId})),e.on("unablePlay",(function(){o.$refs.video.innerHTML="",s.a.alert({message:"当前内容不支持该手机浏览器观看，建议您使用Chrome、Safari浏览器观看。"}).then((function(){}))})),e.on("playing",(function(){o.isPlaying=!0,e.taskId===o.taskId&&o.computeWatchTime()})),e.on("paused",(function(t){if(o.isPlaying=!1,e.taskId===o.taskId){o.clearComputeWatchTime();var i=parseInt(o.nowWatchTime-o.lastWatchTime);o.lastWatchTime=o.nowWatchTime,o.reprtData("doing",!0,i)}})),e.on("datapicker.start",(function(t){e.taskId,o.taskId})),e.on("ended",(function(){e.taskId===o.taskId&&(o.clearComputeWatchTime(),o.finishCondition&&"end"===o.finishCondition.type&&o.reprtData("finish"))})),e.on("timeupdate",(function(t){e.taskId,o.taskId}))}));case 22:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),loadPlayerSDK:function(){if(!window.VideoPlayerSDK){var t="//service-cdn.qiqiuyun.net/js-sdk/video-player/sdk-v1.js?v="+Date.now()/1e3/60;return new Promise((function(e,i){c()(t,(function(t){t&&i(t),e(window.VideoPlayerSDK)}))}))}return Promise.resolve(window.VideoPlayerSDK)},expire:function(){this.counting=!1},sellOut:function(){this.isEmpty=!0,this.$emit("goodsEmpty")},showTagLink:function(){this.DrpSwitch?(this.initTagData(),this.getAgencyBindRelation()):this.tagData.isShow=!1},getAgencyBindRelation:function(){var t=this;l.a.getAgencyBindRelation().then((function(e){e.agencyId?(t.bindAgencyRelation=e,t.tagData.isShow=!0):t.tagData.isShow=!1}))},initTagData:function(){var t=this;l.a.getDrpSetting().then((function(e){t.drpSetting=e,t.tagData.minDirectRewardRatio=e.minDirectRewardRatio;var i={type:"course",id:t.details.id,merchant_id:t.drpSetting.merchantId};t.tagData.link=t.drpSetting.distributor_template_url+"?"+v.a.stringify(i);var s=t.drpSetting.minDirectRewardRatio/100*t.details.price;t.tagData.earnings=(Math.floor(100*s)/100).toFixed(2)}))},toLearned:function(){var t=this;this.reprtData("finish").then((function(e){t.finishResult=e,t.finishDialog=!0}))},computeWatchTime:function(){var t=this;this.intervalWatchTime=setInterval((function(){t.nowWatchTime++}),1e3)},clearComputeWatchTime:function(){clearInterval(this.intervalWatchTime)},closeFinishDialog:function(){this.finishDialog=!1}}},g=i("0c7c"),T=Object(g.a)(y,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"course-detail__head pos-rl",attrs:{id:"course-detail__head"}},[t.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(t.sourceType)&&!t.isEncryptionPlus&&!t.isCoverOpen,expression:"\n      ['audio'].includes(sourceType) && !isEncryptionPlus && !isCoverOpen\n    "}],staticClass:"course-detail__nav--btn",on:{click:t.viewAudioDoc}},[t._v("\n    文稿\n  ")]):t._e(),t.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(t.sourceType)&&!t.isEncryptionPlus,expression:"['audio'].includes(sourceType) && !isEncryptionPlus"}],staticClass:"course-detail__nav--cover web-view",class:{opened:t.isCoverOpen}},[i("div",{staticClass:"media-text",domProps:{innerHTML:t._s(t.textContent)}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isCoverOpen,expression:"isCoverOpen"}],staticClass:"course-detail__nav--cover-control",on:{click:t.handlePlayer}},[i("i",{staticClass:"iconfont",class:t.isPlaying?"icon-zanting":"icon-bofang"})]),i("div",{staticClass:"course-detail__nav--cover-close-btn",on:{click:t.hideAudioDoc}},[i("i",{staticClass:"van-icon van-icon-arrow van-nav-bar__arrow"})])]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"img"===t.sourceType||t.isEncryptionPlus||t.finishDialog,expression:"sourceType === 'img' || isEncryptionPlus || finishDialog"}],staticClass:"course-detail__head--img",attrs:{id:"course-detail__head--img"}},[t.courseSet.cover?i("img",{attrs:{src:t.courseSet.cover.large,alt:""}}):t._e(),t.seckillActivities&&"ongoing"===t.seckillActivities.status&&t.counting&&!t.isEmpty?i("countDown",{attrs:{activity:t.seckillActivities},on:{timesUp:t.expire,sellOut:t.sellOut}}):t._e()],1),i("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(t.sourceType)&&!t.isEncryptionPlus&&!t.finishDialog,expression:"['video', 'audio'].includes(sourceType) && !isEncryptionPlus && !finishDialog"}],ref:"video",attrs:{id:"course-detail__head--video"}}),t.showLearnBtn?[t.isFinish?i("div",{staticClass:"course-detail__head--btn course-detail__head--activebtn"},[i("i",{staticClass:"iconfont icon-markdone"}),t._v("\n      学过了\n    ")]):t._e(),t.isFinish?t._e():i("div",[t.enableFinish?i("div",{staticClass:"course-detail__head--btn",on:{click:t.toLearned}},[t._v("\n        学过了\n      ")]):t._e(),t.enableFinish?t._e():i("div",{staticClass:"course-detail__head--btn",on:{click:t.toToast}},[t._v("\n        完成条件\n      ")])])]:t._e(),i("tagLink",{attrs:{"tag-data":t.tagData}}),t.finishDialog?i("finishDialog",{attrs:{finishResult:t.finishResult,courseId:t.selectedPlanId},on:{closeFinishDialog:t.closeFinishDialog}}):t._e()],2)}),[],!1,null,null,null);e.a=T.exports},2164:function(t,e,i){"use strict";i("e17f");var s=i("2241");e.a={methods:{copyPcUrl:function(t){var e=this,i="移动端暂不支持此类课程学习。请移步至电脑「".concat(t,"」完成课程。");s.a.alert({title:"暂不支持",message:i,messageAlign:"left",confirmButtonText:"复制链接"}).then((function(){e.$copyText(t).then((function(t){}))}))}}}},c8a5:function(t,e,i){"use strict";var s=i("3ce7"),a=i("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,s&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var i=this,a={courseId:t,taskId:e};return new Promise((function(t,e){s.a.getCourseData({query:a}).then((function(e){i.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||i)){var n={};if("doing"===e){if(null!==this.reportResult){var r=this.reportResult.lastTime;n={lastTime:r}}a&&(n.watchTime=a)}var o={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,i){s.a.reportTask({query:o,data:n}).then((function(i){t.handleReprtResult(i),e(i)})).catch((function(t){i(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(a.r,"finish"),this.$store.commit("course/".concat(a.v),t.completionRate)):this.$store.commit(a.r,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}}}]);