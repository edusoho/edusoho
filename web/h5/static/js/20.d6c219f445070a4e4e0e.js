webpackJsonp([20],{GuXH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n("XmAh");var r=n("il3B"),a=n("woOf"),c=n.n(a),i=(n("eqfM"),n("/QYm")),s=n("Dd8w"),o=n.n(s),u=n("gyMJ"),d=n("FVyg"),l=n("NYxO"),p=(n("KFVb"),n("SgDA")),m={name:"password-reset",components:{EDrag:d.a},data:function(){return{resetInfo:{account:"",accountType:"",dragCaptchaToken:"",encrypt_password:"",smsCode:"",smsToken:"",type:"register"},dragKey:0,errorMessage:{account:"",encrypt_password:""},validated:{account:!1,encrypt_password:!1},count:{showCount:!1,num:120,codeBtnDisable:!1}}},computed:o()({},Object(l.mapState)({isLoading:function(e){return e.isLoading}}),{btnDisable:function(){return!(this.resetInfo.account&&this.resetInfo.encrypt_password&&this.resetInfo.smsCode||"email"===this.accountType)},accountType:function(){return this.resetInfo.account.includes("@")?"email":"mobile"}}),methods:{validateAccountOrPsw:function(e){var t=0<arguments.length&&void 0!==e?e:"account",n=this.resetInfo[t],a="account"===t?p.a[this.accountType]:p.a[t];if(0==n.length)return this.errorMessage[t]="",!1;this.errorMessage[t]=a.validator(n)?"":a.message},validatedChecker:function(){var e=this.resetInfo.account,t=this.accountType,n=p.a[t];this.validated.account=n.validator(e)},handleSmsSuccess:function(e){this.resetInfo.dragCaptchaToken=e},handleSubmit:function(){var t=this;if(this.$refs.dragComponent.dragToEnd){var e=c()({},this.resetInfo),n=e.encrypt_password,a=e.account,s=window.XXTEA.encryptToBase64(n,window.location.host);if(e.encrypt_password=s,"email"!==this.accountType)u.a.resetPasswordByMobile({query:{mobile:a},data:{smsToken:e.smsToken,smsCode:e.smsCode,encrypt_password:e.encrypt_password}}).then(function(e){r.a.alert({message:"密码重置成功"}).then(function(){t.$router.replace({name:"login",params:{username:a}})})}).catch(function(e){i.a.fail(e.message)});else{var o=this.resetInfo.dragCaptchaToken;u.a.resetPasswordByEmail({query:{email:a},data:{dragCaptchaToken:o}}).then(function(e){r.a.alert({message:"验证链接已发送到 "+a}).then(function(){t.$router.replace({name:"login",params:{username:a}})})}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.resetInfo.dragCaptchaToken=""}i.a.fail(e.message)})}}else Object(i.a)("请先完成拼图验证")},clickSmsBtn:function(){this.$refs.dragComponent.dragToEnd?this.handleSendSms():Object(i.a)("请先完成拼图验证")},handleSendSms:function(){var t=this,e=this.resetInfo.account,n=this.resetInfo.dragCaptchaToken;u.a.resetPasswordSMS({query:{mobile:e},data:{dragCaptchaToken:n}}).then(function(e){t.resetInfo.smsToken=e.smsToken,t.countDown()}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.resetInfo.dragCaptchaToken="",t.resetInfo.smsToken=""}i.a.fail(e.message)})},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=120;var t=setInterval(function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--},1e3)}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"register"},[t.isLoading?n("e-loading"):t._e(),t._v(" "),n("span",{staticClass:"register-title"},[t._v("找回密码")]),t._v(" "),n("e-drag",{key:t.dragKey,ref:"dragComponent",on:{success:t.handleSmsSuccess}}),t._v(" "),n("van-field",{attrs:{placeholder:"请输入手机号或邮箱号","error-message":t.errorMessage.account},on:{blur:function(e){t.validateAccountOrPsw("account")},keyup:function(e){t.validatedChecker()}},model:{value:t.resetInfo.account,callback:function(e){t.$set(t.resetInfo,"account",e)},expression:"resetInfo.account"}}),t._v(" "),n("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===t.accountType,expression:"accountType === 'mobile'"}],attrs:{type:"password",maxLength:"20","error-message":t.errorMessage.encrypt_password,placeholder:"请设置密码（5-20位字符）"},on:{blur:function(e){t.validateAccountOrPsw("encrypt_password")}},model:{value:t.resetInfo.encrypt_password,callback:function(e){t.$set(t.resetInfo,"encrypt_password",e)},expression:"resetInfo.encrypt_password"}}),t._v(" "),n("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===t.accountType,expression:"accountType === 'mobile'"}],attrs:{type:"text",center:"",clearable:"",maxLength:"6",placeholder:"请输入验证码"},model:{value:t.resetInfo.smsCode,callback:function(e){t.$set(t.resetInfo,"smsCode",e)},expression:"resetInfo.smsCode"}},[n("van-button",{attrs:{slot:"button",size:"small",type:"primary",disabled:t.count.codeBtnDisable||!t.validated.account},on:{click:t.clickSmsBtn},slot:"button"},[t._v("\n        发送验证码\n        "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.count.showCount,expression:"count.showCount"}]},[t._v("("+t._s(t.count.num)+")")])])],1),t._v(" "),n("van-button",{staticClass:"primary-btn mb20",attrs:{type:"default",disabled:t.btnDisable},on:{click:t.handleSubmit}},[t._v("确认")])],1)},staticRenderFns:[]},f=n("VU/8")(m,h,!1,null,null,null);t.default=f.exports}});