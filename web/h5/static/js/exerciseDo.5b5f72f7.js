(window.webpackJsonp=window.webpackJsonp||[]).push([["exerciseDo"],{"057e":function(e,t,i){"use strict";var n=i("db72"),s=i("2f62"),r={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:Object(n.a)({},Object(s.d)({user:function(e){return e.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var e="".concat(this.user.id,"-task-visited");localStorage.getItem(e),localStorage.getItem(e)||(this.isFristVisited=!0,localStorage.setItem(e,!0))}}},a=i("0c7c"),o=Object(a.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(t){e.isFristVisited=!1}}},[i("div",{staticClass:"guide__text"},[e._v("左右切换滑动")]),e._m(0)])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"guide__gesture"},[t("img",{attrs:{src:"static/images/leftslide.png"}}),t("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);t.a=o.exports},"391c":function(e,t,i){"use strict";i("e17f");var n=i("2241");i("456d"),i("ac6a"),t.a={methods:{canDoing:function(e,t){return new Promise((function(i,s){if(e&&"doing"===e.status){var r="exercise-".concat(t,"-").concat(e.id),a=JSON.parse(localStorage.getItem(r));a=a?Object.keys(a).forEach((function(e){a[e]=a[e].filter((function(e){return""!==e}))})):{},n.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的练习，是否继续？"}).then((function(){i()})).catch((function(){s({answer:a})}))}}))}}}},c8a5:function(e,t,i){"use strict";var n=i("3ce7"),s=i("faa5");t.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:e,taskId:t},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,n&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(e,t){var i=this,s={courseId:e,taskId:t};return new Promise((function(e,t){n.a.getCourseData({query:s}).then((function(t){i.reportFinishCondition=t.activity.finishCondition,e(t)})).catch((function(e){t(e)}))}))},reprtData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.isFinish||i){var r={};if("doing"===t){if(null!==this.reportResult){var a=this.reportResult.lastTime;r={lastTime:a}}s&&(r.watchTime=s)}var o={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:t};return new Promise((function(t,i){n.a.reportTask({query:o,data:r}).then((function(i){e.handleReprtResult(i),t(i)})).catch((function(e){i(e)}))}))}},handleReprtResult:function(e){this.reportResult=e,"finish"===e.result.status?(this.isFinish=!0,this.$store.commit(s.r,"finish"),this.$store.commit("course/".concat(s.v),e.completionRate)):this.$store.commit(s.r,"start")},intervalReportLearnTime:function(){var e=this;this.reportLearnTime=setInterval((function(){e.checkoutTime(),e.learnTime++}),1e3)},intervalReportData:function(){var e=this,t=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){e.reprtData("doing",!0)}),t)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}},ea75:function(e,t,i){"use strict";i.r(t),i("a481"),i("456d"),i("c5f6"),i("ac6a"),i("e7e5");var n=i("d399"),s=(i("e17f"),i("2241")),r=i("db72"),a=i("bd86"),o=i("3ce7"),c=i("faa5"),u=i("2f62"),l=i("057e"),h=i("f5cc"),d=i("391c"),f=i("8ae7"),m=i("c8a5"),p="",v={name:"ExerciseDo",components:{itemBank:h.a,guidePage:l.a},mixins:[d.a,f.a,m.a],data:function(){var e;return e={info:[],answer:{},lastAnswer:null,cardSeq:0,exercise:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null},Object(a.a)(e,"lastAnswer",null),Object(a.a)(e,"usedTime",null),Object(a.a)(e,"isHandExercise",!1),Object(a.a)(e,"slideIndex",0),e},computed:Object(r.a)({},Object(u.d)({isLoading:function(e){return e.isLoading},user:function(e){return e.user}})),watch:{answer:{handler:"saveAnswer",deep:!0}},created:function(){this.getData(),this.initReport()},beforeRouteEnter:function(e,t,i){p="/"===t.fullPath?"/":"",i()},beforeRouteLeave:function(e,t,i){0==this.info.length||this.isHandExercise||"doing"!=this.exercise.status?i():this.submitpaper()?i():i(!1)},beforeDestroy:function(){this.clearTime(),s.a.close()},methods:Object(r.a)({},Object(u.c)({setNavbarTitle:c.n}),{},Object(u.b)("course",["handExercisedo"]),{getData:function(){var e=this,t=this.$route.query.exerciseId,i=this.$route.query.targetId;this.$route.query.action,o.a.getExerciseInfo({query:{exerciseId:t},data:{targetId:i,targetType:"task"}}).then((function(t){e.afterGetData(t)})).catch((function(t){var i=n.a.fail(t.message);"4036706"==t.code&&setTimeout((function(){e.toIntro(),i.clear()}),2e3)}))},initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.targetId,"exercise")},afterGetData:function(e){this.setNavbarTitle(e.paperName),this.exercise=e,this.isDoing()||(this.getLocalData(),this.formatData(e),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.exercise.status&&(this.showResult(),!0)},interruption:function(){var e=this;this.$route.params.KeepDoing||this.canDoing(this.exercise,this.user.id).then((function(){})).catch((function(t){var i=t.answer;e.submitExercise(i)}))},formatData:function(e){var t=this;e.items.forEach((function(e){if("material"!=e.type){var i=t.sixType(e.type,e,t.lastAnswer);t.$set(t.answer,e.id,i.answer),t.info.push(i.item)}if("material"==e.type){var n=Object.assign({},e,{subs:""});e.subs.forEach((function(i,s){i.parentTitle=n,i.parentType=e.type,i.materialIndex=s+1;var r=t.sixType(i.type,i,t.lastAnswer);t.$set(t.answer,i.id,r.answer),t.info.push(r.item)}))}}))},formatStatus:function(e,t){var i=0;return("single_choice"==e||"choice"==e||"uncertain_choice"==e||"determine"==e)&&this.answer[t].length>0?i=1:"essay"==e&&""!=this.answer[t][0]?i=1:"fill"==e?i=Number(this.answer[t].some((function(e){return""!=e}))):i},slideToNumber:function(e){var t=Number(e);this.cardSeq=t,this.cardShow=!1},getLocalData:function(){this.localanswerName="exercise-".concat(this.user.id,"-").concat(this.exercise.id),this.localuseTime="exercise-".concat(this.user.id,"-").concat(this.exercise.id,"-usedTime"),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveAnswer:function(e){localStorage.setItem(this.localanswerName,JSON.stringify(e))},saveTime:function(){var e=this,t=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval((function(){localStorage.setItem(e.localuseTime,++t)}),1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var e=this,t=0,i="题目已经做完，确认提交吗?",n=JSON.parse(JSON.stringify(this.answer));Object.keys(n).forEach((function(e){n[e]=n[e].filter((function(e){return""!==e})),0===n[e].length&&t++})),t>0&&(i="还有".concat(t,"题未做，确认提交吗？")),s.a.confirm({title:"提交",cancelButtonText:"立即提交",confirmButtonText:"检查一下",message:i}).then((function(){return e.cardShow=!0,!1})).catch((function(){e.clearTime(),e.submitExercise(n).then((function(e){return!0})).catch((function(e){return!1}))}))},submitExercise:function(e){var t=this;e||(e=JSON.parse(JSON.stringify(this.answer)),Object.keys(e).forEach((function(t){e[t]=e[t].filter((function(e){return""!==e}))})));var i={answer:e,exerciseId:this.$route.query.exerciseId,userId:this.user.id,exerciseResultId:this.exercise.id};return new Promise((function(e,s){t.handExercisedo(i).then((function(i){t.isHandExercise=!0,e(),t.reprtData("finish"),t.showResult()})).catch((function(i){var r=n.a.fail(i.message);"4036705"==i.code?setTimeout((function(){t.isHandExercise=!0,r.clear(),e(),t.showResult()}),2e3):s()}))}))},showResult:function(){this.$router.replace({name:"exerciseResult",query:{exerciseId:this.$route.query.exerciseId,exerciseResultId:this.exercise.id,taskId:this.$route.query.targetId,backUrl:p,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"exerciseIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:p}})}})},g=i("0c7c"),I=Object(g.a)(v,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"paper-swiper"},[e.isLoading?i("e-loading"):e._e(),e.info.length>0?i("item-bank",{attrs:{current:e.cardSeq,info:e.info,answer:e.answer,"show-score":!1,"slide-index":e.slideIndex,all:e.info.length},on:{"update:current":function(t){e.cardSeq=t},"update:answer":function(t){e.answer=t},"update:slideIndex":function(t){e.slideIndex=t},"update:slide-index":function(t){e.slideIndex=t}}}):e._e(),i("guide-page"),i("div",{staticClass:"paper-footer"},[i("div",[i("span",{on:{click:function(t){e.cardShow=!0}}},[i("i",{staticClass:"iconfont icon-Questioncard"}),e._v("\n        题卡\n      ")])]),i("div",[i("span",{on:{click:e.submitpaper}},[i("i",{staticClass:"iconfont icon-submit"}),e._v("\n        提交\n      ")])])]),i("van-popup",{attrs:{position:"bottom"},model:{value:e.cardShow,callback:function(t){e.cardShow=t},expression:"cardShow"}},[e.info.length>0?i("div",{staticClass:"card"},[i("div",{staticClass:"card-title"},[i("div",[i("span",{staticClass:"card-finish"},[e._v("已完成")]),i("span",{staticClass:"card-nofinish"},[e._v("未完成")])]),i("i",{staticClass:"iconfont icon-no",on:{click:function(t){e.cardShow=!1}}})]),i("div",{staticClass:"card-list"},[i("div",{staticClass:"card-homework-item"},[i("div",{staticClass:"card-item-list"},e._l(e.info,(function(t){return i("div",{key:t.id,class:["list-cicle",1==e.formatStatus(t.type,t.id)?"cicle-active":""],on:{click:function(i){return e.slideToNumber(t.seq)}}},[e._v(e._s(t.seq))])})),0)])])]):e._e()])],1)}),[],!1,null,null,null);t.default=I.exports}}]);