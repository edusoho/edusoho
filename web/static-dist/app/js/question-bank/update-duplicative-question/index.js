!function(e){function t(t){for(var i,o,r=t[0],l=t[1],c=t[2],d=0,h=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&h.push(s[o][0]),s[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(u&&u(t);h.length;)h.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],i=!0,r=1;r<a.length;r++){var l=a[r];0!==s[l]&&(i=!1)}i&&(n.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},s={364:0},n=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/static-dist/";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;n.push([1570,0]),a()}({1570:function(e,t,a){"use strict";a.r(t);var i=a(25),s=a.n(i),n=a(18),o=a.n(n),r=a(188),l=a.n(r),c={data:function(){var e={};return(e=JSON.parse($("[name=item]").val())).questions=l()(e.questions),{fileId:0,subject:e,bank_id:$("[name=bank_id]").val(),category:JSON.parse($("[name=category]").val()),showCKEditorData:{publicPath:$("[name=ckeditor_path]").val(),filebrowserImageUploadUrl:$("[name=ckeditor_image_upload_url]").val(),filebrowserImageDownloadUrl:$("[name=ckeditor_image_download_url]").val(),language:"zh_CN"===document.documentElement.lang?"zh-cn":document.documentElement.lang,jqueryPath:$("[name=jquery_path]").val()},type:$("[name=type]").val(),showAttachment:$("[name=show_attachment]").val(),cdnHost:$("[name=cdn_host]").val(),uploadSDKInitData:{ui:"batch",multiple:!0,multitaskNum:3,fileNumLimit:3,sdkBaseUri:app.cloudSdkBaseUri,disableDataUpload:app.cloudDisableLogReport,disableSentry:app.cloudDisableLogReport,initUrl:$("[name=upload_init_url]").val(),finishUrl:$("[name=upload_finish_url]").val(),accept:JSON.parse($("[name=upload_accept]").val()),fileSingleSizeLimit:$("[name=upload_size_limit]").val(),locale:document.documentElement.lang},isDownload:!1,isDisable:null}},methods:{goLast:function(){window.history.back()},getData:function(e){var t=this,a=this;a.isDisable=!0,this.getRepeatStem(e).then((function(i){i?t.$confirm({title:Translator.trans("created.question.confirm.title"),okText:Translator.trans("created.question.confirm.ok.btn"),cancelText:Translator.trans("created.question.confirm.close.btn"),icon:"exclamation-circle",onOk:function(){a.isDisable=!1,a.forceRemoveModalDom()},onCancel:function(){a.createdItemQuestion(e),a.forceRemoveModalDom()}}):a.createdItemQuestion(e)})).catch((function(e){console.log(e),a.$message.error(e.message)}))},goBack:function(){window.location.href=$("[name=back_url]").val()},deleteAttachment:function(e){this.fileId=e},previewAttachment:function(e){this.fileId=e},downloadAttachment:function(e){this.fileId=e},previewAttachmentCallback:function(){var e=this,t=this;return new o.a((function(a){$.ajax({url:$("[name=preview-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){e.data.sdkBaseUri=app.cloudSdkBaseUri,e.data.disableDataUpload=app.cloudDisableLogReport,e.data.disableSentry=app.cloudDisableLogReport,a(e),t.fileId=0}))}))},downloadAttachmentCallback:function(){var e=this,t=this;return new o.a((function(a){$.ajax({url:$("[name=download-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){a(e),t.fileId=0}))}))},deleteAttachmentCallback:function(){var e=this,t=this;return new o.a((function(a){$.ajax({url:$("[name=delete-attachment-url]").val(),type:"post",data:{id:e.fileId},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){a(e),t.fileId=0}))}))},getRepeatStem:function(e){var t=""!==e.data.material?e.data.material:e.data.questions[0].stem;return new o.a((function(a){$.ajax({url:$("[name=check_duplicative_url]").val(),contentType:"application/json;charset=utf-8",type:"post",data:s()({material:t,itemId:e.data.id}),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){a(e)}))}))},forceRemoveModalDom:function(){var e=document.querySelector(".ant-modal-root");e&&e.remove(),document.body.style=""},createdItemQuestion:function(e){var t=e.isAgain?"continue":"";(e=e.data).submission=t,e.type=$("[name=type]").val();$.ajax({url:$("[name=update_url]").val(),contentType:"application/json;charset=utf-8",type:"post",data:s()(e),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$("meta[name=csrf-token]").attr("content"))}}).done((function(e){window.location.href=$("[name=back_url]").val()+"?type=afterEdit"}))}}},u=a(21),d=Object(u.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ibs-vue",attrs:{id:"update-duplicate-check"}},[a("div",{staticClass:"duplicate-head flex items-center"},[a("span",{staticClass:"duplicate-back flex items-center",on:{click:e.goLast}},[a("span",{staticClass:"es-icon es-icon-fanhui mr4"}),e._v("\n      "+e._s(e._f("trans")("importer.import_back_btn"))+"\n    ")]),e._v(" "),a("span",{staticClass:"duplicate-divider"}),e._v(" "),a("span",{staticClass:"duplicate-title"},[e._v(e._s(e._f("trans")("question.bank.head.edit")))])]),e._v(" "),a("div",{staticClass:"duplicate-body flex"},[a("item-manage",{staticStyle:{margin:"20px auto",width:"100%"},attrs:{bank_id:e.bank_id,mode:"edit",category:e.category,subject:e.subject,type:e.type,showCKEditorData:e.showCKEditorData,showAttachment:e.showAttachment,cdnHost:e.cdnHost,isDownload:e.isDownload,isDisable:e.isDisable,uploadSDKInitData:e.uploadSDKInitData,deleteAttachmentCallback:e.deleteAttachmentCallback,previewAttachmentCallback:e.previewAttachmentCallback,downloadAttachmentCallback:e.downloadAttachmentCallback},on:{getData:e.getData,goBack:e.goBack,deleteAttachment:e.deleteAttachment,previewAttachment:e.previewAttachment,downloadAttachment:e.downloadAttachment}})],1)])}),[],!1,null,null,null).exports,h=a(212),m=a(108),p=a.n(m);Vue.prototype.$qs=p.a,Vue.filter("trans",(function(e,t){return e?Translator.trans(e,t):""})),Vue.component(h.a.name,h.a),new Vue({el:"#app",render:function(e){return e(d)}})},188:function(e,t,a){e.exports=a(270)},212:function(e,t,a){"use strict";var i=a(12),s=a.n(i),n=a(35),o=a.n(n),r=a(18),l=a.n(r),c=a(25),u=a.n(c),d=a(34),h=a.n(d),m=a(51),p=a.n(m),f=a(161),b=a(57),g=a(45),y=a(1688),w={name:"base-type",components:{attachmentUpload:f.a,APopconfirm:y.a},mixins:[b.a,g.a],data:function(){return{formLayout:"horizontal",difficultySelect:[{lable:this.t("Simple"),value:"simple"},{lable:this.t("Normal"),value:"normal"},{lable:this.t("Difficult"),value:"difficulty"}],material:{validateStatus:"",errorMsg:""},publicPath:Object({NODE_ENV:"production"}).BASE_URL,customStyle:"background: #ffffff;border: 0",materialEditor:"",analysisEditor:""}},created:function(){},inject:["subject","category","bank_id","showCKEditorData","showAttachment","uploadSDKInitData","cdnHost","self"],computed:{treeData:function(){var e=JSON.parse(u()(this.category));return this.formateCategory(e),e.unshift({value:0,title:this.t("None"),key:0}),e}},props:{form:{type:Object,default:function(){}},showMaterial:{type:Boolean,default:!1},showAnalysis:{type:Boolean,default:!1},showCategory:{type:Boolean,default:!0},showDifficulty:{type:Boolean,default:!0},mode:{type:String,default:"create"},isSubItem:{type:Boolean,default:!1},showModelBtn:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),e.showMaterial&&(e.initBaseMaterial(),e.initBaseAnalysis())}))}))}))},methods:{formateCategory:function(e){var t=this;e.forEach((function(e){e.value=e.id,e.title=e.name,e.key="".concat(e.name).concat(e.id),e.children&&t.formateCategory(e.children)}))},setCategoryId:function(e,t){this.form.setFieldsValue(h()({},"base['category_name']",t[0])),this.form.setFieldsValue(h()({},"base['category_id']",e))},setDifficulty:function(e){this.form.setFieldsValue(h()({},"base['difficulty']",e.target.value))},initBaseMaterial:function(){var e=this;this.materialEditor=window.CKEDITOR.replace("base-question-type_base['material']",{toolbar:"Minimal",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),this.materialEditor.setData(this.subject.material),this.materialEditor.on("change",(function(){var t=e.materialEditor.getData();0==e.errorList.length&&e.$emit("changeEditor",t),e.form.setFieldsValue(h()({},"base['material']",t)),e.checkMaterial(t)})),this.materialEditor.on("blur",(function(){var t=e.materialEditor.getData();e.form.setFieldsValue(h()({},"base['material']",t)),e.checkMaterial(t)}))},initBaseAnalysis:function(){var e=this;this.analysisEditor=window.CKEDITOR.replace("base-question-type_base['analysis']",{toolbar:"Minimal",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),this.analysisEditor.setData(this.subject.analysis),this.analysisEditor.on("change",(function(){e.form.setFieldsValue(h()({},"base['analysis']",e.analysisEditor.getData())),e.analysis=e.analysisEditor.getData()})),this.analysisEditor.on("blur",(function(){e.form.setFieldsValue(h()({},"base['analysis']",e.analysisEditor.getData())),e.analysis=e.analysisEditor.getData()}))},checkMaterial:function(e){e?(this.material.validateStatus="",this.material.errorMsg=""):(this.material.validateStatus="error",this.material.errorMsg=this.t("itemManage.MaterialRule"))},handleSubmit:function(e){e.preventDefault(),this.dispatch("item-manage","changeAgain",!1),this.showMaterial&&this.checkMaterial(this.form.getFieldValue("base['material']")),this.$emit("getFromInfo")},handleSubmitAgain:function(e){e.preventDefault(),this.dispatch("item-manage","changeAgain",!0),this.showMaterial&&this.checkMaterial(this.form.getFieldValue("base['material']")),this.$emit("getFromInfo")},cancel:function(){this.dispatch("material","closeModal"),this.dispatch("item-import","closeModal")},toGoBack:function(){this.dispatch("item-manage","toGoBack")},getFileInfo:function(e){this.$emit("getMaterialAttachment",e)},deleteFile:function(e){this.$emit("deleteMaterialAttachment",e)},onFileSort:function(e){this.$emit("onFileSort",e)},getAttachmentTypeData:function(e){return"create"===this.mode?[]:this.subject.attachments.filter((function(t){return t.module==e}))},confirm:function(){this.$emit("clickConfirm"),document.getElementById("ib-treeSelect").scrollTo({behavior:"smooth",top:0})},cancelPopconfim:function(e){var t=this;e.preventDefault(),this.dispatch("item-manage","changeAgain",!1),this.showMaterial&&this.checkMaterial(this.form.getFieldValue("base['material']")),0==this.errorList.length&&this.$emit("getInitRepeatQuestion"),this.$nextTick((function(){t.$emit("renderFormula")})),this.$emit("closeConfirm"),this.$emit("getFromInfo")},handleData:function(e){this.cancelPopconfim(e)}}},v=a(21),_=Object(v.a)(w,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-bank-sdk ibs-base",attrs:{id:"ib-treeSelect"}},[a("a-form-item",{attrs:{label:"","label-col":{span:4},"wrapper-col":{span:16},required:""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['bank_id']",{initialValue:e.bank_id}],expression:"[\n        `base['bank_id']`,\n        {\n          initialValue: bank_id\n        }\n      ]"}],attrs:{type:"hidden"}})],1),e._v(" "),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showCategory,expression:"showCategory"}],attrs:{label:e.t("itemManage.ItemCategory"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['category_id']",{initialValue:e.subject.category_id}],expression:"[\n        `base['category_id']`,\n        { initialValue: subject.category_id }\n      ]"}],staticStyle:{width:"200px"},attrs:{showSearch:"",dropdownStyle:{maxHeight:"400px",overflow:"auto"},treeData:e.treeData,getPopupContainer:function(t){return t.parentNode||e.document.body},treeNodeFilterProp:"title",placeholder:"Please select"},on:{change:e.setCategoryId}})],1),e._v(" "),a("a-form-item",{staticStyle:{marginBottom:"0"},attrs:{label:"","label-col":{span:0},"wrapper-col":{span:20}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['category_name']",{initialValue:""}],expression:"[`base['category_name']`, { initialValue: '' }]"}],attrs:{type:"hidden"}})],1),e._v(" "),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showDifficulty,expression:"showDifficulty"}],attrs:{label:e.t("Difficulty"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['difficulty']",{initialValue:e.subject.difficulty}],expression:"[\n        `base['difficulty']`,\n        { initialValue: subject.difficulty }\n      ]"}],attrs:{name:"radioGroup"},on:{change:e.setDifficulty}},e._l(e.difficultySelect,(function(t,i){return a("a-radio",{key:i,attrs:{value:t.value}},[e._v(e._s(t.lable))])})),1)],1),e._v(" "),e.showMaterial?a("a-form-item",{attrs:{label:e.t("itemManage.MaterialLabel"),"label-col":{span:4},"wrapper-col":{span:16},required:"","validate-status":e.material.validateStatus,help:e.material.errorMsg}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['material']",{initialValue:e.subject.material,rules:[{required:!0}]}],expression:"[\n        `base['material']`,\n        { initialValue: subject.material, rules: [{ required: true }] }\n      ]"}],attrs:{rows:0,"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl}})],1):e._e(),e._v(" "),e.showMaterial&&e.showAttachment?a("a-form-item",{attrs:{label:e.t("itemManage.MaterialAttachment"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("attachment-upload",{attrs:{bodyDom:"item-bank-create",module:"material",mode:e.mode,fileShowData:e.getAttachmentTypeData("material"),cdnHost:e.cdnHost,uploaderData:e.uploadSDKInitData},on:{onFileSort:e.onFileSort,deleteFile:e.deleteFile,getFileInfo:e.getFileInfo}})],1):e._e(),e._v(" "),e._t("questions"),e._v(" "),a("a-collapse",{directives:[{name:"show",rawName:"v-show",value:e.showAnalysis,expression:"showAnalysis"}],attrs:{bordered:!1},scopedSlots:e._u([{key:"expandIcon",fn:function(e){return[a("div",{attrs:{rotate:e.isActive?90:0}})]}}])},[e._v(" "),a("a-collapse-panel",{key:"1",style:e.customStyle,attrs:{header:e.t("itemManage.ToggleShowChoose"),forceRender:!0}},[a("a-form-item",{attrs:{label:e.t("Explain"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["base['analysis']",{initialValue:e.subject.analysis}],expression:"[\n            `base['analysis']`,\n            { initialValue: subject.analysis }\n          ]"}],attrs:{rows:4,"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl}})],1),e._v(" "),e.showAttachment?a("a-form-item",{attrs:{label:e.t("ExplainAttachment"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("attachment-upload",{attrs:{bodyDom:"item-bank-create",mode:e.mode,module:"analysis",cdnHost:e.cdnHost,uploaderData:e.uploadSDKInitData,fileShowData:e.getAttachmentTypeData("analysis")},on:{onFileSort:e.onFileSort,deleteFile:e.deleteFile,getFileInfo:e.getFileInfo}})],1):e._e()],1)],1),e._v(" "),e._t("subQuestions"),e._v(" "),e.isSubItem||e.showModelBtn?a("a-form-item",{staticClass:"ibs-base-footer",attrs:{"wrapper-col":{span:8,offset:16}}},[e.self.isWrong?a("a-popconfirm",{attrs:{placement:"topRight",title:e.t("questionPopconfimTitle"),"ok-text":e.t("ContinueEditing"),okType:"primary","cancel-text":e.t("DirectCreation")},on:{confirm:e.confirm,cancel:function(t){return e.cancelPopconfim(t)}}},[a("a-icon",{attrs:{slot:"icon",type:"exclamation-circle"},slot:"icon"}),e._v(" "),a("a-button",{staticClass:"ibs-base--save",attrs:{type:"primary",disabled:e.isDisable}},[e._v("\n        "+e._s(e.t("Save"))+"\n      ")])],1):a("a-button",{staticClass:"ibs-base--save",attrs:{type:"primary",disabled:e.isDisable},on:{click:e.handleData}},[e._v("\n      "+e._s(e.t("Save"))+"\n    ")]),e._v(" "),a("a-button",{attrs:{type:"link"},on:{click:e.cancel}},[e._v(e._s(e.t("cancel")))])],1):a("a-form-item",{staticClass:"ibs-base-footer",attrs:{"wrapper-col":{span:12,offset:4}}},["create"==e.mode?a("a-button",{attrs:{type:"primary",disabled:e.isDisable},on:{click:e.handleSubmitAgain}},[e._v(e._s(e.t("itemManage.SaveThenAdd")))]):e._e(),e._v(" "),a("a-button",{staticClass:"ibs-base--save",attrs:{type:"primary",disabled:e.isDisable},on:{click:e.handleSubmit}},[e._v("\n      "+e._s(e.t("Save"))+"\n    ")]),e._v(" "),a("a-button",{attrs:{type:"link"},on:{click:e.toGoBack}},[e._v(e._s(e.t("Back")))])],1)],2)}),[],!1,null,null,null).exports,S=a(261),D={stem:"",seq:5,score:"2.0",answer:[],analysis:"",attachments:[]},E={name:"answer-model",components:{baseType:_,attachmentUpload:f.a,AiAnalysis:S.a},mixins:[b.a,g.a],data:function(){return{stem:{validateStatus:"",errorMsg:""},customStyle:"background: #ffffff;border: 0",publicPath:Object({NODE_ENV:"production"}).BASE_URL,stemEditor:"",analysisEditor:"",inheritAttrs:!1,scoreTypeHelp:"",scoreTypeValidateStatus:"success",isWrong:!1}},props:{questions:{type:Object,default:function(){return D}},form:{type:Object,default:function(){}},itemType:{type:String,default:""},mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},answer:{type:Array,default:function(){return[]}},errorList:{type:Array,default:function(){return[]}}},inject:["showCKEditorData","showAttachment","uploadSDKInitData","cdnHost"],created:function(){},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),"fill"!==e.itemType&&e.initBaseStem(),e.initBaseAnalysis()}))}))}))},methods:{initBaseStem:function(){var e=this;this.stemEditor=window.CKEDITOR.replace("base-question-type_questions['stem']",{toolbar:"Minimal",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),this.stemEditor.setData(this.questions.stem),this.stemEditor.on("change",(function(){var t=e.stemEditor.getData();0==e.errorList.length&&e.$emit("changeEditor",t),e.form.setFieldsValue(h()({},"questions['stem']",t)),e.checkStem(t)})),this.stemEditor.on("blur",(function(){var t=e.stemEditor.getData();e.form.setFieldsValue(h()({},"questions['stem']",t)),e.checkStem(t)}))},initBaseAnalysis:function(){var e=this;this.analysisEditor=window.CKEDITOR.replace("base-question-type_questions['analysis']",{toolbar:"Minimal",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),this.analysisEditor.setData(this.questions.analysis),this.analysisEditor.on("change",(function(){e.form.setFieldsValue(h()({},"questions['analysis']",e.analysisEditor.getData())),e.outanalysis=e.analysisEditor.getData()})),this.analysisEditor.on("blur",(function(){e.form.setFieldsValue(h()({},"questions['analysis']",e.analysisEditor.getData())),e.outanalysis=e.analysisEditor.getData()}))},checkScore:function(e,t,a){t<0?a(this.t("ScoreRule.one")):t>999?a(this.t("ScoreRule.two")):/^(([1-9]{1}\d{0,2})|([0]{1}))(\.(\d){1})?$/.test(t)?a():a(this.t("ScoreRule.three"))},checkOtherScore:function(e,t,a){var i=this.form.getFieldsValue(["questions['score']","questions['otherScore1']","questions['otherScore2']","questions['scoreType']"]).questions,s=i.score,n=i.otherScore1,o=i.otherScore2,r=i.scoreType;if("question"===r&&n>s){var l="漏选得分不得大于总分";return this.scoreTypeHelp=l,this.scoreTypeValidateStatus="error",void a(l)}var c=o*this.answer.length;if("option"===r&&c>s){var u="每项得分乘以正确选项数不得大于总分";return this.scoreTypeHelp=u,this.scoreTypeValidateStatus="error",void a(u)}this.scoreTypeHelp="",this.scoreTypeValidateStatus="success",a()},checkStem:function(e){e?(this.stem.validateStatus="",this.stem.errorMsg=""):(this.stem.validateStatus="error",this.stem.errorMsg=this.t("itemManage.StemRule"))},getFromInfo:function(){this.checkStem(this.form.getFieldValue("questions['stem']")),this.$emit("getFromInfo")},getFileInfo:function(e){this.questions.attachments.push(e),this.$emit("getUploadFile",e)},onFileSort:function(e){this.$set(this.questions,"attachments",e)},deleteFile:function(e){var t=this.questions.attachments.filter((function(t){return t.id!==e}));this.$set(this.questions,"attachments",t)},getAttachmentTypeData:function(e){return"create"===this.mode?[]:this.questions.attachments.filter((function(t){return t.module==e}))},clickConfirm:function(){this.isWrong=!0},closeConfirm:function(){this.isWrong=!1},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this;this.form.validateFields((function(a){a?t.getFromInfo():t.$emit("prepareTeacherAiAnalysis",e)}))},clearAnalysis:function(){this.analysisEditor.setData("")},appendAnalysis:function(e){this.analysisEditor.insertHtml(e)}}},A=Object(v.a)(E,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("base-type",e._b({attrs:{form:e.form,mode:e.mode,isDisable:e.isDisable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,clickConfirm:e.clickConfirm,closeConfirm:e.closeConfirm,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion},scopedSlots:e._u([{key:"questions",fn:function(){return[e._t("stem",[a("a-form-item",{attrs:{label:e.t("Stem"),"label-col":{span:4},"wrapper-col":{span:16},required:"","validate-status":e.stem.validateStatus,help:e.stem.errorMsg}},[a("div",{class:{"is-wrong":e.isWrong}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['stem']",{initialValue:e.questions.stem,rules:[{required:!0}]}],expression:"[\n              `questions['stem']`,\n              {\n                initialValue: questions.stem,\n                rules: [{ required: true }]\n              }\n            ]"}],attrs:{"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl,rows:0}}),e._v(" "),e.isWrong?a("div",{staticClass:"wrong-text"},[e._v("\n            "+e._s(e.t("wrongText"))+"\n          ")]):e._e()],1)])]),e._v(" "),e.showAttachment?a("a-form-item",{attrs:{label:e.t("itemManage.StemAttachment"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("attachment-upload",{attrs:{bodyDom:"item-bank-create",mode:e.mode,module:"stem",fileShowData:e.getAttachmentTypeData("stem"),cdnHost:e.cdnHost,uploaderData:e.uploadSDKInitData},on:{deleteFile:e.deleteFile,onFileSort:e.onFileSort,getFileInfo:e.getFileInfo}})],1):e._e(),e._v(" "),e._t("response_points"),e._v(" "),a("a-collapse",{attrs:{bordered:!1},scopedSlots:e._u([{key:"expandIcon",fn:function(e){return[a("div",{attrs:{rotate:e.isActive?90:0}})]}}])},[e._v(" "),a("a-collapse-panel",{key:"1",style:e.customStyle,attrs:{header:e.t("itemManage.ToggleShowChoose"),forceRender:!0}},[a("a-form-item",{attrs:{label:e.t("Explain"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['analysis']",{initialValue:e.questions.analysis}],expression:"[\n              `questions['analysis']`,\n              { initialValue: questions.analysis }\n            ]"}],attrs:{rows:4,"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl}}),e._v(" "),e.aiAnalysisEnable&&!1!==e.questions.aiAnalysisEnable?a("ai-analysis",{on:{prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis,clearAnalysis:e.clearAnalysis,appendAnalysis:e.appendAnalysis}}):e._e()],1),e._v(" "),e.showAttachment?a("a-form-item",{attrs:{label:e.t("ExplainAttachment"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("attachment-upload",{attrs:{bodyDom:"item-bank-create",mode:e.mode,module:"analysis",cdnHost:e.cdnHost,uploaderData:e.uploadSDKInitData,fileShowData:e.getAttachmentTypeData("analysis")},on:{deleteFile:e.deleteFile,onFileSort:e.onFileSort,getFileInfo:e.getFileInfo}})],1):e._e(),e._v(" "),"fill"===e.itemType?a("a-form-item",{attrs:{label:e.t("Score"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['otherScore']",{rules:[{validator:e.checkScore}],initialValue:e.questions.otherScore||2}],expression:"[\n              `questions['otherScore']`,\n              {\n                rules: [{ validator: checkScore }],\n                initialValue: questions.otherScore || 2\n              }\n            ]"}],staticStyle:{width:"200px"},attrs:{type:"number"}})],1):a("a-form-item",{attrs:{label:e.t("Score"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['score']",{rules:[{validator:e.checkScore}],initialValue:e.questions.score||2}],expression:"[\n              `questions['score']`,\n              {\n                rules: [{ validator: checkScore }],\n                initialValue: questions.score || 2\n              }\n            ]"}],staticStyle:{width:"200px"},attrs:{type:"number"}})],1),e._v(" "),["choice","uncertain_choice"].includes(e.itemType)?a("a-form-item",{attrs:{"wrapper-col":{span:16,offset:4},help:e.scoreTypeHelp,"validate-status":e.scoreTypeValidateStatus}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['scoreType']",{rules:[{validator:e.checkOtherScore}],initialValue:e.questions.scoreType}],expression:"[\n              `questions['scoreType']`,\n              {\n                rules: [{ validator: checkOtherScore }],\n                initialValue: questions.scoreType\n              }\n            ]"}],attrs:{name:"scoreType"}},[a("a-radio",{attrs:{value:"question"}},[e._v("\n              漏选得分\n              "),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['otherScore1']",{initialValue:"question"===e.questions.scoreType?e.questions.otherScore:0}],expression:"[\n                  `questions['otherScore1']`,\n                  {\n                    initialValue:\n                      questions.scoreType === 'question'\n                        ? questions.otherScore\n                        : 0\n                  }\n                ]"}],attrs:{min:0}})],1),e._v(" "),a("a-radio",{attrs:{value:"option"}},[e._v("\n              每个正确选项得分\n              "),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['otherScore2']",{initialValue:"option"===e.questions.scoreType?e.questions.otherScore:0}],expression:"[\n                  `questions['otherScore2']`,\n                  {\n                    initialValue:\n                      questions.scoreType === 'option'\n                        ? questions.otherScore\n                        : 0\n                  }\n                ]"}],attrs:{min:0}})],1)],1)],1):e._e(),e._v(" "),"fill"===e.itemType?a("a-form-item",{attrs:{"wrapper-col":{span:16,offset:4}}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['scoreType']",{initialValue:e.questions.scoreType||"question"}],expression:"[\n              `questions['scoreType']`,\n              {\n                initialValue: questions.scoreType || 'question'\n              }\n            ]"}],attrs:{name:"scoreType"}},[a("a-radio",{attrs:{value:"question"}},[e._v("\n              每题得分\n            ")]),e._v(" "),a("a-radio",{attrs:{value:"option"}},[e._v("\n              每空得分\n            ")])],1)],1):e._e()],1)],1)]},proxy:!0}],null,!0)},"base-type",e.$attrs,!1))}),[],!1,null,null,null).exports,k={stem:"",score:2,answer:[],analysis:"",answer_mode:"true_false",attachments:[]},q={name:"judge",mixins:[b.a,g.a],components:{answerModel:A},data:function(){return{form:this.$form.createForm(this,{name:"base-question-type"}),responseoints:{response_points:[{radio:{val:"T",text:this.t("Right")}},{radio:{val:"F",text:this.t("Wrong")}}]}}},inject:["bank_id","subject"],props:{subQuestions:{type:Object,default:function(){return s()(k,this.responseoints)}},isSubItem:{type:Boolean,default:!1},mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},computed:{questions:function(){return"edit"===this.mode?this.isSubItem?this.subQuestions:this.subject.questions[0]:s()(k,this.responseoints)},answer:function(){return this.questions.answer.length?this.questions.answer[0]:""},questionsSelect:function(){return this.questions.response_points}},methods:{setAnswer:function(e){this.form.setFieldsValue({answer:e.target.value})},checkJudge:function(e,t,a){t?a():a(this.t("itemManage.judgeRule"))},getFromInfo:function(){var e=this;this.form.validateFieldsAndScroll((function(t,a){t||e.formateData(a)}))},formateData:function(e){var t=JSON.parse(u()(this.questions));if(t.errors&&delete t.errors,this.isSubItem){var a={};(t=s()(t,e.questions)).answer=[e.answer],a.questions=[t],this.$emit("patchData",a)}else{var i=JSON.parse(u()(this.subject));i=s()(i,e.base),(t=s()(t,e.questions)).answer=[e.answer],t.answer_mode="true_false",i.questions=[t],console.log(i),this.$emit("patchData",i)}},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this,a={};this.form.validateFieldsAndScroll((function(i,n){if(!i){var o=JSON.parse(u()(t.questions));o=s()(o,n.questions),a.stem=o.stem,a.answer="T"===n.answer?"正确":"错误",t.isSubItem?(a.type="material-determine",t.$emit("prepareTeacherAiAnalysis",a,e)):(a.type="determine",e(a))}}))}}},I=Object(v.a)(q,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form}},[a("answer-model",e._b({attrs:{questions:e.questions,form:e.form,mode:e.mode,isSubItem:e.isSubItem,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis},scopedSlots:e._u([{key:"response_points",fn:function(){return[a("a-form-item",{attrs:{label:e.t("Answer"),"label-col":{span:4},"wrapper-col":{span:16},required:""}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["answer",{initialValue:e.answer,rules:[{validator:e.checkJudge}],trigger:"blur"}],expression:"[\n            'answer',\n            {\n              initialValue: answer,\n              rules: [{ validator: checkJudge }],\n              trigger: 'blur'\n            }\n          ]"}],attrs:{name:"radioGroup"},on:{change:e.setAnswer}},e._l(e.questionsSelect,(function(t,i){return a("a-radio",{key:i,attrs:{value:t.radio.val}},[e._v(e._s(t.radio.text)+"\n          ")])})),1)],1)]},proxy:!0}])},"answer-model",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,x={stem:"",score:2,response_points:[{radio:{val:0,text:""}},{radio:{val:1,text:""}},{radio:{val:2,text:""}},{radio:{val:3,text:""}}],answer:[""],analysis:"",answer_mode:"single_choice",attachments:[]},C={name:"single-choice",mixins:[b.a,g.a],components:{answerModel:A},inject:["subject","showCKEditorData"],data:function(){return{publicPath:Object({NODE_ENV:"production"}).BASE_URL,questions:{},form:this.$form.createForm(this,{name:"base-question-type"}),optionsEditor:{},optionsEditorRule:{},answer:"",optionsIndex:{A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19},optionKey:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T"]}},props:{subQuestions:{type:Object,default:function(){return x}},isSubItem:{type:Boolean,default:!1},mode:{type:String,default:"create"},optionsConfiguration:{type:Object,default:function(){return{maxItem:20,minItem:2}}},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},created:function(){this.initData()},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),e.initEdit()}))}))}))},methods:{getQuestions:function(){return"edit"===this.mode?this.isSubItem?this.subQuestions:this.subject.questions[0]:x},setAnswer:function(e){this.answer=e.target.value},getQuestionsSelect:function(){var e=JSON.parse(u()(this.questions.response_points));return"edit"===this.mode&&e.forEach((function(e,t){e.radio.val=t})),e},getAnswer:function(){return"edit"===this.mode?this.optionsIndex[this.questions.answer[0]]:""},initData:function(){this.questions=this.getQuestions(),this.answer=this.getAnswer(),this.form.getFieldDecorator("keys",{initialValue:this.getQuestionsSelect(),preserve:!0}),this.initOptionsEditorRule()},initEdit:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){e.initOptionsEditorRule(t.radio.val),e.optionsEditor["".concat(t.radio.val)]||(e.optionsEditor["".concat(t.radio.val)]=window.CKEDITOR.replace("base-question-type_options[".concat(t.radio.val,"]"),{toolbar:"Minimal",fileSingleSizeLimit:e.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:e.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:e.showCKEditorData.filebrowserImageDownloadUrl,language:e.showCKEditorData.language,height:120}),e.optionsEditor["".concat(t.radio.val)].on("change",(function(){var a=e.optionsEditor["".concat(t.radio.val)].getData();e.form.setFieldsValue(h()({},"options[".concat(t.radio.val,"]"),a)),e.checkOptionText(t.radio.val,a)})),e.optionsEditor["".concat(t.radio.val)].on("blur",(function(){var a=e.optionsEditor["".concat(t.radio.val)].getData();e.form.setFieldsValue(h()({},"options[".concat(t.radio.val,"]"),a)),e.checkOptionText(t.radio.val,a)})))}))},initOptionsEditorRule:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){e.optionsEditorRule["".concat(t.radio.val)]||(e.optionsEditorRule["".concat(t.radio.val)]={validateStatus:"",errorMsg:""})}))},checkOptionText:function(e,t){var a={validateStatus:"",errorMsg:""};t||(a.validateStatus="error",a.errorMsg=this.t("itemManage.chooseRule.one")),this.$set(this.optionsEditorRule,e,a)},checkAllOptionText:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){var a=e.form.getFieldValue("options[".concat(t.radio.val,"]"));e.checkOptionText(t.radio.val,a)}))},checkAnswer:function(){return!(!this.answer&&0!==this.answer)||(this.$message.error(this.t("itemManage.chooseRule.two")),!1)},add:function(){var e=this,t=this.form.getFieldValue("keys");if(t.length>=this.optionsConfiguration.maxItem)this.$message.error(this.t("itemManage.chooseRule.three"));else{var a=t[t.length-1].radio.val+1,i=t.concat({radio:{val:a,text:""}});this.form.setFieldsValue({keys:i}),this.initOptionsEditorRule(),this.$nextTick((function(){e.initEdit()}))}},remove:function(e,t){var a=this.form.getFieldValue("keys");a.length<=this.optionsConfiguration.minItem?this.$message.error(this.t("itemManage.chooseRule.four")):(this.form.setFieldsValue({keys:a.filter((function(e){return e.radio.val!==t.radio.val}))}),this.answer===t.radio.val&&(this.answer=""),this.optionsEditor[t.radio.val]=null)},getFromInfo:function(){var e=this;this.checkAllOptionText(),this.form.validateFieldsAndScroll((function(t,a){t||e.checkAnswer()&&e.formateData(a)}))},formatetAnswer:function(e){var t=this,a=[];return e.forEach((function(e,i){t.answer===e.radio.val&&a.push(t.optionKey[i])})),a},formateOptions:function(e){var t=this,a=[];return(e=e.filter((function(e){return e}))).forEach((function(e,i){a.push({radio:{val:t.optionKey[i],text:e}})})),a},formateData:function(e){var t=JSON.parse(u()(this.questions));if(t.errors&&delete t.errors,this.isSubItem){var a={};(t=s()(t,e.questions)).response_points=this.formateOptions(e.options),t.answer=this.formatetAnswer(e.keys),a.questions=[t],this.$emit("patchData",a)}else{var i=JSON.parse(u()(this.subject));i=s()(i,e.base),(t=s()(t,e.questions)).response_points=this.formateOptions(e.options),t.answer=this.formatetAnswer(e.keys),t.answer_mode="single_choice",i.questions=[t],this.$emit("patchData",i),console.log(i)}},getChoiceLabelNum:function(e){var t=this.t("itemManage.chooseItem");return"".concat(t).concat(e)},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this;this.form.validateFieldsAndScroll((function(a,i){if(!a){var n={},o=JSON.parse(u()(t.questions));o=s()(o,i.questions),n.stem=o.stem,n.options=[],i.options.forEach((function(e,a){n.options.push("".concat(t.optionKey[a],".").concat(e))})),n.answer=t.formatetAnswer(i.keys).join(),t.isSubItem?(n.type="material-choice",t.$emit("prepareTeacherAiAnalysis",n,e)):(n.type="choice",e(n))}}))}}},F=C,T=Object(v.a)(F,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form}},[a("answer-model",e._b({attrs:{questions:e.questions,mode:e.mode,form:e.form,isSubItem:e.isSubItem,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis},scopedSlots:e._u([{key:"response_points",fn:function(){return[a("div",{staticClass:"ibs-choice-wrap"},[a("a-radio-group",{attrs:{name:"radioGroup"},on:{change:e.setAnswer},model:{value:e.answer,callback:function(t){e.answer=t},expression:"answer"}},e._l(e.form.getFieldValue("keys"),(function(t,i){return a("a-form-item",{key:t.radio.val,staticClass:"choice-item",attrs:{label:e.getChoiceLabelNum(e.optionKey[i]),required:"","label-col":{span:4},"wrapper-col":{span:16},"validate-status":e.optionsEditorRule[t.radio.val].validateStatus||"",help:e.optionsEditorRule[t.radio.val].errorMsg||""}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["options["+t.radio.val+"]",{initialValue:t.radio.text,rules:[{required:!0}]}],expression:"[\n                `options[${k.radio.val}]`,\n                {\n                  initialValue: k.radio.text,\n                  rules: [{ required: true }]\n                }\n              ]"}],attrs:{"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl,placeholder:"",rows:0}}),e._v(" "),a("a-radio",{attrs:{value:t.radio.val}},[e._v(e._s(e.t("RightAnswer")))]),e._v(" "),a("a-button",{staticClass:"ibs-delete-btn",attrs:{size:"small"},on:{click:function(){return e.remove(i,t)}}},[a("i",{staticClass:"ib-icon ib-icon-delete"})])],1)})),1),e._v(" "),a("a-row",[a("a-col",{staticClass:"ibs-text-right",attrs:{offset:4,span:16}},[a("a-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v(e._s(e.t("itemManage.newChoice")))])],1)],1)],1)]},proxy:!0}])},"answer-model",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,M={stem:"",score:2,response_points:[{rich_text:{}}],answer:[],analysis:"",answer_mode:"rich_text",attachments:[]},$={name:"essay",mixins:[b.a,g.a],components:{answerModel:A},data:function(){return{answerText:{validateStatus:"",errorMsg:""},publicPath:Object({NODE_ENV:"production"}).BASE_URL,form:this.$form.createForm(this,{name:"base-question-type"})}},inject:["bank_id","subject","showCKEditorData"],props:{subQuestions:{type:Object,default:function(){return M}},isSubItem:{type:Boolean,default:!1},mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},computed:{questions:function(){return"edit"===this.mode?this.isSubItem?this.subQuestions:this.subject.questions[0]:M},answer:function(){return this.questions.answer.length?this.questions.answer[0]:""},questionsSelect:function(){return this.questions.response_points}},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),e.initAnswer()}))}))}))},methods:{initAnswer:function(){var e=this;this.answerEditor=window.CKEDITOR.replace("base-question-type_questions['answer']",{toolbar:"Minimal",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),this.answerEditor.setData(this.answer),this.answerEditor.on("change",(function(){var t=e.answerEditor.getData();e.form.setFieldsValue(h()({},"questions['answer']",t)),e.checkAnswer(t)})),this.answerEditor.on("blur",(function(){var t=e.answerEditor.getData();e.form.setFieldsValue(h()({},"questions['answer']",t)),e.checkAnswer(t)}))},checkAnswer:function(e){e?(this.answerText.validateStatus="",this.answerText.errorMsg=""):(this.answerText.validateStatus="error",this.answerText.errorMsg=this.t("itemManage.essayRule"))},getFromInfo:function(){var e=this;this.checkAnswer(this.form.getFieldValue("questions['answer']")),this.form.validateFieldsAndScroll((function(t,a){t||e.formateData(a)}))},formateData:function(e){var t=JSON.parse(u()(this.questions));if(t.errors&&delete t.errors,this.isSubItem){var a={};(t=s()(t,e.questions)).answer=[].concat(t.answer),a.questions=[t],this.$emit("patchData",a)}else{var i=JSON.parse(u()(this.subject));i=s()(i,e.base);(t=s()(t,e.questions)).answer=[].concat(t.answer),t.answer_mode="rich_text",i.questions=[t],this.$emit("patchData",i)}},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this;this.form.validateFieldsAndScroll((function(a,i){if(!a){var n={},o=JSON.parse(u()(t.questions));o=s()(o,i.questions),n.answer=[].concat(o.answer).join(),n.stem=o.stem,t.isSubItem?(n.type="material-essay",t.$emit("prepareTeacherAiAnalysis",n,e)):(n.type="essay",e(n))}}))}}},j=Object(v.a)($,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form}},[a("answer-model",e._b({attrs:{questions:e.questions,form:e.form,mode:e.mode,isSubItem:e.isSubItem,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis},scopedSlots:e._u([{key:"response_points",fn:function(){return[a("a-form-item",{attrs:{label:e.t("Answer"),"label-col":{span:4},"wrapper-col":{span:16},required:"","validate-status":e.answerText.validateStatus,help:e.answerText.errorMsg}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['answer']",{initialValue:e.answer,rules:[{required:!0}]}],expression:"[\n            `questions['answer']`,\n            {\n              initialValue: answer,\n              rules: [{ required: true }]\n            }\n          ]"}],attrs:{rows:0,"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl}})],1)]},proxy:!0}])},"answer-model",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,R={stem:"",score:2,response_points:[],answer:[],analysis:"",answer_mode:"text",attachments:[],case_sensitive:!0,scoreType:"question",otherScore:2},O={name:"fill",mixins:[b.a,g.a],components:{answerModel:A},data:function(){return{stemText:{validateStatus:"",errorMsg:""},message:this.t("itemManage.caseSensitiveClues"),checked:!0,type:"fill",publicPath:Object({NODE_ENV:"production"}).BASE_URL,form:this.$form.createForm(this,{name:"base-question-type"}),answers:[]}},inject:["bank_id","subject","showCKEditorData","showAttachment"],props:{subQuestions:{type:Object,default:function(){return R}},isSubItem:{type:Boolean,default:!1},mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},computed:{questions:function(){return"edit"===this.mode?this.isSubItem?this.subQuestions:this.subject.questions[0]:R},answer:function(){return this.getFillAnswer(this.stem.value)},questionsSelect:function(){return this.questions.response_points}},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),e.initBaseStem()}))})),e.initMessage()}))},methods:{initMessage:function(){this.message=this.$refs.initMessage.value?this.t("itemManage.caseSensitiveClues"):this.t("itemManage.ignoringCase")},initBaseStem:function(){var e=this;this.stemEditor=window.CKEDITOR.replace("base-question-type_questions['stem']",{toolbar:"Question",fileSingleSizeLimit:this.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:this.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.showCKEditorData.filebrowserImageDownloadUrl,language:this.showCKEditorData.language}),"edit"!=this.mode||this.isSubItem||(this.questions.stem=this.getEditFillStem(this.questions.stem),this.answers=this.getFillAnswer(this.questions.stem)),this.stemEditor.setData(this.questions.stem),this.stemEditor.on("change",(function(){var t=e.stemEditor.getData();e.answers=e.getFillAnswer(t),0==e.errorList.length&&e.$emit("changeEditor",t),e.form.setFieldsValue(h()({},"questions['stem']",t)),e.checkFillRule(t),e.form.setFieldsValue(h()({},"questions['stem']",e.stemEditor.getData()))}))},checkItem:function(e){e.target.checked?(this.subQuestions.case_sensitive=!0,this.message=this.t("itemManage.caseSensitiveClues")):(this.subQuestions.case_sensitive=!1,this.message=this.t("itemManage.ignoringCase"))},checkFillRule:function(e){return/(\[\[(.+?)\]\])/i.test(e)?(this.stemText.validateStatus="",this.stemText.errorMsg="",!0):(this.stemText.validateStatus="error",this.stemText.errorMsg=this.t("itemManage.fillRule"),!1)},reverseStr:function(e){for(var t="",a=0;a<e.length;a++){t+=e.charAt(e.length-1-a)}return t},getFillAnswer:function(e){for(var t,a=[],i=/\[\[(?:[^[\]]+|\[[^[\]]+\])+\]\]/g;null!==(t=i.exec(e));){var s=t[0];a.push(s.substring(2,s.length-2))}return a},getEditFillStem:function(e){var t=0,a=this;return e.replace(/\[\[(?:[^[\]]+|\[[^[\]]+\])+\]\]/g,(function(){return"[[".concat(a.questions.answer[t++],"]]")}))},getFromInfo:function(){var e=this;this.checkFillRule(this.form.getFieldValue("questions['stem']"))&&this.form.validateFieldsAndScroll((function(t,a){t||e.formateData(a)}))},formateData:function(e){var t=JSON.parse(u()(this.questions)),a=e.questions,i=a.stem,n=a.otherScore,o=a.scoreType,r=this.getFillAnswer(i);if(e.questions.score="question"===o?n:n*(r.length||0),t.errors&&delete t.errors,this.isSubItem){var l={};(t=s()(t,e.questions)).answer=this.getFillAnswer(t.stem);var c={text:[]},d=[];t.answer.forEach((function(){d.push(c)})),t.response_points=d,l.questions=[t],this.$emit("patchData",l)}else{var h=JSON.parse(u()(this.subject));h=s()(h,e.base),(t=s()(t,e.questions)).answer=this.getFillAnswer(t.stem),t.answer_mode="text";var m={text:[]},p=[];t.answer.forEach((function(){p.push(m)})),t.response_points=p,h.questions=[t],console.log(h),this.$emit("patchData",h)}},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this,a={};this.form.validateFieldsAndScroll((function(i,n){if(!i){var o=JSON.parse(u()(t.questions));o=s()(o,n.questions),a.stem=o.stem,a.answers=t.getFillAnswer(o.stem),t.isSubItem?(a.type="material-fill",t.$emit("prepareTeacherAiAnalysis",a,e)):(a.type="fill",e(a))}}))}}},Q=Object(v.a)(O,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form}},[a("answer-model",e._b({attrs:{questions:e.questions,form:e.form,mode:e.mode,isSubItem:e.isSubItem,itemType:e.type,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis},scopedSlots:e._u([{key:"stem",fn:function(){return[a("a-form-item",{attrs:{label:e.t("Stem"),"label-col":{span:4},"wrapper-col":{span:16},required:"","validate-status":e.stemText.validateStatus,help:e.stemText.errorMsg}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['stem']",{initialValue:e.questions.stem,rules:[{required:!0}]}],expression:"[\n            `questions['stem']`,\n            {\n              initialValue: questions.stem,\n              rules: [{ required: true }]\n            }\n          ]"}],attrs:{rows:0,"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.stemText.validateStatus,expression:"!stemText.validateStatus"}],staticClass:"ibs-dark-assist"},[e._v("\n          "+e._s(e.t("itemManage.clickEditOrButton"))),a("span",{staticClass:"ibs-danger-color"},[e._v(" [ ] ")]),e._v(e._s(e.t("itemManage.insertByself"))+"\n        ")]),e._v(" "),e._l(e.answers,(function(t,i){return a("div",{key:i},[a("span",{staticClass:"font-medium"},[e._v(e._s("答案["+(i+1)+"]:")+" ")]),e._v(" "),a("span",{staticStyle:{color:"#999"}},[e._v(e._s(t))]),a("br")])}))],2),e._v(" "),a("a-form-item",{attrs:{label:e.t("caseSensitiveShow"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["questions['case_sensitive']",{initialValue:0!=e.questions.case_sensitive}],expression:"[\n            `questions['case_sensitive']`,\n            {\n              initialValue: questions.case_sensitive == 0 ? false : true\n            }\n          ]"}],ref:"initMessage",attrs:{"default-checked":0!=e.questions.case_sensitive},on:{click:e.checkItem}}),e._v(" "),a("div",{staticClass:"ibs-dark-assist",attrs:{id:"checkbox"},domProps:{innerHTML:e._s(e.message)}})],1)]},proxy:!0}])},"answer-model",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,K={stem:"",score:2,response_points:[{checkbox:{val:0,text:""}},{checkbox:{val:1,text:""}},{checkbox:{val:2,text:""}},{checkbox:{val:3,text:""}}],answer:[],analysis:"",answer_mode:"choice",attachments:[],scoreType:"question",otherScore:0},V={name:"choice",mixins:[b.a,g.a],components:{answerModel:A},inject:["subject","showCKEditorData"],data:function(){return{publicPath:Object({NODE_ENV:"production"}).BASE_URL,questions:{},form:this.$form.createForm(this,{name:"base-question-type"}),optionsEditor:{},optionsEditorRule:{},answer:[],optionsIndex:{A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19},optionKey:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T"]}},props:{subQuestions:{type:Object,default:function(){return K}},isSubItem:{type:Boolean,default:!1},optionsConfiguration:{type:Object,default:function(){return{maxItem:20,MinItem:2}}},type:{type:String,default:"choice"},mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},created:function(){this.initData()},mounted:function(){var e=this;this.$nextTick((function(){p()(e.showCKEditorData.jqueryPath,(function(t){t&&console.log(t),p()(e.showCKEditorData.publicPath,(function(t){t&&console.log(t),e.initEdit()}))}))}))},methods:{getQuestions:function(){return"edit"===this.mode?this.isSubItem?this.subQuestions:this.subject.questions[0]:K},getQuestionsSelect:function(){var e=JSON.parse(u()(this.questions.response_points));return"edit"===this.mode&&e.forEach((function(e,t){e.checkbox.val=t})),e},getAnswer:function(){var e=this;if("edit"===this.mode){var t=JSON.parse(u()(this.questions.answer));return t.forEach((function(a,i){t[i]=e.optionsIndex[a]})),t}return[]},initData:function(){this.questions=this.getQuestions(),this.answer=this.getAnswer(),this.form.getFieldDecorator("keys",{initialValue:this.getQuestionsSelect(),preserve:!0}),this.initOptionsEditorRule()},initEdit:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){e.initOptionsEditorRule(t.checkbox.val),e.optionsEditor["".concat(t.checkbox.val)]||(e.optionsEditor["".concat(t.checkbox.val)]=window.CKEDITOR.replace("base-question-type_options[".concat(t.checkbox.val,"]"),{toolbar:"Minimal",fileSingleSizeLimit:e.showCKEditorData.fileSingleSizeLimit,filebrowserImageUploadUrl:e.showCKEditorData.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:e.showCKEditorData.filebrowserImageDownloadUrl,language:e.showCKEditorData.language,height:120}),e.optionsEditor["".concat(t.checkbox.val)].on("change",(function(){var a=e.optionsEditor["".concat(t.checkbox.val)].getData();e.form.setFieldsValue(h()({},"options[".concat(t.checkbox.val,"]"),a)),e.checkOptionText(t.checkbox.val,a)})),e.optionsEditor["".concat(t.checkbox.val)].on("blur",(function(){var a=e.optionsEditor["".concat(t.checkbox.val)].getData();e.form.setFieldsValue(h()({},"options[".concat(t.checkbox.val,"]"),a)),e.checkOptionText(t.checkbox.val,a)})))}))},initOptionsEditorRule:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){e.optionsEditorRule["".concat(t.checkbox.val)]||(e.optionsEditorRule["".concat(t.checkbox.val)]={validateStatus:"",errorMsg:""})}))},checkOptionText:function(e,t){var a={validateStatus:"",errorMsg:""};t||(a.validateStatus="error",a.errorMsg=this.t("itemManage.chooseRule.one")),this.$set(this.optionsEditorRule,e,a)},checkAllOptionText:function(){var e=this;this.form.getFieldValue("keys").forEach((function(t){var a=e.form.getFieldValue("options[".concat(t.checkbox.val,"]"));e.checkOptionText(t.checkbox.val,a)}))},checkAnswer:function(){var e="choice"===this.type?2:1;if(this.answer.length<e){var t=this.t("itemManage.littleChoose"),a=this.t("itemManage.answers");return this.$message.error("".concat(t).concat(e).concat(a)),!1}return!0},add:function(){var e=this,t=this.form.getFieldValue("keys");if(t.length>=this.optionsConfiguration.maxItem)this.$message.error(this.t("itemManage.chooseRule.three"));else{var a=t[t.length-1].checkbox.val+1,i=t.concat({checkbox:{val:a,text:""}});this.form.setFieldsValue({keys:i}),this.initOptionsEditorRule(),this.$nextTick((function(){e.initEdit()}))}},remove:function(e,t){var a=this.form.getFieldValue("keys");a.length<=this.optionsConfiguration.minItem?this.$message.error(this.t("itemManage.chooseRule.four")):(this.form.setFieldsValue({keys:a.filter((function(e){return e.checkbox.val!==t.checkbox.val}))}),this.answer=this.answer.filter((function(e){return e!==t.checkbox.val})),this.optionsEditor[t.checkbox.val]=null)},getFromInfo:function(){var e=this;this.checkAllOptionText(),this.form.validateFieldsAndScroll((function(t,a){t||e.checkAnswer()&&e.formateData(a)}))},formateOptions:function(e){var t=this,a=[];return(e=e.filter((function(e){return e}))).forEach((function(e,i){a.push({checkbox:{val:t.optionKey[i],text:e}})})),a},formatetAnswer:function(e){var t=this,a=[];return e.forEach((function(e,i){t.answer.indexOf(e.checkbox.val)>-1&&a.push(t.optionKey[i])})),a},formateData:function(e){var t=JSON.parse(u()(this.questions)),a=e.questions,i=a.otherScore1,n=a.otherScore2,o="question"===a.scoreType?i:n;if(t.otherScore=o||0,t.errors&&delete t.errors,this.isSubItem){var r={};(t=s()(t,e.questions)).response_points=this.formateOptions(e.options),t.answer=this.formatetAnswer(e.keys),t.answer_mode=this.type,r.questions=[t],this.$emit("patchData",r)}else{var l=JSON.parse(u()(this.subject));l=s()(l,e.base),(t=s()(t,e.questions)).response_points=this.formateOptions(e.options),t.answer=this.formatetAnswer(e.keys),t.answer_mode=this.type,l.questions=[t],this.$emit("patchData",l),console.log(l)}},getChoiceLabelNum:function(e){var t=this.t("itemManage.chooseItem");return"".concat(t).concat(e)},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e){var t=this;this.form.validateFieldsAndScroll((function(a,i){if(!a){var n={},o=JSON.parse(u()(t.questions));o=s()(o,i.questions),n.stem=o.stem,n.options=[],i.options.forEach((function(e,a){n.options.push("".concat(t.optionKey[a],".").concat(e))})),n.answer=t.formatetAnswer(i.keys).join(),t.isSubItem?(n.type="material-choice",t.$emit("prepareTeacherAiAnalysis",n,e)):(n.type="choice",e(n))}}))}}},B=V,L=Object(v.a)(B,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form}},[a("answer-model",e._b({attrs:{questions:e.questions,form:e.form,mode:e.mode,isSubItem:e.isSubItem,answer:e.answer,itemType:e.type,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis},scopedSlots:e._u([{key:"response_points",fn:function(){return[a("div",{staticClass:"ibs-choice-wrap"},[a("a-checkbox-group",{model:{value:e.answer,callback:function(t){e.answer=t},expression:"answer"}},e._l(e.form.getFieldValue("keys"),(function(t,i){return a("a-form-item",{key:t.checkbox.val,staticClass:"choice-item",attrs:{label:e.getChoiceLabelNum(e.optionKey[i]),required:"","label-col":{span:4},"wrapper-col":{span:16},"validate-status":e.optionsEditorRule[t.checkbox.val].validateStatus||"",help:e.optionsEditorRule[t.checkbox.val].errorMsg||""}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["options["+t.checkbox.val+"]",{initialValue:t.checkbox.text,rules:[{required:!0}]}],expression:"[\n                `options[${k.checkbox.val}]`,\n                {\n                  initialValue: k.checkbox.text,\n                  rules: [{ required: true }]\n                }\n              ]"}],attrs:{"data-image-download-url":e.showCKEditorData.filebrowserImageDownloadUrl,placeholder:"",rows:0}}),e._v(" "),a("a-checkbox",{attrs:{value:t.checkbox.val}},[e._v(e._s(e.t("RightAnswer")))]),e._v(" "),a("a-button",{staticClass:"ibs-delete-btn",attrs:{size:"small"},on:{click:function(){return e.remove(i,t)}}},[a("i",{staticClass:"ib-icon ib-icon-delete"})])],1)})),1),e._v(" "),a("a-row",[a("a-col",{staticClass:"ibs-text-right",attrs:{offset:4,span:16}},[a("a-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v(e._s(e.t("itemManage.newChoice")))])],1)],1)],1)]},proxy:!0}])},"answer-model",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,U=a(157),N=a(158),P=a(159),H=a(156),J=a(160),z={stem:"",seq:5,score:"2.0",answer:[],analysis:"",answer_mode:""},G={name:"preview-model",components:{judgeType:U.a,singleChoice:N.a,choice:P.a,essay:H.a,fill:J.a},mixins:[g.a],data:function(){return{subItem:"",groupStyle:{pointerEvents:"none"},showQuestion:{},mode:"preview"}},provide:function(){return{modeOrigin:"preview"}},props:{questions:{type:Object,default:function(){return z}},index:{type:Number,default:function(){return 0}}},watch:{questions:{handler:function(e){this.showQuestion=s()({},e),"text"===this.showQuestion.answer_mode&&this.fillTypeData()}}},mounted:function(){this.showQuestion=s()({},this.questions),"text"===this.showQuestion.answer_mode&&this.fillTypeData()},methods:{filterFillHtml:function(e){if(e.match(/\[\[.+?\]\]/g)){var t=1;return e.replace(/\[\[.+?\]\]/g,(function(){return'<span class="ibs-stem-fill-blank">('.concat(t++,")</span>")}))}},filterFillAnswer:function(e){var t=this;return e.map((function(e){return console.log(e),e.replace(/\|/g,t.t("Or"))}))},fillTypeData:function(){this.showQuestion.stem=this.filterFillHtml(this.showQuestion.stem),this.showQuestion.answer=this.filterFillAnswer(this.showQuestion.answer)},showEditModal:function(e){var t=e.target.getAttribute("data-seq");this.$emit("getSeq",{seq:t-1,operate:"edit"})},deleteSub:function(e){var t=e.target.getAttribute("data-seq");this.$emit("getSeq",{seq:t-1,operate:"delete"})}}},W=Object(v.a)(G,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ibs-preview-section"},[a("div",{staticClass:"ibs-sub-item ibs-pr16"},["true_false"===e.showQuestion.answer_mode?a("judge-type",{attrs:{question:e.showQuestion,mode:e.mode}}):e._e(),e._v(" "),"single_choice"===e.showQuestion.answer_mode?a("single-choice",{attrs:{question:e.showQuestion,mode:e.mode}}):e._e(),e._v(" "),"choice"===e.showQuestion.answer_mode||"uncertain_choice"===e.showQuestion.answer_mode?a("choice",{attrs:{question:e.showQuestion,mode:e.mode}}):e._e(),e._v(" "),"rich_text"===e.showQuestion.answer_mode?a("essay",{attrs:{question:e.showQuestion,mode:e.mode}}):e._e(),e._v(" "),"text"===e.showQuestion.answer_mode?a("fill",{attrs:{question:e.showQuestion,mode:e.mode}}):e._e(),e._v(" "),a("a-row",[a("a-col",{attrs:{span:12,offset:2}},[a("div",{staticClass:"ibs-sub-operation"},[a("a-button",{staticClass:"ibs-mr8 ibs-pl0",attrs:{type:"link","data-seq":e.showQuestion.seq},on:{click:e.showEditModal}},[a("i",{staticClass:"ib-icon ib-icon-setting"}),e._v(e._s(e.t("Edit")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"link","data-seq":e.showQuestion.seq},on:{click:e.deleteSub}},[a("i",{staticClass:"ib-icon ib-icon-delete"}),e._v(e._s(e.t("Delete"))+"\n          ")])],1)])],1)],1),e._v(" "),a("hr",{staticClass:"ibs-sub-divider"})])}),[],!1,null,null,null).exports,X={name:"material",mixins:[g.a],data:function(){return{form:this.$form.createForm(this,{name:"base-question-type"}),visible:!1,subItem:{},subType:"",subQuestions:{},newQuestions:[],currentSeq:0,subMode:"create",typeArray:{true_false:"judge",uncertain_choice:"uncertain_choice",choice:"choice",single_choice:"single_choice",text:"fill",rich_text:"essay"}}},components:{baseType:_,essayType:j,judgeType:I,fillType:Q,singleType:T,choiceType:L,previewModel:W},inject:["bank_id","subject","showCKEditorData"],props:{mode:{type:String,default:"create"},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},computed:{questions:function(){return"edit"===this.mode?this.subject.questions:this.newQuestions}},mounted:function(){this.$on("closeModal",this.cancel),"edit"===this.mode&&(this.newQuestions=this.questions,this.newQuestions.map((function(e,t){e.seq=t+1})))},methods:{getContainer:function(){return document.getElementById("item-bank-sdk-material-created")},getFromInfo:function(){var e=this;this.form.validateFieldsAndScroll((function(t,a){t||e.formateData(a)}))},formateData:function(e){e.base.attachments=this.subject.attachments,e.base.questions=this.questions;var t=e.base;return e.base.questions.length>0?this.$emit("patchData",t):this.$message.error(this.t("itemManage.addSubItemRule")),t},cancel:function(){this.visible=!1},showModal:function(e){var t=e.target;this.subType=t.getAttribute("data-type"),this.visible=!0,this.subMode="create"},handleOk:function(e){console.log(e),this.visible=!1},patchData:function(e){this.$emit("getData",e),this.subItem=e.questions[0],"edit"===this.subMode?this.$set(this.newQuestions,this.currentSeq,e.questions[0]):(this.newQuestions.push(e.questions[0]),this.newQuestions.map((function(e,t){e.seq=t+1}))),this.visible=!1},initStatus:function(e){this.subQuestions=e},showEditModal:function(e){this.visible=!0,this.subType=this.typeArray[this.newQuestions[e].answer_mode],this.subQuestions=this.newQuestions[e],this.subMode="edit"},getSeq:function(e){this.currentSeq=e.seq,"delete"===e.operate?(this.newQuestions.splice(this.currentSeq,1),this.newQuestions.map((function(e,t){e.seq=t+1}))):this.showEditModal(this.currentSeq)},getMaterialAttachment:function(e){this.subject.attachments.push(e)},onFileSort:function(e){var t=this.subject.attachments;t=(t=t.filter((function(t){return t.module!==e[0].module}))).concat(e),this.$set(this.subject,"attachments",t)},deleteMaterialAttachment:function(e){this.subject.attachments=this.subject.attachments.filter((function(t){return t.id!==e}))},previewMaterialAttachment:function(e){this.$emit("previewMaterialAttachment",e)},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")},prepareTeacherAiAnalysis:function(e,t){this.form.validateFieldsAndScroll((function(a,i){a||(e.material=i.base.material,t(e))}))}}},Y=Object(v.a)(X,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form",{attrs:{form:e.form,id:"item-bank-sdk-material-created"}},[a("base-type",e._b({attrs:{form:e.form,mode:e.mode,isDisable:e.isDisable,errorList:e.errorList},on:{getFromInfo:e.getFromInfo,getMaterialAttachment:e.getMaterialAttachment,onFileSort:e.onFileSort,deleteMaterialAttachment:e.deleteMaterialAttachment,previewMaterialAttachment:e.previewMaterialAttachment,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion},scopedSlots:e._u([{key:"subQuestions",fn:function(){return[a("div",{staticClass:"ibs-mt24"},[a("a-form-item",{attrs:{"wrapper-col":{span:16,offset:4}}},e._l(e.newQuestions,(function(t,i){return a("preview-model",{key:i,attrs:{value:t,questions:t},on:{getSeq:e.getSeq}})})),1),e._v(" "),a("a-form-item",{attrs:{label:e.t("itemManage.addSubItem"),"label-col":{span:4},"wrapper-col":{span:16}}},[a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"single_choice"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("single_choice")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"choice"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("choice")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"uncertain_choice"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("uncertain_choice")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"judge"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("determine")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"fill"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("fill")))]),e._v(" "),a("a-button",{staticClass:"ibs-mr8",attrs:{type:"primary","data-type":"essay"},on:{click:e.showModal}},[a("i",{staticClass:"ib-icon ib-icon-add"}),e._v(e._s(e.t("essay")))]),e._v(" "),a("a-modal",{attrs:{title:e.t("itemManage.addItem"),width:"800px",cancelText:e.t("cancel"),destroyOnClose:!0,footer:null,getContainer:e.getContainer},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},["essay"===e.subType?a("essay-type",{attrs:{showCategory:!1,showDifficulty:!1,subQuestions:e.subQuestions,isSubItem:!0,mode:e.subMode,aiAnalysisEnable:e.aiAnalysisEnable},on:{patchData:e.patchData,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis}}):e._e(),e._v(" "),"fill"===e.subType?a("fill-type",{attrs:{showCategory:!1,showDifficulty:!1,isSubItem:!0,subQuestions:e.subQuestions,mode:e.subMode,aiAnalysisEnable:e.aiAnalysisEnable},on:{patchData:e.patchData,initStatus:e.initStatus,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis}}):e._e(),e._v(" "),"judge"===e.subType?a("judge-type",{attrs:{showCategory:!1,showDifficulty:!1,isSubItem:!0,subQuestions:e.subQuestions,mode:e.subMode,aiAnalysisEnable:e.aiAnalysisEnable},on:{patchData:e.patchData,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis}}):e._e(),e._v(" "),"single_choice"===e.subType?a("single-type",{attrs:{showCategory:!1,showDifficulty:!1,isSubItem:!0,subQuestions:e.subQuestions,mode:e.subMode,aiAnalysisEnable:e.aiAnalysisEnable},on:{patchData:e.patchData,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis}}):e._e(),e._v(" "),"choice"===e.subType||"uncertain_choice"===e.subType?a("choice-type",{attrs:{type:e.subType,showCategory:!1,showDifficulty:!1,isSubItem:!0,subQuestions:e.subQuestions,mode:e.subMode,aiAnalysisEnable:e.aiAnalysisEnable},on:{patchData:e.patchData,prepareTeacherAiAnalysis:e.prepareTeacherAiAnalysis}}):e._e()],1)],1)],1)]},proxy:!0}])},"base-type",e.$attrs,!1))],1)}),[],!1,null,null,null).exports,Z={id:1,bank_id:1,category_id:0,difficulty:"normal",material:"",analysis:"",attachments:[],type:"",questions:[]},ee={publicPath:"".concat(Object({NODE_ENV:"production"}).BASE_URL,"/es-ckeditor/ckeditor.js"),fileSingleSizeLimit:10,filebrowserImageUploadUrl:"",filebrowserImageDownloadUrl:"",language:"zh-cn",jqueryPath:"https://cdn.bootcss.com/jquery/3.4.1/jquery.js"},te={name:"item-manage",components:{judgeType:I,singleChoice:T,materialType:Y,choice:L,essayType:j,fillType:Q},inheritAttrs:!1,props:{bank_id:{type:String,default:""},mode:{type:String,default:"create"},category:{type:Array,default:function(){return[]}},subject:{type:Object,default:function(){return Z}},type:{type:String,default:"choice"},showCKEditorData:{type:Object,default:function(){return{}}},showModelBtn:{type:Boolean,default:!1},showAttachment:{type:String,default:"0"},cdnHost:{type:String,default:"service-cdn.qiqiuyun.net"},uploadSDKInitData:{type:Object,default:function(){return{}}},deleteAttachmentCallback:{type:Function,default:function(){return new l.a((function(e){e()}))}},previewAttachmentCallback:{type:Function,default:function(){return new l.a((function(e){e()}))}},downloadAttachmentCallback:{type:Function,default:function(){return new l.a((function(e){e()}))}},isDownload:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1},aiAnalysisEnable:{type:Boolean,default:!1},errorList:{type:Array,default:function(){return[]}}},data:function(){return{isAgain:!1}},computed:{CKEditorData:function(){return console.log(this.showCKEditorData),o()(this.showCKEditorData).length?s()(ee,this.showCKEditorData):ee}},provide:function(){return{bank_id:this.bank_id,category:this.category,subject:this.subject,showCKEditorData:this.CKEditorData,showAttachment:Number(this.showAttachment),cdnHost:this.cdnHost,uploadSDKInitData:this.uploadSDKInitData,deleteAttachmentCallback:this.deleteAttachmentCallback,previewAttachmentCallback:this.previewAttachmentCallback,downloadAttachmentCallback:this.downloadAttachmentCallback,isDownload:this.isDownload,modeOrigin:"create"}},created:function(){this.$on("toGoBack",this.toGoBack),this.$on("changeAgain",this.changeAgain),this.$on("getDeleteFile",this.deleteAttachmentData),this.$on("previewFile",this.previewAttachment),this.$on("downloadFile",this.downloadAttachment)},methods:{changeAgain:function(e){this.isAgain=e},patchData:function(e){var t={data:e,isAgain:this.isAgain};this.$emit("getData",t)},deleteAttachmentData:function(e){var t=e.fileId;this.$emit("deleteAttachment",t)},deleteAttachment:function(e,t){this.$emit("deleteAttachment",e,t)},downloadAttachment:function(e){this.$emit("downloadAttachment",e)},toGoBack:function(){this.$emit("goBack")},previewAttachment:function(e){this.$emit("previewAttachment",e)},changeEditor:function(e){this.$emit("changeEditor",e)},getInitRepeatQuestion:function(){this.$emit("getInitRepeatQuestion")},renderFormula:function(){this.$emit("renderFormula")}}},ae=Object(v.a)(te,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item-bank-sdk-message ibs-background-color item-bank-create-form",attrs:{id:"item-bank-create"}},["determine"===e.type?a("judge-type",{attrs:{mode:e.mode,showModelBtn:e.showModelBtn,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e(),e._v(" "),"single_choice"===e.type?a("single-choice",{attrs:{mode:e.mode,showModelBtn:e.showModelBtn,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e(),e._v(" "),"fill"===e.type?a("fill-type",{attrs:{mode:e.mode,showModelBtn:e.showModelBtn,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e(),e._v(" "),"essay"===e.type?a("essay-type",{attrs:{mode:e.mode,showModelBtn:e.showModelBtn,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e(),e._v(" "),"material"===e.type?a("material-type",{attrs:{showMaterial:!0,showAnalysis:!0,mode:e.mode,showModelBtn:e.showModelBtn,errorList:e.errorList,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable},on:{previewMaterialAttachment:e.previewAttachment,patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e(),e._v(" "),"choice"===e.type||"uncertain_choice"===e.type?a("choice",{attrs:{type:e.type,mode:e.mode,showModelBtn:e.showModelBtn,isDisable:e.isDisable,aiAnalysisEnable:e.aiAnalysisEnable,errorList:e.errorList},on:{patchData:e.patchData,changeEditor:e.changeEditor,renderFormula:e.renderFormula,getInitRepeatQuestion:e.getInitRepeatQuestion}}):e._e()],1)}),[],!1,null,null,null);t.a=ae.exports},269:function(e,t,a){var i=a(122),s=a(215),n=a(170),o=a(231).f;e.exports=function(e){return function(t){for(var a,r=n(t),l=s(r),c=l.length,u=0,d=[];c>u;)a=l[u++],i&&!o.call(r,a)||d.push(e?[a,r[a]]:r[a]);return d}}},270:function(e,t,a){a(271),e.exports=a(56).Object.values},271:function(e,t,a){var i=a(69),s=a(269)(!1);i(i.S,"Object",{values:function(e){return s(e)}})}});