webpackJsonp(["app/js/task/live/index"],[function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_activityEmitter=__webpack_require__("da32dea28c2b82c7aab1"),_activityEmitter2=_interopRequireDefault(_activityEmitter),LiveShow=function(){function LiveShow(){_classCallCheck(this,LiveShow),this.init()}return _createClass(LiveShow,[{key:"init",value:function(){function generateHtml(){nowDate+=intervalSecond;var startLeftSeconds=parseInt(startTime-nowDate),endLeftSeconds=parseInt(endTime-nowDate),days=Math.floor(startLeftSeconds/86400),modulo=startLeftSeconds%86400,hours=Math.floor(modulo/3600);modulo%=3600;var minutes=Math.floor(modulo/60),seconds=modulo%60,$replayGuid=Translator.trans("老师们：");$replayGuid+="<br>",1==activityData.ext.liveProvider?($replayGuid+="&nbsp;&nbsp;&nbsp;&nbsp;"+Translator.trans("录制直播课程时，需在直播课程间点击"),$replayGuid+="<span style='color:red'>"+Translator.trans("录制面板")+"</span>",$replayGuid+=Translator.trans("，录制完成后点击"),$replayGuid+="<span style='color:red'>"+Translator.trans("暂停")+"</span>",$replayGuid+=Translator.trans("结束录播，录播结束后在"),$replayGuid+="<span style='color:red'>"+Translator.trans("录播管理")+"</span>",$replayGuid+=Translator.trans("界面生成回放。"),$replayGuid+="<br>"):($replayGuid+="&nbsp;&nbsp;&nbsp;&nbsp;",$replayGuid+=Translator.trans("直播平台")+"<span style='color:red'>"+Translator.trans("下课后")+"</span>"+Translator.trans("且")+"<span style='color:red'>"+Translator.trans("直播时间")+"</span>"+Translator.trans("结束后，在课时管理的"),$replayGuid+="<span style='color:red'>"+Translator.trans("录播管理")+"</span>",$replayGuid+=Translator.trans("点击生成回放。"),$replayGuid+="<br>");var $countDown=that._getCountDown(days,hours,minutes,seconds);0<startLeftSeconds&&startLeftSeconds<7200&&($liveNotice="<p>"+Translator.trans("直播将于%liveStartTime%开始，于%liveEndTime%结束，请在课前10分钟内提早进入。",{liveStartTime:"<strong>"+liveStartTimeFormat+"</strong>",liveEndTime:"<strong>"+liveEndTimeFormat+"</strong>"})+"</p>",activityData.isTeacher?($countDown=$replayGuid+$countDown,$countDown="<p>"+$countDown+"&nbsp;<a class='btn btn-primary js-start-live' href='javascript:;' onclick='liveShow.entryLiveRoom()'>"+Translator.trans("进入直播教室")+"</a><br><br></p>"):$countDown="<p>"+$countDown+"&nbsp;<a class='btn btn-primary js-start-live' href='javascript:;' onclick='liveShow.entryLiveRoom()'>"+Translator.trans("进入直播教室")+"</a><br><br></p>"),startLeftSeconds<=0&&(clearInterval(iID),$liveNotice="<p>"+Translator.trans("直播已经开始，直播将于%liveEndTime%结束。",{liveEndTime:"<strong>"+liveEndTimeFormat+"</strong>"})+"</p>",activityData.isTeacher?($countDown=$replayGuid,$countDown+="<p><a class='btn btn-primary js-start-live' href='javascript:;' onclick='liveShow.entryLiveRoom()'>"+Translator.trans("进入直播教室")+"</a><br><br></p>"):$countDown="<p><a class='btn btn-primary js-start-live' href='javascript:;' onclick='liveShow.entryLiveRoom()'>"+Translator.trans("进入直播教室")+"</a><br><br></p>"),endLeftSeconds<=0&&($liveNotice="<p style='margin: 10px 0 0 10px; font-weight: bold; font-size: 1.5em;'>"+Translator.trans("直播已经结束")+"</p>",$countDown="","videoGenerated"==replayStatus?($countDown+="<button class='btn btn-primary live-video-play-btn' data-lesson-id='"+activityData.id+"'>查看回放</button>&nbsp;&nbsp;",$("body").on("click",".live-video-play-btn",function(){return 0==activityData.ext.liveId||$.inArray("liveMediaError",activityData)!=-1&&""!=activityData.liveMediaError?void Notify.danger("抱歉，视频文件不存在，暂时无法学习。"):($("#lesson-live-content").hide(),$("#lesson-video-content").html(""),void self._videoPlay(activityData))})):activityData.replays&&activityData.replays.length>0&&$.each(activityData.replays,function(i,n){$countDown+="<a class='btn btn-primary' href='"+n.url+"' target='_blank'>"+n.title+"</a>&nbsp;&nbsp;"}));var $content=$liveNotice+'<div style="padding:15px 15px 15px 30px; border-bottom:1px dashed #ccc; height: auto;">'+summary+"</div><br>"+$countDown;$("#lesson-live-content").find(".lesson-content-text-body").html($content),intervalSecond++}var that=this,activityData=JSON.parse($("#activity-data").text());console.log("activityData : ",activityData);var liveStartTimeFormat=activityData.startTimeFormat,liveEndTimeFormat=activityData.endTimeFormat,startTime=parseInt(activityData.startTime),endTime=parseInt(activityData.endTime),nowDate=parseInt(activityData.nowDate),summary=$("#activity-summary").text(),courseId=activityData.fromCourseId,activityId=activityData.id,replayStatus=null,$liveNotice="<p>"+Translator.trans("直播将于%liveStartTime%开始，于%liveEndTime%结束，请在课前10分钟内提早进入。",{liveStartTime:"<strong>"+liveStartTimeFormat+"</strong>",liveEndTime:"<strong>"+liveEndTimeFormat+"</strong>"})+"</p>",iID=void 0;iID&&clearInterval(iID);var intervalSecond=0;this.entry_url=location.protocol+"//"+location.hostname+"/course/"+courseId+"/activity/"+activityId+"/live_entry",generateHtml(),endTime>nowDate&&(iID=setInterval(generateHtml,1e3)),$("#lesson-live-content").show(),$("#lesson-live-content").scrollTop(0),that.started=!1}},{key:"entryLiveRoom",value:function(){var that=this;if(console.log("startLive",that.started,that.entry_url),!that.started){that.started=!0;var emitter=new _activityEmitter2["default"];emitter.emit("start",{}).then(function(){console.log("live.start")})["catch"](function(error){console.error(error)})}window.open(that.entry_url,"_blank")}},{key:"_getCountDown",value:function(days,hours,minutes,seconds){var content=Translator.trans("还剩: ");return content+=days?"<strong class='text-info'>"+days+"</strong>"+Translator.trans("天"):"",content+=hours?"<strong class='text-info'>"+hours+"</strong>"+Translator.trans("小时"):"",content+=minutes?"<strong class='text-info'>"+minutes+"</strong>"+Translator.trans("分钟"):"",content+=seconds?"<strong class='text-info'>"+seconds+"</strong>"+Translator.trans("秒"):""}}]),LiveShow}();window.liveShow=new LiveShow}]);