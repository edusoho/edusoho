webpackJsonp(["app/js/subject/index"],{0:function(t,e){t.exports=jQuery},"0a8e81c6561706139e91":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("3b1883fc74dc0f9509af"),h=a(f),m=i("fc2f2ee10e7680a03c60"),p=a(m);jQuery.validator.addMethod("fillCheck",function(t,e){return this.optional(e)||/(\[\[(.+?)\]\])/i.test(t)},Translator.trans("course.question.create.fill_hint"));var v=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.titleEditorToolBarName="Question",a.initTitleEditor(a.validator),a.$titleField=$("#"+a.titleFieldId),a.init(),a}return(0,h.default)(e,t),(0,c.default)(e,[{key:"init",value:function(){this.$titleField.rules("add",{fillCheck:!0})}},{key:"filterQuestion",value:function(t){var e=t.stem.match(/\[\[(.+?)\]\]/g);if(null!=e){t.answers=[];for(var i=0;i<e.length;i++){var a=e[i].substring(2);a=a.substring(0,a.length-2),t.answers.push(a)}}return t}}]),e}(p.default);e.default=v},"231ebcb6da3a547bd76a":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("3b1883fc74dc0f9509af"),h=a(f),m=i("fc2f2ee10e7680a03c60"),p=a(m),v=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.initTitleEditor(a.validator),a.answerFieldId="question-answer-field",a.$answerField=$("#"+a.answerFieldId),a.init(),a}return(0,h.default)(e,t),(0,c.default)(e,[{key:"init",value:function(){var t=this;this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("subject.essay_require_answer")}}),this.$form.on("click",'[data-role="edit"]',function(e){return t.answerClick(e)})}},{key:"answerClick",value:function(t){var e=this,i=$(t.currentTarget),a=i.next();i.hide();var s=CKEDITOR.replace(a.attr("id"),{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:a.data("imageUploadUrl"),height:a.height()});s.on("change",function(){a.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("blur",function(){a.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())}),s.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){i.val($(e.replacePicture(s.getData())).text()),a.val(s.getData()),s.destroy(),a.hide(),i.show()})})}}]),e}(p.default);e.default=v},"2ae529d75fd1f719d626":function(t,e,i){t.exports={default:i("e7ceb28b20870340ea1d"),__esModule:!0}},"4027a3d2d21cae0e3aa7":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("7ab4a89ebadbfdecc2bf"),n=a(s),r=i("4602c3f5fe7ad9e3e91d"),o=a(r),u=i("fc2f2ee10e7680a03c60"),c=a(u),l=i("e7c4ffc794f204cf93fb"),d=a(l),f=i("e28aaed3fc88f258b3a2"),h=a(f),m=i("78a5a10fddebc60b34ae"),p=a(m),v=i("4f6d5e23ff387584749d"),b=a(v),g=i("0a8e81c6561706139e91"),y=a(g),$=i("231ebcb6da3a547bd76a"),_=a($),j=i("d3a6179560ad66e862d2"),k=a(j),T=void 0,q=function(){function t(){(0,n.default)(this,t)}return(0,o.default)(t,null,[{key:"getEditor",value:function(t,e,i){switch(t){case"single_choice":T=new h.default(e,i);break;case"uncertain_choice":T=new p.default(e,i);break;case"choice":T=new d.default(e,i);break;case"determine":T=new b.default(e,i);break;case"essay":T=new _.default(e,i);break;case"fill":T=new y.default(e,i);break;case"material":T=new k.default(e,i);break;default:T=new c.default(e,i),T.initTitleEditor()}}}]),t}();e.default=q},"4f6d5e23ff387584749d":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("3b1883fc74dc0f9509af"),h=a(f),m=i("fc2f2ee10e7680a03c60"),p=a(m),v=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.initTitleEditor(a.validator),a.$answerField=$('[name="answer"]'),a.init(),a}return(0,h.default)(e,t),(0,c.default)(e,[{key:"init",value:function(){this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("course.question.create.right_answer_required_error_hint")}})}},{key:"filterQuestion",value:function(t){var e=$("input[name='answer']:checked").val();return t.answer="true"==e,t}}]),e}(p.default);e.default=v},"64484d5ef8f33c7c530c":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cc2d3198fedcb28c0d05"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=function(){function t(){(0,o.default)(this,t),this.questions={},this.eventManager={},this.tokenList=[],this.$statList=$(".js-subject-data"),this.$itemList=$(".js-item-list"),this.questionCounts={},this.totalScore=0,this.flag=!0,this.init()}return(0,c.default)(t,[{key:"init",value:function(){this.initQuestions(),this.initQuestionCountsAndTotalScore(),this.flag=!1}},{key:"initQuestions",value:function(){for(var t=this,e=this._toJson($(".js-cached-data").text()),i=0;i<e.length;i++)!function(){var a=t._getToken(),s=e[i];t.questions[a]=s,t.tokenList.push(a);var n=i;$('[data-anchor="#'+n+'"]').attr("data-anchor","#"+a);var r=$("#"+n).attr("id",a);"material"==s.type&&$.each(s.subQuestions,function(t,e){r=r.next('[data-key="'+t+'"]').attr("data-material-token",a)})}()}},{key:"initQuestionCountsAndTotalScore",value:function(){this.questionCounts={total:0,single_choice:0,choice:0,uncertain_choice:0,determine:0,fill:0,essay:0,material:0};var t=this;(0,n.default)(this.questions).forEach(function(e){var i=t.questions[e];t.questionCounts.total++,t.questionCounts[i.type]++,"material"!=i.type?t.totalScore=(parseFloat(t.totalScore)+parseFloat(i.score)).toFixed(1):$.each(i.subQuestions,function(e,i){t.totalScore=(parseFloat(t.totalScore)+parseFloat(i.score)).toFixed(1)})})}},{key:"getQuestionCount",value:function(t){return this.questionCounts[t]}},{key:"getTotalScore",value:function(){return this.totalScore}},{key:"getQuestionOrder",value:function(t){return this.tokenList.indexOf(t)+1}},{key:"getTokenList",value:function(){return this.tokenList}},{key:"modifyDifficulty",value:function(t,e,i){var a=this;$.each(t,function(t,s){void 0!==a.questions[s]&&(a.updateQuestionItem(s,"difficulty",e),a.$itemList.find("#"+s).find(".js-difficulty").html(i))})}},{key:"modifyScore",value:function(t,e,i){var a=this;$.each(t,function(t,s){a.$itemList.find("#"+s).find(".js-score").html(""+e.score+Translator.trans("subject.question_score_unit"));var n=a.getQuestion(s);a.updateQuestionItem(s,"score",e.score,!1),i&&("choice"!=n.type&&"uncertain_choice"!=n.type||a.updateQuestionItem(s,"missScore",e.missScore))}),a.trigger("updateQuestionScore")}},{key:"addQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0,"material"==e.type&&(e.subQuestions=[],e.score=0);var i=this._getToken();this.questions[i]=e;var a=this.tokenList.indexOf(t)+1;this.tokenList.splice(a,0,i),this.questionCounts.total++,this.questionCounts[e.type]++,this.totalScore=(parseFloat(this.totalScore)+parseFloat(e.score)).toFixed(1);var s=a+1;return this.trigger("addQuestion",[s,i,e.type]),this.flag=!1,i}}},{key:"deleteQuestion",value:function(t){if(this.isUpdating()){var e=this;this.flag=!0;var i=this.questions[t];delete this.questions[t];var a=this.tokenList.indexOf(t);this.tokenList.splice(a,1),this.questionCounts.total--,this.questionCounts[i.type]--,"material"!=i.type?this.totalScore=(parseFloat(this.totalScore)-parseFloat(i.score)).toFixed(1):$.each(i.subQuestions,function(t,i){e.totalScore=(parseFloat(e.totalScore)-parseFloat(i.score)).toFixed(1)}),this.trigger("deleteQuestion",[i.type]),this.flag=!1}}},{key:"updateQuestionItem",value:function(t,e,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.isUpdating()){this.flag=!0;var s=this.questions[t][e];this.questions[t][e]=i,"score"==e&&(this.totalScore=(this.totalScore-parseFloat(s)+parseFloat(i)).toFixed(1),this.trigger("updateQuestionScore",[a])),"type"==e&&s!=i&&(this.questionCounts[s]--,this.questionCounts[i]++,this.trigger("updateQuestionType",[e,i,s,t])),this.flag=!1}}},{key:"getQuestion",value:function(t){if(this.isUpdating())return this.questions[t]}},{key:"getQuestions",value:function(){return this.questions}},{key:"getSubQuestion",value:function(t,e){if(this.isUpdating())return this.questions[t].subQuestions[e]}},{key:"addSubQuestion",value:function(t,e){if(this.isUpdating())return this.flag=!0,this.questions[t].subQuestions.push(e),this.totalScore=(parseFloat(this.totalScore)+parseFloat(e.score)).toFixed(1),this.trigger("updateQuestionScore"),this.flag=!1,t}},{key:"updateSubQuestionItem",value:function(t,e,i,a){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this.isUpdating()){this.flag=!0;var n=this.questions[t].subQuestions[e][i];this.questions[t].subQuestions[e][i]=a,"score"==i&&(this.totalScore=(this.totalScore-parseFloat(n)+parseFloat(a)).toFixed(1),this.trigger("updateQuestionScore",[s])),this.flag=!1}}},{key:"deleteSubQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0;var i=this.questions[t].subQuestions[e];this.questions[t].subQuestions.splice(e,1),this.totalScore=(parseFloat(this.totalScore)-parseFloat(i.score)).toFixed(1),this.correctMaterialQuestion(t),this.trigger("updateQuestionScore"),this.flag=!1}}},{key:"correctQuestion",value:function(t){var e=this.questions[t];void 0!==e.errors&&("material"==e.type&&void 0!==e.errors.hasSubError?e.errors={hasSubError:!0}:delete e.errors,this.questions[t]=e,void 0===e.errors&&this.trigger("correctQuestion",[t]))}},{key:"correctSubQuestion",value:function(t,e){var i=this.questions[t],a=i.subQuestions[e];void 0!==a.errors&&(delete a.errors,i.subQuestions[e]=a,this.questions[t]=i,this.correctMaterialQuestion(t))}},{key:"correctMaterialQuestion",value:function(t){var e=this.questions[t],i=!1;$.each(e.subQuestions,function(t,e){void 0!==e.errors&&(i=!0)}),i||void 0===e.errors||delete e.errors.hasSubError,$.isEmptyObject(e.errors)&&(delete e.errors,this.trigger("correctQuestion",[t])),this.questions[t]=e}},{key:"isUpdating",value:function(){return 1!=this.flag||(cd.message({type:"danger",message:Translator.trans("course.question.is_updating_hint")}),!1)}},{key:"_toJson",value:function(t){var e={};return t&&(e=$.parseJSON(t.replace(/[\r\n\t]/g,""))),e}},{key:"on",value:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]}},{key:"trigger",value:function(t,e){this.eventManager[t]&&this.eventManager[t].map(function(t){t.apply(null,e)})}},{key:"_random",value:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}},{key:"_getToken",value:function(){return this._random()+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+this._random()+this._random()}}]),t}();e.default=l},"71b27e2f2ad91538e032":function(t,e,i){i("77a51ea3e42f24abf46c");var a=i("99ec8b6ce9e8b820539a").Object;t.exports=function(t,e){return a.getOwnPropertyDescriptor(t,e)}},"77a51ea3e42f24abf46c":function(t,e,i){var a=i("9e0642ad0826b9d4cd08"),s=i("7f917e4ff98127054bf8").f;i("7f73bb1f2e15175ec304")("getOwnPropertyDescriptor",function(){return function(t,e){return s(a(t),e)}})},"78a5a10fddebc60b34ae":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("c56870cab48202a6146a"),h=a(f),m=i("3b1883fc74dc0f9509af"),p=a(m),v=i("e7c4ffc794f204cf93fb"),b=a(v),g=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},a}return(0,p.default)(e,t),(0,c.default)(e,[{key:"initValidator",value:function(){(0,h.default)(e.prototype.__proto__||(0,n.default)(e.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}}]),e}(b.default);e.default=g},"8c14aa1debf44e6bb6c7":function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("2ae529d75fd1f719d626"),n=a(s),r=i("6415c664294d747ee392"),o=a(r),u=i("cc2d3198fedcb28c0d05"),c=a(u),l=i("7ab4a89ebadbfdecc2bf"),d=a(l),f=i("4602c3f5fe7ad9e3e91d"),h=a(f),m=i("64484d5ef8f33c7c530c"),p=a(m),v=i("4027a3d2d21cae0e3aa7"),b=a(v),g=i("9181c6995ae8c5c94b7a"),y=function(){function t(){(0,d.default)(this,t),this.$element=$(".js-subject-list"),this.$itemList=$(".js-item-list"),this.$subjectData=$(".js-subject-data"),this.$batchBtn=$(".js-batch-btn"),this.$batchWrap=$(".js-subject-wrap"),this.$sbCheckbox=$(".js-show-checkbox"),this.$finishBtn=$(".js-finish-btn"),this.$allBtn=$(".js-batch-select"),this.$anchor=$(".js-subject-anchor"),this.flag=!0,this.$diffiultyModal=$(".js-difficulty-modal"),this.$scoreModal=$(".js-score-modal"),this.scoreValidator=null,this.selectQuestion=[],this.questionOperate=null,this.testpaperTitle="",this.redirect=!1,this.questionOperate=null,this.timer=!1,this.init()}return(0,h.default)(t,[{key:"init",value:function(){this.initQuestionOperate(),this.confirmFresh(),this.sbListFixed(),this.initEvent(),this.initScoreValidator(),this.setDifficulty(),this.initTestpaperTitle(),this.itemClick(),this.statErrorQuestions(),this.ieImg()}},{key:"initQuestionOperate",value:function(){var t=this;t.questionOperate=new p.default,t.questionOperate.on("correctQuestion",function(e){$('[data-anchor="#'+e+'"]').hasClass("subject-list-item__num--error")&&($('[data-anchor="#'+e+'"]').removeClass("subject-list-item__num--error"),t.statErrorQuestions())}),t.questionOperate.on("addQuestion",function(e,i,a){$('[data-anchor="#'+e+'"]').attr("data-anchor","#"+i),t.updateTotalScoreText(),t.updateQuestionCountText(a)}),t.questionOperate.on("deleteQuestion",function(e){t.updateTotalScoreText(),t.updateQuestionCountText(e)}),t.questionOperate.on("updateQuestionScore",function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.updateTotalScoreText(e)}),t.questionOperate.on("updateQuestionType",function(e,i,a,s){t.updateQuestionCountText(i),t.updateQuestionCountText(a),t.questionTypeConvert(i,s)})}},{key:"confirmFresh",value:function(){var t=this;$(window).on("beforeunload",function(){if(!t.redirect)return Translator.trans("admin.block.not_saved_data_hint")})}},{key:"initEvent",value:function(){var t=this;this.$element.on("click",".js-batch-select",function(e){return t.batchToItem(e)}),this.$element.on("click",".js-show-checkbox",function(e){return t.itemToBatch(e)}),this.$element.on("click",".js-batch-btn",function(e){return t.batchBtnClick(e)}),this.$element.on("click",".js-finish-btn",function(e){return t.finishBtnClick(e)}),this.$element.on("click","*[data-anchor]",function(e){return t.quickToQuestion(e,t.flag)}),this.$element.on("click",".js-difficult-setting",function(e){return t.showModal(e,t.$diffiultyModal)}),this.$element.on("click",".js-score-setting",function(e){return t.showScoreModal(e)}),this.$scoreModal.on("click",".js-batch-score-confirm",function(e){return t.batchSetScore(e)}),this.$itemList.on("click",".js-item-edit",function(e){return t.itemEdit(e)}),this.$itemList.on("click",".js-item-delete",function(e){return t.deleteSubjectItem(e)}),this.$itemList.on("change",".js-testpaper-title",function(e){return t.editTestpaperTitle(e)}),this.$itemList.on("click",".js-import-btn",function(e){return t.finishImport(e)})}},{key:"initTestpaperTitle",value:function(){var t=this;this.isTestpaper()&&(this.testpaperTitle=$(".js-testpaper-title").val()),this.$itemList.on("click",".subject-change-btn",function(e){return t.itemConvert(e)}),this.$itemList.on("click",".js-item-add",function(e){return t.addModalShow(e,!1)}),this.$itemList.on("click",".js-item-add-sub",function(e){return t.addModalShow(e,!0)}),this.$subjectData.bind("change","*[data-type]",function(e,i){return t.updateQuestionCountText(i)}),this.$subjectData.bind("change",".js-total-score",function(e){return t.updateTotalScoreText()})}},{key:"sbListFixed",value:function(){var t=$(".js-subject-data").width();if(this.$element.length){var e=this,i=this.$element.offset().top;$(window).scroll(function(a){e.$element.width(t),$(window).scrollTop()>=i?e.$element.addClass("sb-fixed"):e.$element.removeClass("sb-fixed")})}}},{key:"batchToItem",value:function(t){if(t.currentTarget===t.target){$(t.currentTarget).hasClass("checked")?this.$element.find(".js-show-checkbox").removeClass("checked"):this.$element.find(".js-show-checkbox").addClass("checked")}}},{key:"itemToBatch",value:function(t){t.currentTarget===t.target&&this.countNumber()}},{key:"countNumber",value:function(){var t=this.$element.find(".js-show-checkbox").length,e=this;setTimeout(function(){var i=$(".js-subject-list-body").find(".checked"),a=i.length;t==a?e.$allBtn.addClass("checked"):e.$allBtn.removeClass("checked")},100)}},{key:"batchBtnClick",value:function(t){if(!this.isEditing()){$(t.target).toggleClass("hidden"),this.toggleClass(!0),this.flag=!1}}},{key:"finishBtnClick",value:function(t){this.$element.find(".js-show-checkbox").removeClass("checked"),this.$allBtn.removeClass("checked"),this.$batchBtn.toggleClass("hidden"),this.toggleClass(!1),this.flag=!0}},{key:"toggleClass",value:function(t){t?(this.$element.find(".js-subject-wrap").removeClass("hidden"),this.$element.find(".js-show-checkbox").removeClass("hidden")):(this.$element.find(".js-subject-wrap").addClass("hidden"),this.$element.find(".js-show-checkbox").addClass("hidden"))}},{key:"quickToQuestion",value:function(t,e){var i=$(t.currentTarget);if(e){var a=$(i.attr("data-anchor")).offset();$(document).scrollTop(a.top)}else i.find(".js-show-checkbox").toggleClass("checked"),this.countNumber()}},{key:"showModal",value:function(t,e){if(!this.isEditing()){var i=this.statChosedQuestion();if(0===(0,c.default)(i).length)return void cd.message({type:"danger",message:Translator.trans("subject.select_question_hint")});var a="";$.each(i,function(t,e){var i=e.count+Translator.trans("subject.question_unit")+e.name+Translator.trans("subject.comma");a+=i}),a=a.substring(0,a.length-1)+Translator.trans("subject.period"),e.find(".js-select").html(a),e.modal("show")}}},{key:"showScoreModal",value:function(t){if(!this.isEditing()){var e=this.statChosedQuestion(),i=$(".js-miss-score-field");this.isTestpaper()&&(e.hasOwnProperty("choice")||e.hasOwnProperty("uncertain_choice"))?i.removeClass("hidden"):i.addClass("hidden"),null!=this.scoreValidator&&this.scoreValidator.resetForm(),this.$scoreModal.find("input").each(function(){$(this).val("")}),this.showModal(t,this.$scoreModal)}}},{key:"statChosedQuestion",value:function(){var t={},e=this;return e.$element.find(".js-show-checkbox.checked").each(function(){var i=$(this).data("type"),a=$(this).parent().next(".js-type-name").text(),s=$(this).parents(".js-subject-anchor").data("anchor");void 0===t[i]?t[i]={name:a,count:1}:t[i].count++,e.selectQuestion.push(s.substr(1))}),t}},{key:"initScoreValidator",value:function(){this.scoreValidator=$("#batch-set-score-form").validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:"#score",es_score:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")}}}),$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||parseFloat(t)<=parseFloat($(i).val())},"Please enter a lesser value.")}},{key:"isTestpaper",value:function(){return 1==$('input[name="isTestpaper"]').val()}},{key:"batchSetScore",value:function(){if(this.scoreValidator.form()){var t=$('input[name="score"]').val(),e=$('input[name="missScore"]').val(),i={score:t,missScore:e};this.questionOperate.modifyScore(this.selectQuestion,i,this.isTestpaper()),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.score_update_success")}),this.$scoreModal.modal("hide")}}},{key:"setDifficulty",value:function(){var t=this;$(".js-difficulty-btn").click(function(){var e=$("input[name='difficultyRadios']:checked").val(),i=$("input[name='difficultyRadios']:checked").next().text();t.questionOperate.modifyDifficulty(t.selectQuestion,e,i),t.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.difficulty_update_success")}),t.$diffiultyModal.modal("hide")})}},{key:"itemEdit",value:function(t){if(!this.isEditing()){var e=this,i=0,a="",s={},n=0,r=$(t.currentTarget),o=r.parents(".subject-item"),u=r.parents(".subject-item__operation").data("url");void 0!==o.attr("data-material-token")?(i=o.data("key"),a=o.attr("data-material-token"),s=this.questionOperate.getSubQuestion(a,i),n=1,i++):(i=this.questionOperate.getQuestionOrder(o.attr("id")),s=this.questionOperate.getQuestion(o.attr("id")),a=o.attr("id"));var c={seq:i,token:a,question:s,isSub:n,method:"edit",isTestpaper:this.isTestpaper()?1:0};$.post(u,c,function(t){o.replaceWith(t),b.default.getEditor(s.type,$(".js-edit-form"),e.questionOperate)})}}},{key:"itemConvert",value:function(e){var i=$(e.currentTarget),a=i.parents(".subject-item"),s=i.data("type"),n=i.parents(".subject-change-list").data("fromType"),r=i.parents(".js-edit-form"),o=i.parents(".subject-change-list").data("convertUrl"),u=t._serializeArrayConvertToJson(r.serializeArray());if($(".js-attachment-list").length>0){var c={};$(".js-attachment-list-stem").find(".js-attachment-name").length>0&&(c.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),$(".js-attachment-list-analysis").find(".js-attachment-name").length>0&&(c.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),u.attachment=c}var l=$(".js-edit-form-seq").text(),d=$(".js-sub-judge").val(),f=$(".js-hidden-method").val(),h={seq:l,token:u.token,question:u,fromType:n,toType:s,isSub:d,method:f,isTestpaper:this.isTestpaper()?1:0};h.fromType=n,h.toType=s;var m=this;$.post(o,h,function(t){a.replaceWith(t),b.default.getEditor(s,$(".js-edit-form"),m.questionOperate)})}},{key:"itemClick",value:function(){var t=this;$(".js-create-btn").on("click",function(e){var i=$(e.target);t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){i.attr("disabled",!0);var e=$("#cd-modal"),a=e.attr("data-sub"),s=i.data("url"),n=e.attr("data-index"),r=i.data("type");"false"==a?t.itemAdd(n,r,s,i):t.subItemAdd(n,r,s)},500)})}},{key:"itemAdd",value:function(t,e,i,a){var s=this,n=s.questionOperate.getQuestionOrder(t)+1,r=this.isTestpaper()?1:0;$.post(i,{seq:n,token:t,method:"add",isTestpaper:r}).then(function(i){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1);var r=n+1;s.orderQuestionList(r,$('[data-anchor="#'+t+'"]').parent(),$("#"+t)),$('[data-anchor="#'+t+'"]').parent().after(s.getNewListItem(n,e,a.text())),s.statErrorQuestions(),$("#"+t).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'+t+'"]').last().after(i):$("#"+t).after(i),b.default.getEditor(e,$(".js-edit-form"),s.questionOperate)})}},{key:"subItemAdd",value:function(t,e,i){var a=this,s=this.questionOperate.getQuestion(t),n=s.subQuestions.length+1,r=this.isTestpaper()?1:0;$.post(i,{seq:n,token:t,method:"add",isSub:1,isTestpaper:r}).then(function(i){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1),$("#"+t).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'+t+'"]').last().after(i):$("#"+t).after(i),b.default.getEditor(e,$(".js-edit-form"),a.questionOperate)})}},{key:"getNewListItem",value:function(t,e,i){return"material"!==e?'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'+t+'">\n            <span class="js-list-index">'+t+'</span>\n            <label class="sb-checkbox cd-checkbox js-show-checkbox hidden" data-type="'+e+'"><input type="checkbox" data-toggle="cd-checkbox"></label>\n          </div>\n          <span class="js-type-name">'+i+"</span>\n        </div>":'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'+t+'">\n            <span class="js-list-index">'+t+'</span>\n          </div>\n          <span class="js-type-name">'+i+"</span>\n        </div>"}},{key:"deleteSubjectItem",value:function(t){var e=this;if(!this.isEditing()){if(this.questionOperate.getTokenList().length<2)return void cd.message({type:"danger",message:Translator.trans("subject.question_delete_tip")});cd.confirm({title:Translator.trans("subject.delete.title"),content:Translator.trans("subject.delete.content"),okText:Translator.trans("site.confirm"),cancelText:Translator.trans("site.cancel")}).on("ok",function(){var i=$(t.currentTarget).parent().parent(),a=i.attr("id");if(i.hasClass("subject-sub-item")){a=i.attr("data-material-token");var s=i.attr("data-key");e.questionOperate.deleteSubQuestion(a,s),i.remove();var n=0;return void $('[data-material-token="'+a+'"]').each(function(){$(this).attr("id","sub"+n),$(this).attr("data-key",n++),$(this).find(".subject-sub-item__number").text("("+n+")")})}var r=e.questionOperate.getQuestion(a),o=e.questionOperate.getQuestionOrder(a),u=$("[data-anchor=#"+a+"]").parent();e.orderQuestionList(o,u,i),e.questionOperate.deleteQuestion(a),"material"==r.type&&i.nextUntil(".js-subject-main-item").each(function(){$(this).remove()}),u.remove(),i.remove(),e.statErrorQuestions()})}}},{key:"editTestpaperTitle",value:function(t){var e=$(t.target).val();if(""==$.trim(e))return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_empty_hint")}),void $(t.target).val(this.testpaperTitle);for(var i=e.length,a=0;a<e.length;a++)e.charCodeAt(a)>127&&i++;if(i>50)return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_too_long_hint")}),void $(t.target).val(this.testpaperTitle);this.testpaperTitle=e}},{key:"updateQuestionCountText",value:function(t){var e=this.questionOperate.getQuestionCount("total"),i=this.questionOperate.getQuestionCount(t);$(".js-total-num").text(Translator.trans("subject.question_count",{count:e})),$("[data-type="+t+"]").find(".subject-data__num").text(Translator.trans("subject.question_count",{count:i}))}},{key:"updateTotalScoreText",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isTestpaper()&&t){var e=parseFloat(this.questionOperate.getTotalScore()).toFixed(1);$(".js-total-score").text(Translator.trans("subject.total_score",{totalScore:e}))}}},{key:"orderQuestionList",value:function(t,e,i){var a=t,s=t;e.nextAll(".subject-list-item").each(function(){$(this).find(".js-list-index").text(a),a++}),i.nextAll(".subject-item").not(".subject-sub-item").each(function(){$(this).find(".subject-item__number").text(s),s++})}},{key:"finishImport",value:function(t){if(!this.isEditing()){var e=!1,i=this,a="";if(this.$element.find(".subject-list-item__num--error").each(function(){a=a+$(this).find(".js-list-index").text()+"、",e=!0}),a=Translator.trans("subject.question_error_tip",{seqs:a.substring(0,a.length-1)}),e)return void cd.message({type:"danger",message:a});if(this.isMaterialHasSub()){var s="";this.isTestpaper()&&(s=this.testpaperTitle);var n=$(t.currentTarget);n.button("loading"),$.ajax({type:"POST",url:n.data("url"),data:(0,o.default)({title:s,questions:this.questionOperate.getQuestions()}),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){!0===t&&(n.button("reset"),cd.message({type:"success",message:Translator.trans("subject.save_success")}),i.redirect=!0,window.location.href=n.data("redirectUrl"))}})}}}},{key:"isMaterialHasSub",value:function(){for(var t=this,e=t.questionOperate.getTokenList(),i=0;i<e.length;i++){var a=e[i],s=t.questionOperate.getQuestion(a);if("material"==s.type&&0==s.subQuestions.length){var n=t.questionOperate.getQuestionOrder(a);return cd.message({type:"danger",message:Translator.trans("subject.material_nosub_tip",{seq:n})}),!1}}return!0}},{key:"statErrorQuestions",value:function(){var t="",e=!1;this.$element.find(".subject-list-item__num--error").each(function(){t=t+$(this).find(".js-list-index").text()+"、",e=!0}),t=Translator.trans("subject.question_error_tip",{seqs:t.substring(0,t.length-1)}),e?$(".js-error-tip").html(t):$(".js-error-tip").html("")}},{key:"addModalShow",value:function(t,e){if(!this.isEditing()){var i=$(t.currentTarget),a=$("#cd-modal"),s=i.closest(".js-subject-item").attr("id");e?(a.find('[data-type="material"]').addClass("hidden"),a.attr("data-sub","true")):(a.find('[data-type="material"]').removeClass("hidden"),a.attr("data-sub","false")),a.attr("data-index",s),a.modal("show")}}},{key:"isEditing",value:function(){var t=$(".js-subject-edit-item"),e=t.hasClass("js-sub-edit-item"),i="";if(0!==t.length){var a=t.find(".js-edit-form-seq").text();if(e){var s=t.find(".js-hidden-token").val(),n=$("#"+s).find(".js-subject-item-number").text();i=$.trim(n)}var r=e?Translator.trans("subject.sub_is_editing_warning",{parentNum:i,seq:a}):Translator.trans("subject.is_editing_warning",{seq:a});return cd.message({type:"warning",message:r}),!0}return!1}},{key:"questionTypeConvert",value:function(t,e){var i=$(".js-subject-list").find("[data-anchor=#"+e+"]");i.find(".js-show-checkbox").attr("data-type",t),i.next(".js-type-name").text(this.getTypeName(t))}},{key:"getTypeName",value:function(t){switch(t){case"single_choice":return Translator.trans("course.question.type.single_choice");case"uncertain_choice":return Translator.trans("course.question.type.uncertain_choice");case"choice":return Translator.trans("course.question.type.choice");case"determine":return Translator.trans("course.question.type.determine");case"essay":return Translator.trans("course.question.type.essay");case"fill":return Translator.trans("course.question.type.fill");case"material":return Translator.trans("course.question.type.material");default:return Translator.trans("course.question.type.unknown")}}},{key:"ieImg",value:function(){(g.Browser.ie10||g.Browser.ie11)&&this.$itemList.addClass("ie-item-list")}}],[{key:"_serializeArrayConvertToJson",value:function(t){var e={},i=!0,a=!1,s=void 0;try{for(var r,o=(0,n.default)(t);!(i=(r=o.next()).done);i=!0){var u=r.value;e[u.name]?(e[u.name].push||(e[u.name]=[e[u.name]]),e[u.name].push(u.value)):e[u.name]=u.value}}catch(t){a=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw s}}return e}}]),t}();e.default=y,new y},c56870cab48202a6146a:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var s=i("cd078759ac479d74803f"),n=a(s),r=i("db627c66114adc9bda79"),o=a(r);e.default=function t(e,i,a){null===e&&(e=Function.prototype);var s=(0,o.default)(e,i);if(void 0===s){var r=(0,n.default)(e);return null===r?void 0:t(r,i,a)}if("value"in s)return s.value;var u=s.get;if(void 0!==u)return u.call(a)}},d3a6179560ad66e862d2:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("1ff717687cc04d94af8f"),c=a(u),l=i("3b1883fc74dc0f9509af"),d=a(l),f=i("fc2f2ee10e7680a03c60"),h=a(f),m=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,c.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.initTitleEditor(a.validator),a}return(0,d.default)(e,t),e}(h.default);e.default=m},db627c66114adc9bda79:function(t,e,i){t.exports={default:i("71b27e2f2ad91538e032"),__esModule:!0}},e28aaed3fc88f258b3a2:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("c56870cab48202a6146a"),h=a(f),m=i("3b1883fc74dc0f9509af"),p=a(m),v=i("e7c4ffc794f204cf93fb"),b=a(v),g=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},a}return(0,p.default)(e,t),(0,c.default)(e,[{key:"initEvent",value:function(){var t=this;(0,h.default)(e.prototype.__proto__||(0,n.default)(e.prototype),"initEvent",this).call(this),this.$form.on("change",'input:radio[name="right"]',function(e){return t.changeRadio(e)})}},{key:"initData",value:function(){(0,h.default)(e.prototype.__proto__||(0,n.default)(e.prototype),"initData",this).call(this);var t=this.$form.find(".js-choose-item");$(".cd-radio.checked").find('[name="right"]').attr("checked",!0),this.checkedRadio=t.find(".cd-radio.checked")}},{key:"initValidator",value:function(){(0,h.default)(e.prototype.__proto__||(0,n.default)(e.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",function(t,e,i){return!0})}},{key:"changeRadio",value:function(t){this.checkedRadio&&this.checkedRadio.removeClass("checked"),this.checkedRadio=$(t.currentTarget).parent()}}]),e}(b.default);e.default=g},e7c4ffc794f204cf93fb:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("cd078759ac479d74803f"),n=a(s),r=i("7ab4a89ebadbfdecc2bf"),o=a(r),u=i("4602c3f5fe7ad9e3e91d"),c=a(u),l=i("1ff717687cc04d94af8f"),d=a(l),f=i("3b1883fc74dc0f9509af"),h=a(f),m=i("fc2f2ee10e7680a03c60"),p=a(m),v=function(t){function e(t,i){(0,o.default)(this,e);var a=(0,d.default)(this,(e.__proto__||(0,n.default)(e)).call(this,t,i));return a.validator=null,a.oldFieldId="question-stem-field",a.fieldId="",a.optionCount=0,a.timer=!1,a.errorMessage={noAnswer:Translator.trans("subject.choice_answer_least_two")},a.init(),a}return(0,h.default)(e,t),(0,c.default)(e,[{key:"init",value:function(){this.initTitleEditor(this.validator),this.initOptionCount(),this.initData(),this.initEvent(),this.initValidator()}},{key:"initOptionCount",value:function(){this.optionCount=$(".edit-subject-item").length}},{key:"initEvent",value:function(){var t=this;this.$form.on("focus",".js-item-option-edit",function(e){return t.editOption(e)}),this.$form.on("click",".js-item-option-delete",function(e){return t.deleteOption(e)}),this.$form.on("click",".js-item-option-add",function(e){return t.addOption(e)}),this.$form.on("click",'[data-role="edit"]',function(e){return t.editOption(e)})}},{key:"initData",value:function(){$(".cd-checkbox.checked").find('[name="right"]').attr("checked",!0)}},{key:"initValidator",value:function(){$.validator&&($.validator.prototype.elements=function(){var t=this,e={};return $(this.currentForm).find("input, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console,e[this.name]=!0,!0})},$.validator.addMethod("noMoreThan",function(t,e,i){return""==t||parseFloat(t)<=parseFloat($(i).val())},"Please enter a lesser value."),$.validator.addMethod("multi",function(t,e,i){return $('input:checkbox[name="right"]:checked').length>1}));var t=this;this.$form.validate().destroy(),this.validator=this.$form.validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:'[name="score"]',es_score:!0},stem:{required:!0},options:{required:!0},right:{required:!0,multi:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")},stem:{required:Translator.trans("subject.validate.stem_required")},options:{required:Translator.trans("subject.validate.option_required")}},errorPlacement:function(e,i){var a=i.attr("name");"right"==a?($(".edit-subject-item__order").addClass("edit-subject-item__order--error"),cd.message({type:"danger",message:t.errorMessage.noAnswer})):"stem"==a?$("#cke_question-stem-field").after(e):"options"==a&&i.prev().hasClass("hidden")?e.appendTo(i.parent()):e.insertAfter(i)}})}},{key:"editOption",value:function(t){var e=this,i=$(t.currentTarget),a=i.next();this.fieldId=a.attr("id"),i.addClass("hidden");var s=$("#"+this.fieldId),n=null;if(CKEDITOR.instances[this.oldFieldId]){n=CKEDITOR.instances[this.oldFieldId];var r=$("#"+this.oldFieldId);r.addClass("hidden"),r.prevAll("input").first().removeClass("hidden").show().val($(e.replacePicture(n.getData())).text()),CKEDITOR.instances[this.oldFieldId].destroy()}this.oldFieldId=this.fieldId,CKEDITOR.instances[this.fieldId]&&CKEDITOR.instances[this.fieldId].destroy(),n=CKEDITOR.replace(this.fieldId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:s.data("imageUploadUrl"),height:s.height(),startupFocus:!0}),n.focus(),n.on("change",function(){s.val(n.getData()),s.prev("input").val($(e.replacePicture(n.getData())).text())}),n.on("blur",function(){s.val(n.getData()),s.prev("input").val($(e.replacePicture(n.getData())).text())})}},{key:"deleteOption",value:function(t){if(this.optionCount<=2)return void cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")});var e=$(t.currentTarget).parents(".edit-subject-item"),i=e.find(".edit-subject-item__order").text(),a=e.find('input[name="right"]').val();e.nextAll(".edit-subject-item").each(function(){var t=$(this).find(".edit-subject-item__order"),e=t.text();t.text(i),i=e,$(this).find('input[name="right"]').val(a),a++}),e.remove(),this.optionCount--}},{key:"addOption",value:function(t){var e=this;e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.addRealOperate(t)},500)}},{key:"addRealOperate",value:function(t){var e=this,i=$(t.currentTarget);if(this.optionCount>=10)return cd.message({type:"danger",message:Translator.trans("subject.choice_option_most_ten")}),void i.attr("disabled",!1);var a=$('[name="type"]').val();$.ajax({url:"/subject/option/"+a,type:"get",data:{order:this.optionCount}}).done(function(i){$(t.currentTarget).parent().before(i),e.optionCount++})}},{key:"submitForm",value:function(t){if(this.optionCount<2)return void cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")});this.validator.resetForm(),this.validator.form()&&($(t.currentTarget).button("loading"),this.finishEdit(this.$form.serializeArray()))}},{key:"finishEdit",value:function(t){var e=$(".js-hidden-token").val(),i=this,a={options:[],answers:[]};$.each(t,function(t,e){var i=e.name,s=e.value;-1!==$.inArray(i,["stem","difficulty","score","missScore","type","analysis"])?a[i]=s:"options"==i?a.options.push(s):"right"==i&&a.answers.push(s)}),a.attachment=this.getAttachments();var s=$(".js-hidden-method").val(),n=$(".js-sub-judge").val(),r=$(".js-edit-form-seq").text()-1,o=0;"1"==n?(e=i.updataCachedSubQuestion(e,r,a,s),a=i.operate.getSubQuestion(e,r),o=r+1):(e=i.updataCachedQuestion(e,a,s),a=i.operate.getQuestion(e),o=i.operate.getQuestionOrder(e)),this.analysisEditor.destroy(),$.post(i.$form.data("url"),{seq:o,question:a,token:e,isSub:n},function(t){i.$form.parent(".subject-item").replaceWith(t)})}}]),e}(p.default);e.default=v},e7ceb28b20870340ea1d:function(t,e,i){i("bdf846462d003d52f301"),i("9f5e733705cd16698cdf"),t.exports=i("f320218143ef18cc600c")},f320218143ef18cc600c:function(t,e,i){var a=i("6c3dda553b2c45fd2161"),s=i("a5b03ec781f71e8d0bed");t.exports=i("99ec8b6ce9e8b820539a").getIterator=function(t){var e=s(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return a(e.call(t))}},fc2f2ee10e7680a03c60:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("7ab4a89ebadbfdecc2bf"),n=a(s),r=i("4602c3f5fe7ad9e3e91d"),o=a(r),u=i("d5fb0e67d2d4c1ebaaed"),c=a(u),l=function(){function t(e,i){(0,n.default)(this,t),this.$form=e,this.operate=i,this.titleFieldId="question-stem-field",this.$analysisModal=$(".js-analysis-modal"),this.validator=null,this.titleEditorToolBarName="Minimal",this.analysisEditor=null,this._init(),this.attachmentActions=new c.default(e)}return(0,o.default)(t,[{key:"_init",value:function(){this._initEvent(),this._initValidate(),this._initAnalysisEditor()}},{key:"_initEvent",value:function(){var t=this;this.$form.on("click",".js-finish-edit",function(e){return t.submitForm(e)}),this.$form.on("click",".js-analysis-edit",function(e){return t.showAnalysisModal(e)}),this.$analysisModal.on("click",".js-analysis-btn",function(e){return t.saveAnalysis(e)})}},{key:"submitForm",value:function(t){var e=this;if(e.validator.form()){$(t.currentTarget).button("loading");var i=e.getQuestion();e.finishEdit(i)}}},{key:"_initAnalysisEditor",value:function(){var t=this,e=this.$form.find('[data-edit="analysis"]').val(),i=$(".js-analysis-field");CKEDITOR.instances[i.attr("id")]&&CKEDITOR.instances[i.attr("id")].destroy(),i.val(e),this.analysisEditor=CKEDITOR.replace(i.attr("id"),{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()}),this.analysisEditor.on("change",function(){i.val(t.analysisEditor.getData())}),this.analysisEditor.on("blur",function(){i.val(t.analysisEditor.getData())})}},{key:"showAnalysisModal",value:function(t){var e=$(t.currentTarget),i=e.prev('[data-edit="analysis"]').val();this.analysisEditor.setData(i),this.$analysisModal.modal("show")}},{key:"saveAnalysis",value:function(t){var e=this.analysisEditor.getData();$('[data-edit="analysis"]').val(e),$(".js-analysis-content").html($(this.replacePicture(e)).text()),this.$analysisModal.modal("hide")}},{key:"finishEdit",value:function(t){var e=this,i=$(".js-hidden-token").val(),a=$(".js-hidden-method").val(),s=$(".js-sub-judge").val(),n=$(".js-edit-form-seq").text()-1,r=0;"1"==s?(i=e.updataCachedSubQuestion(i,n,t,a),t=e.operate.getSubQuestion(i,n),r=n+1):(i=e.updataCachedQuestion(i,t,a),t=e.operate.getQuestion(i),r=e.operate.getQuestionOrder(i)),this.analysisEditor.destroy(),$.post(e.$form.data("url"),{seq:r,question:t,token:i,isSub:s},function(t){e.$form.parent(".subject-item").replaceWith(t)})}},{key:"updataCachedQuestion",value:function(t,e,i){var a=this;return"add"==i?t=a.operate.addQuestion(t,e):($.each(e,function(e,i){a.operate.updateQuestionItem(t,e,i)}),a.operate.correctQuestion(t)),t}},{key:"updataCachedSubQuestion",value:function(t,e,i,a){var s=this;return"add"==a?t=s.operate.addSubQuestion(t,i):($.each(i,function(i,a){s.operate.updateSubQuestionItem(t,e,i,a)}),s.operate.correctSubQuestion(t,e)),t}},{key:"getQuestion",value:function(){var t={};return $("*[data-edit]").each(function(){var e=$(this).data("edit"),i=$(this).val();t[e]=i}),t.difficulty=$("input[name='difficulty']:checked").val(),t.attachment=this.getAttachments(),t=this.filterQuestion(t)}},{key:"filterQuestion",value:function(t){return t}},{key:"getAttachments",value:function(){var t={};return $(".js-attachment-list-stem").find(".js-attachment-name").length>0&&(t.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),$(".js-attachment-list-analysis").find(".js-attachment-name").length>0&&(t.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),t}},{key:"_initValidate",value:function(){var t=this.$form.validate({onkeyup:!1,rules:{difficulty:{required:!0},stem:{required:!0},score:{required:!0,number:!0,max:999,min:0,es_score:!0}},messages:{difficulty:Translator.trans("course.question.create.difficulty_required_error_hint"),stem:{required:Translator.trans("subject.stem_required")}}});this.validator=t}},{key:"initTitleEditor",value:function(t){var e=this,i=$("#"+e.titleFieldId),a=i.prev(),s=CKEDITOR.replace(e.titleFieldId,{toolbar:e.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()});s.on("change",function(){i.val(s.getData()),a.val($(e.replacePicture(s.getData())).text())}),s.on("blur",function(){i.val(s.getData()),a.val($(e.replacePicture(s.getData())).text())}),s.on("instanceReady",function(){this.focus(),$('[data-role="edit"]').one("click",function(){a.val($(e.replacePicture(s.getData())).text()),i.val(s.getData()),s.destroy(),i.hide(),a.show()})})}},{key:"replacePicture",value:function(t){return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,"["+Translator.trans("subject.symbol.picture")+"]")}},{key:"titleEditorToolBarName",set:function(t){this._titleEditorToolBarName=t},get:function(){return this._titleEditorToolBarName}}]),t}();e.default=l}},["8c14aa1debf44e6bb6c7"]);