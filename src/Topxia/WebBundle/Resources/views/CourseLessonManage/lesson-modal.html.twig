{% extends 'TopxiaWebBundle::bootstrap-modal-layout.html.twig' %}

{% set modal_class = 'modal-lg' %}
{% set lesson = lesson|default(null) %}

{% block title %}
  {% if lesson %}编辑课时{{ lesson.number }}{% else %}添加课时{% endif %}
{% endblock %}

{% block body %}

<form id="course-lesson-form" class="form-horizontal lesson-form" method="post"
  {% if lesson %}
    action="{{ path('course_manage_lesson_edit', {courseId:course.id, lessonId:lesson.id}) }}"
  {% else %}
    action="{{ path('course_manage_lesson_create', {id:course.id}) }}"
  {% endif %}
  >

  <div class="form-group" {% if lesson %}style="display:none;"{% endif %}>
    <div class="col-md-2 control-label"><label>类型</label></div>
    <div class="col-md-9 controls">
      <div class="radios">
        {{ radios('type', dict('lessonType'), field_value(lesson, 'type')|default('video')) }}
      </div>
    </div>
  </div>

  <div class="form-group for-text-type for-video-type for-audio-type {% if storageSetting.upload_mode == 'cloud' %}for-ppt-type{% endif %}" >
    <div class="col-md-2 control-label"><label for="lesson-title-field">标题</label></div>
    <div class="col-md-9 controls">
      <div class="row">
        <div class="col-md-10">
          <input id="lesson-title-field" class="form-control" type="text" name="title" value="{{ field_value(lesson, 'title') }}">
        </div>
        <div class="col-md-2">
          <div class="checkbox">
            <label><input type="checkbox" name="free" value="1" {% if field_value(lesson, 'free') %} checked="checked" {% endif %}> 免费课时</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="form-group for-text-type for-video-type for-audio-type {% if storageSetting.upload_mode == 'cloud' %}for-ppt-type{% endif %}">
    <div class="col-md-2 control-label"><label for="lesson-summary-field">摘要</label></div>
    <div class="col-md-9 controls"><textarea class="form-control" id="lesson-summary-field" name="summary">{{ field_value(lesson, 'summary') }}</textarea></div>
  </div>

  <div class="form-group for-text-type">
    <div class="col-md-2 control-label"><label for="lesson-content-field">内容</label></div>
    <div class="col-md-9 controls"><textarea class="form-control" id="lesson-content-field" name="content">{{ field_value(lesson, 'content') }}</textarea></div>
  </div>

  <div class="form-group for-video-type for-audio-type {% if storageSetting.upload_mode == 'cloud' %}for-ppt-type{% endif %}">
    <div class="col-md-2 control-label for-video-type"><label>视频</label></div>
    <div class="col-md-2 control-label for-audio-type"><label>音频</label></div>
    <div class="col-md-2 control-label for-ppt-type"><label>PPT</label></div>
    <div class="col-md-9 controls">
      {% include "TopxiaWebBundle:CourseLessonManage:media-choose.html.twig" %}
      <input id="lesson-media-field" type="hidden" name="media" value="{{ field_value(lesson, 'media')|json_encode }}">
    </div>
  </div>

  <div class="form-group for-none-type {% if storageSetting.upload_mode != 'cloud' %}for-ppt-type{% endif %}">
    <div class="col-md-offset-2 col-md-9">
      <div class="alert alert-info">
        <p>PPT文档需要EduSoho云转换后才能在浏览器中显示，请先开启EduSoho云。</p>
        <p>如尚未购买EduSoho云服务，请联系<a href="http://www.edusoho.com/service" target="_blank"><strong>EduSoho官方</strong></a>购买。</p>
        </div>
    </div>
  </div>

  <div class="form-group for-video-type for-audio-type" id="lesson-length-form-group">
      <div class="col-md-2 control-label for-video-type"><label>视频时长</label></div>
      <div class="hide"><label for="lesson-length-field">视频时长或</label></div>
      <div class="col-md-2 control-label for-audio-type"><label for="lesson-length-field">音频时长</label></div>
    <div class="col-md-9 controls">
      <input class="form-control width-input width-input-small" id="lesson-minute-field" type="text" name="minute" value="{{ field_value(lesson, 'minute') }}">分
      <input class="form-control width-input width-input-small" id="lesson-second-field" type="text" name="second" value="{{ field_value(lesson, 'second') }}">秒
      <div class="help-block">时长必须为整数。</div>
    </div>
  </div>

  <div class="form-group for-video-type video-quality-switcher">
    <div class="col-md-2 control-label"><label>视频转码类型</label></div>
    <div class="col-md-9 controls">
      <div class="quality-switcher-bar">
        <span class="text-muted quality-switcher-name"></span> <a href="javascript:;" class="edit-btn text-info"><span class="glyphicon glyphicon-cog"></span> 设置</a>
      </div>

      <div class="quality-switcher-control">
        <div class="video-quality radios">
          画质：
        {{ radios('video_quality', {'low':'流畅 <span class="text-muted">(适合PPT讲解)</span>', 'normal':'标准 <span class="text-muted">(适合屏幕录制、摄像头拍摄)</span>', 'high': '精细 <span class="text-muted">(适合动态电影)</span>'}, storageSetting.video_quality|default('low')) }}
        </div>

        <div class="audio-quality radios">
          音质：
          {{ radios('video_audio_quality', {'low':'流畅', 'normal':'标准', 'high': '精细'}, storageSetting.video_audio_quality|default('low')) }}
        </div>

        <div class="quality-actions">
          <a href="javascript:;" class="btn btn-default btn-sm confrim-btn">确定</a>
          <a href="javascript:;" class="btn btn-link btn-sm cancel-btn">取消</a>
        </div>
      </div>




    </div>



  </div>

  <input type="hidden" name="_csrf_token" value="{{ csrf_token('site') }}">

</form>

<script>app.load('course-manage/lesson-modal')</script>

{% endblock %}

{% block footer %}
    <button type="button" class="btn btn-link" data-dismiss="modal">取消</button>
    <button id="course-lesson-btn" data-submiting-text="正在提交" type="submit" class="btn btn-primary" data-toggle="form-submit" data-target="#course-lesson-form">{% if lesson %}保存{% else %}添加{% endif %}</button>
{% endblock %}

{% set hideFooter = true %}