<tbody class="js-category-body">
  {% if categories is not empty %}
    {{ _self.showCategoryTree(categories, questionBank, users, false) }}
  {% else %}
    <tr><td colspan="20"><div class="empty">{{'my.teaching.question_bank.question_category.empty'|trans}}</div></td></tr>
  {% endif %}
</tbody>

{% macro showCategoryTree(categories, questionBank, users, isCollapseChildren) %}
  {% for category in categories %}
    {% set isParent = category.children|default(null) is not empty %}
    {% set isRoot = category.depth == 1 %}
    {# <tr id="{{ category.id }}" data-name="{{ category.name }}" data-id="{{ category.id }}" data-parent-id="{{ category.parentId }}" style="display: {{ (not isRoot and isCollapseChildren) ? 'none' : 'block' }}"> #}
      <tr class="js-row{{ (isParent and isCollapseChildren) ? ' row-collapse' : ' row-expand' }}">
        <td class="vertical-middle" style="padding-left: {{ 24 * (category.depth - 1 ) }}px; overflow: hidden">
          {% if isParent %}
            <a href="javascript:;" class="js-expand">
              <i class="es-icon {{ isCollapseChildren ? 'es-icon-keyboardarrowdown' : 'es-icon-chevronright' }}"></i>
            </a>
          {% else %}
            <i class="es-icon mll"></i>
          {% endif %}
          {{ category.name }}
        </td>
        <td class="td col-md-2 code vertical-middle">
          <div>{{ users[category.userId].nickname }}</div>
          <span class="cd-text-sm cd-dark-minor">{{ category.updatedTime|date('Y-m-d H:i:s') }}</span>
        </td>
        <td class="td col-md-3 operation vertical-middle" style="overflow: unset;">
          {% if category.depth < 3 %}
            <a href="javascript:;" class="cd-btn color-info" 
            data-url="{{ path('question_bank_manage_question_category_batch_create', {id: questionBank.id, parentId: category.id}) }}" 
            data-toggle="modal" data-target="#modal">{{'admin.category_manage.create_sub_category_btn'|trans}}</a>
          {% endif %}
          <div class="btn-group">
            <a href="javascript:;" class="cd-btn color-info" data-url="{{ path('question_bank_manage_question_category_edit', {id: category.id}) }}" data-toggle="modal" data-target="#modal">
              {{'admin.category_manage.edit_btn'|trans}}
            </a>
            <a href="javascript:;" data-url="{{ path('question_bank_manage_question_category_delete', {id:category.id}) }}" data-count-url="{{ path('question_bank_manage_question_category_question_count', {id:category.id}) }}"
              class="cd-btn delete-btn color-info">{{'admin.operation_announcement.delete_btn'|trans}}
            </a>
          </div>
        </td>
      </tr>
      {% if isParent %}
        {{ _self.showCategoryTree(category.children, questionBank, users, isCollapseChildren) }}
      {% endif %}
    {# </tr> #}
  {% endfor %}
{% endmacro %}
